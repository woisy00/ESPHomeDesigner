import{T as v}from"./template_converter-Dp-G9w6d.js";const M=(t,y,e)=>{const o=y.props||{},{getColorStyle:r}=e,a=y.entity_id||"",s=y.title||"",g=o.show_label!==!1&&o.show_label!=="false",d=o.show_percentage!==!1&&o.show_percentage!=="false",h=o.bar_height||15,c=o.border_width||1,p=o.color||"theme_auto",u=r(p);let $=50;if(window.AppState&&window.AppState.entityStates&&a){const n=window.AppState.entityStates[a],i=n&&n.state!==void 0?n.state:null;if(i!=null){const f=parseFloat(String(i).replace(/[^0-9.-]/g,""));isNaN(f)||($=Math.max(0,Math.min(100,f)))}}if(t.innerHTML="",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.gap="4px",t.style.color=u,g&&(s||d)){const n=document.createElement("div");if(n.style.display="flex",n.style.justifyContent="space-between",n.style.alignItems="center",n.style.fontSize="12px",n.style.paddingBottom="2px",n.style.width="100%",s){const i=document.createElement("span");i.textContent=s,n.appendChild(i)}if(d){const i=document.createElement("span");i.textContent=Math.round($)+"%",n.appendChild(i)}t.appendChild(n)}const _=document.createElement("div");_.style.width="100%",_.style.height=`${h}px`,_.style.border=`${c}px solid ${u}`,_.style.borderRadius="2px",_.style.position="relative",_.style.overflow="hidden",_.style.backgroundColor=p==="white"?"#000":"#fff";const l=document.createElement("div");l.style.width=`${$}%`,l.style.height="100%",l.style.backgroundColor=u,l.style.transition="width 0.3s ease",_.appendChild(l),t.appendChild(_)},C=(t,{common:y,convertColor:e})=>{const o=t.props||{};let r=o.value||0;return t.entity_id&&(r=`!lambda "return id(${t.entity_id.replace(/[^a-zA-Z0-9_]/g,"_")}).state;"`),{bar:{...y,min_value:o.min||0,max_value:o.max||100,value:r,bg_color:e(o.bg_color||"white"),indicator:{bg_color:e(o.color)},mode:o.mode||"normal"}}},S=(t,y)=>{const{lines:e,addFont:o,getColorConst:r,addDitherMask:a,getCondProps:s,getConditionCheck:g,isEpaper:d,sanitize:h}=y,c=t.props||{};let p=(t.entity_id||"").trim();const u=h(t.title||""),$=c.show_label!==!1,_=c.show_percentage!==!1,l=parseInt(c.bar_height||15,10),n=c.color||"theme_auto",i=r(n),f=o("Roboto",400,12);p&&!c.is_local_sensor&&!p.includes(".")&&(p=`sensor.${p}`),e.push(`        // widget:progress_bar id:${t.id} type:progress_bar x:${t.x} y:${t.y} w:${t.width} h:${t.height} entity:${p} title:"${u}" show_label:${$} show_pct:${_} bar_height:${l} color:${n} local:${!!c.is_local_sensor} ${s(t)}`);const b=g(t);b&&e.push(`        ${b}`);const m=c.is_local_sensor?p||"battery_level":p?p.replace(/[^a-zA-Z0-9_]/g,"_"):"";if(m){e.push(`        float val_${t.id.replace(/-/g,"_")} = id(${m}).state;`),e.push(`        if (std::isnan(val_${t.id.replace(/-/g,"_")})) val_${t.id.replace(/-/g,"_")} = 0;`),e.push(`        int pct_${t.id.replace(/-/g,"_")} = (int)val_${t.id.replace(/-/g,"_")};`),e.push(`        if (pct_${t.id.replace(/-/g,"_")} < 0) pct_${t.id.replace(/-/g,"_")} = 0;`),e.push(`        if (pct_${t.id.replace(/-/g,"_")} > 100) pct_${t.id.replace(/-/g,"_")} = 100;`),$&&u&&e.push(`        it.printf(${t.x}, ${t.y}, id(${f}), ${i}, TextAlign::TOP_LEFT, "${u}");`),_&&e.push(`        it.printf(${t.x} + ${t.width}, ${t.y}, id(${f}), ${i}, TextAlign::TOP_RIGHT, "%d%%", pct_${t.id.replace(/-/g,"_")});`);const x=t.y+(t.height-l);e.push(`        it.rectangle(${t.x}, ${x}, ${t.width}, ${l}, ${i});`),e.push(`        if (pct_${t.id.replace(/-/g,"_")} > 0) {`),e.push(`          int bar_w = (${t.width} - 4) * pct_${t.id.replace(/-/g,"_")} / 100;`),e.push(`          it.filled_rectangle(${t.x} + 2, ${x} + 2, bar_w, ${l} - 4, ${i});`),e.push("        }"),a(e,n,d,t.x,x,t.width,l,2)}else e.push(`        it.rectangle(${t.x}, ${t.y} + ${t.height} - ${l}, ${t.width}, ${l}, ${i});`),e.push(`        it.filled_rectangle(${t.x} + 2, ${t.y} + ${t.height} - ${l} + 2, ${t.width} / 2, ${l} - 4, ${i});`),$&&u&&e.push(`        it.printf(${t.x}, ${t.y}, id(${f}), ${i}, TextAlign::TOP_LEFT, "${u}");`);b&&e.push("        }")},T=t=>{const{lines:y,widgets:e,isLvgl:o,pendingTriggers:r}=t;if(!(!e||e.length===0))for(const a of e){if(a.type!=="progress_bar")continue;let s=(a.entity_id||"").trim();const g=a.props||{};!s||g.is_local_sensor||(s.includes(".")||(s=`sensor.${s}`),o&&r&&(r.has(s)||r.set(s,new Set),r.get(s).add(`- lvgl.widget.refresh: ${a.id}`)))}},L={id:"progress_bar",name:"Progress Bar",category:"Advanced",supportedModes:["lvgl","direct","oepl","opendisplay"],defaults:{show_label:!0,show_percentage:!0,bar_height:15,border_width:1,color:"theme_auto",bg_color:"white",min:0,max:100,mode:"normal"},render:M,exportOpenDisplay:(t,{layout:y,page:e})=>{const o=t.props||{},r=t.title||"",a=o.show_label!==!1,s=parseInt(o.bar_height||15,10),g=o.color||"black",d=[],h=Math.round(t.y+(t.height-s));return d.push({type:"draw_rect",x:Math.round(t.x),y:h,w:Math.round(t.width),h:s,fill:null,outline:g,width:1}),d.push({type:"draw_rect",x:Math.round(t.x+2),y:h+2,w:Math.round((t.width-4)*.5),h:s-4,fill:g}),a&&r&&d.push({type:"draw_text",x:Math.round(t.x),y:Math.round(t.y),text:r,size:12,color:g}),d},exportOEPL:(t,{layout:y,page:e})=>{const o=t.props||{},r=(t.entity_id||"").trim(),a=t.title||"",s=o.show_label!==!1,g=o.show_percentage!==!1,d=parseInt(o.bar_height||15,10),h=o.color||"black",c=[],p=v.toHATemplate(r,{precision:0,isNumeric:!0});s&&a&&c.push({type:"text",value:a,x:Math.round(t.x),y:Math.round(t.y),size:12,color:h,anchor:"lt"}),g&&c.push({type:"text",value:`${p}%`,x:Math.round(t.x+t.width),y:Math.round(t.y),size:12,color:h,align:"right",anchor:"rt"});const u=Math.round(t.y+(t.height-d));return c.push({type:"progress",x_start:Math.round(t.x),y_start:u,x_end:Math.round(t.x+t.width),y_end:Math.round(u+d),value:p,color:h,outline:h,fill:h,width:1}),c},exportLVGL:C,export:S,onExportNumericSensors:T};export{L as default};

const R=(t,o,{getColorStyle:e})=>{const n=o.props||{},i=n.layout||"horizontal",a=Math.min(7,Math.max(1,parseInt(n.days,10)||5)),l=parseInt(n.icon_size,10)||32,f=parseInt(n.temp_font_size,10)||14,p=parseInt(n.day_font_size,10)||12,s=n.show_high_low!==!1,r=(n.font_family||"Roboto")+", sans-serif",y=typeof n.precision=="number"&&!isNaN(n.precision)?n.precision:1,g=n.color||"theme_auto",m=e(g);t.style.color=m;const c=[{code:"F0599",condition:"sunny"},{code:"F0595",condition:"partlycloudy"},{code:"F0597",condition:"rainy"},{code:"F0590",condition:"cloudy"},{code:"F0595",condition:"partlycloudy"}],w=[{high:24,low:18},{high:20,low:14},{high:22,low:15},{high:19,low:13},{high:18,low:12},{high:21,low:15},{high:23,low:16}];if(t.innerHTML="",t.style.display="flex",t.style.flexDirection=i==="vertical"?"column":"row",t.style.alignItems="center",t.style.justifyContent="center",t.style.gap=i==="vertical"?"4px":"0px",t.style.overflow="hidden",t.style.padding="4px",t.style.boxSizing="border-box",t.style.backgroundColor=e(n.background_color||"transparent"),n.show_border!==!1){const u=n.border_width!==void 0?n.border_width:1,d=e(n.border_color||g);t.style.border=`${u}px solid ${d}`}else t.style.border="none";const $=o.width-(t.style.border!=="none"?parseInt(n.border_width||1)*2:0)-8,b=o.height-(t.style.border!=="none"?parseInt(n.border_width||1)*2:0)-8,U=i==="horizontal"?Math.floor($/a):$,M=i==="vertical"?Math.floor(b/a):b;o.entity_id||n.weather_entity;for(let u=0;u<a;u++){const d=document.createElement("div");d.style.display="flex",d.style.flexDirection="column",d.style.alignItems="center",d.style.justifyContent="center",d.style.width=`${U}px`,d.style.minHeight=i==="vertical"?`${M}px`:"100%",d.style.color=m,d.style.fontFamily=r;let S=null,N=null,A=null;if(window.AppState&&window.AppState.entityStates){const h=window.AppState.entityStates[`sensor.weather_forecast_day_${u}_condition`],T=window.AppState.entityStates[`sensor.weather_forecast_day_${u}_high`],D=window.AppState.entityStates[`sensor.weather_forecast_day_${u}_low`];h&&h.state&&h.state!=="unknown"&&(S=h.state.toLowerCase()),T&&T.state&&T.state!=="unknown"&&(N=parseFloat(T.state)),D&&D.state&&D.state!=="unknown"&&(A=parseFloat(D.state))}const x=document.createElement("div");if(x.style.fontSize=`${p}px`,x.style.fontWeight="400",x.style.marginBottom="2px",u===0)x.textContent="Today";else{const h=new Date;h.setDate(h.getDate()+u),x.textContent=h.toLocaleDateString(void 0,{weekday:"short"})}d.appendChild(x);const F=document.createElement("div");let C="F0590";const P=S||c[u%c.length].condition,E=[{code:"F0594",condition:"clear-night"},{code:"F0590",condition:"cloudy"},{code:"F0026",condition:"exceptional"},{code:"F0591",condition:"fog"},{code:"F0592",condition:"hail"},{code:"F0593",condition:"lightning"},{code:"F067E",condition:"lightning-rainy"},{code:"F0595",condition:"partlycloudy"},{code:"F0596",condition:"pouring"},{code:"F0597",condition:"rainy"},{code:"F0598",condition:"snowy"},{code:"F067F",condition:"snowy-rainy"},{code:"F0599",condition:"sunny"},{code:"F059D",condition:"windy"},{code:"F059E",condition:"windy-variant"}].find(h=>h.condition===P);E&&(C=E.code);const W=983040+parseInt(C.slice(1),16);F.innerText=String.fromCodePoint(W),F.style.fontSize=`${l}px`,F.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, sans-serif",F.style.lineHeight="1.1",d.appendChild(F);const I=document.createElement("div");I.style.fontSize=`${f}px`,I.style.fontWeight="400";const v=isNaN(N)?w[u%w.length].high:N,k=isNaN(A)?w[u%w.length].low:A,H=h=>typeof h!="number"||isNaN(h)?"--":h.toFixed(y),z=(n.temp_unit||"C")==="F"?"°F":"°C";s?I.textContent=`${H(v)}${z}/${H(k)}${z}`:I.textContent=`${H(v)}${z}`,d.appendChild(I),t.appendChild(d)}},O=(t,o)=>{const{lines:e,addFont:n,getColorConst:i,addDitherMask:a,sanitize:l,getCondProps:f,getConditionCheck:p,isEpaper:s}=o,r=t.props||{},y=t.entity_id||r.weather_entity||"weather.forecast_home",g=r.layout||"horizontal",m=r.show_high_low!==!1,c=parseInt(String(r.day_font_size||12),10),w=parseInt(String(r.temp_font_size||14),10),$=parseInt(String(r.icon_size||32),10),b=r.font_family||"Roboto",U=r.color||"theme_auto",M=i(U),d=(r.temp_unit||"C")==="F"?"°F":"°C",S=typeof r.precision=="number"&&!isNaN(r.precision)?r.precision:1,N=n(b,700,c),A=n(b,400,w),x=n("Material Design Icons",400,$);e.push(`        // widget:weather_forecast id:${t.id} type:weather_forecast x:${t.x} y:${t.y} w:${t.width} h:${t.height} weather_entity:"${y}" layout:${g} show_high_low:${m} day_font_size:${c} temp_font_size:${w} icon_size:${$} font_family:"${b}" color:${U} precision:${S} ${f(t)}`);const F=p(t);F&&e.push(`        ${F}`),e.push("        {"),e.push("          static std::map<std::string, const char*> weather_icons = {"),e.push('            {"clear-night", "\\U000F0594"}, {"cloudy", "\\U000F0590"},'),e.push('            {"exceptional", "\\U000F0026"}, {"fog", "\\U000F0591"},'),e.push('            {"hail", "\\U000F0592"}, {"lightning", "\\U000F0593"},'),e.push('            {"lightning-rainy", "\\U000F067E"}, {"partlycloudy", "\\U000F0595"},'),e.push('            {"pouring", "\\U000F0596"}, {"rainy", "\\U000F0597"},'),e.push('            {"snowy", "\\U000F0598"}, {"snowy-rainy", "\\U000F067F"},'),e.push('            {"sunny", "\\U000F0599"}, {"windy", "\\U000F059D"},'),e.push('            {"windy-variant", "\\U000F059E"}'),e.push("          };"),e.push("          auto get_icon = [&](const std::string& cond_val) -> const char* {"),e.push('            return weather_icons.count(cond_val) ? weather_icons[cond_val] : "\\U000F0590";'),e.push("          };"),e.push("          auto get_day_name = [](int offset) -> std::string {"),e.push('            if (offset == 0) return "Today";'),e.push("            auto t = id(ha_time).now();"),e.push('            if (!t.is_valid()) return "---";'),e.push("            ESPTime future = ESPTime::from_epoch_local(t.timestamp + (offset * 86400));"),e.push('            char buf[8]; future.strftime(buf, sizeof(buf), "%a");'),e.push("            return std::string(buf);"),e.push("          };");const C=r.background_color||"transparent";if(C!=="transparent"){const _=i(C);e.push(`          it.filled_rectangle(${t.x}, ${t.y}, ${t.width}, ${t.height}, ${_});`),a(e,C,s,t.x,t.y,t.width,t.height)}if(r.show_border!==!1){const _=parseInt(r.border_width||1,10),z=r.border_color||U,h=i(z);e.push(`          for (int i = 0; i < ${_}; i++) {`),e.push(`            it.rectangle(${t.x} + i, ${t.y} + i, ${t.width} - 2 * i, ${t.height} - 2 * i, ${h});`),e.push("          }")}const E=g==="horizontal",W=E?Math.floor(t.width/5):0,I=E?0:Math.floor(t.height/5),v=Math.floor(E?W/2:t.width/2),k=c+4+$+4+w,H=Math.max(0,Math.floor((t.height-k)/2));for(let _=0;_<5;_++){const z=`weather_cond_day${_}`,h=`weather_high_day${_}`,T=`weather_low_day${_}`,D=t.x+_*W,L=t.y+_*I;e.push("          {"),e.push(`            int dx = ${D}; int dy = ${L} + ${H};`),e.push(`            it.printf(dx + ${v}, dy, id(${N}), ${M}, TextAlign::TOP_CENTER, "%s", get_day_name(${_}).c_str());`),e.push(`            std::string cond_day = id(${z}).state.c_str();`),e.push(`            it.printf(dx + ${v}, dy + ${c+4}, id(${x}), ${M}, TextAlign::TOP_CENTER, "%s", get_icon(cond_day));`),m&&(e.push(`            float high = id(${h}).state; float low = id(${T}).state;`),e.push("            char temp_buf[32];"),e.push("            if (std::isnan(high) && std::isnan(low)) {"),e.push('                sprintf(temp_buf, "--/--");'),e.push("            } else if (std::isnan(high)) {"),e.push(`                sprintf(temp_buf, "--/%.*f${d}", ${S}, low);`),e.push("            } else if (std::isnan(low)) {"),e.push(`                sprintf(temp_buf, "%.*f${d}/--", ${S}, high);`),e.push("            } else {"),e.push(`                sprintf(temp_buf, "%.*f/%.*f${d}", ${S}, high, ${S}, low);`),e.push("            }"),e.push(`            it.printf(dx + ${v}, dy + ${c+$+8}, id(${A}), ${M}, TextAlign::TOP_CENTER, "%s", temp_buf);`)),e.push("          }")}a(e,U,s,t.x,t.y,t.width,t.height),e.push("        }"),F&&e.push("        }")},j=t=>{const{lines:o,widgets:e,isLvgl:n,pendingTriggers:i}=t,a=e.filter(l=>l.type==="weather_forecast");a.length!==0&&a.forEach(l=>{for(let s=0;s<5;s++)[`sensor.weather_forecast_day_${s}_high`,`sensor.weather_forecast_day_${s}_low`,`sensor.weather_forecast_day_${s}_condition`].forEach(y=>{n&&i&&(i.has(y)||i.set(y,new Set),i.get(y).add(`- lvgl.widget.refresh: ${l.id}`))});const p=(l.props?.temp_unit||"C")==="F"?"°F":"°C";for(let s=0;s<5;s++){const r=`sensor.weather_forecast_day_${s}_high`,y=`sensor.weather_forecast_day_${s}_low`,g=`weather_high_day${s}`,m=`weather_low_day${s}`;[{eid:r,id:g,name:`Weather High Day ${s}`},{eid:y,id:m,name:`Weather Low Day ${s}`}].forEach(c=>{t.seenSensorIds&&!t.seenSensorIds.has(c.id)&&(t.seenSensorIds.size===0&&(o.push(""),o.push("# Weather Forecast Numeric Sensors")),t.seenSensorIds.add(c.id),o.push("- platform: homeassistant"),o.push(`  id: ${c.id}`),o.push(`  entity_id: ${c.eid}`),o.push(`  unit_of_measurement: '${p}'`),o.push("  internal: true"))})}})},q=t=>{const{lines:o,widgets:e}=t,n=e.filter(s=>s.type==="weather_forecast");if(n.length===0)return;const i=n[0].props||{},a=n[0].entity_id||i.weather_entity||"weather.forecast_home";let l=!1;for(let s=0;s<5;s++){const r=`weather_cond_day${s}`;t.seenSensorIds&&t.seenSensorIds.has(r)||(l||(o.push(""),o.push("# Weather Forecast Condition Sensors"),l=!0),t.seenSensorIds&&t.seenSensorIds.add(r),o.push("- platform: homeassistant"),o.push(`  id: ${r}`),o.push(`  entity_id: sensor.weather_forecast_day_${s}_condition`),o.push("  internal: true"))}o.push(""),o.push("# ============================================================================"),o.push("# HOME ASSISTANT TEMPLATE SENSORS"),o.push("# Add these template sensors to your Home Assistant configuration.yaml:"),o.push("# ============================================================================"),o.push("#"),o.push("# template:"),o.push("#   - trigger:"),o.push("#       - trigger: state"),o.push(`#         entity_id: ${a}`),o.push("#       - trigger: time_pattern"),o.push("#         hours: '/1'"),o.push("#     action:"),o.push("#       - action: weather.get_forecasts"),o.push("#         target:"),o.push(`#           entity_id: ${a}`),o.push("#         data:"),o.push("#           type: daily"),o.push("#         response_variable: forecast_data"),o.push("#     sensor:");const p=(i.temp_unit||"C")==="F"?"°F":"°C";for(let s=0;s<5;s++)o.push(`#       - name: 'Weather Forecast Day ${s} High'`),o.push(`#         unique_id: weather_forecast_day_${s}_high`),o.push(`#         unit_of_measurement: '${p}'`),o.push(`#         state: '{{ forecast_data["${a}"].forecast[${s}].temperature | default("N/A") }}'`),o.push(`#       - name: 'Weather Forecast Day ${s} Low'`),o.push(`#         unique_id: weather_forecast_day_${s}_low`),o.push(`#         unit_of_measurement: '${p}'`),o.push(`#         state: '{{ forecast_data["${a}"].forecast[${s}].templow | default("N/A") }}'`),o.push(`#       - name: 'Weather Forecast Day ${s} Condition'`),o.push(`#         unique_id: weather_forecast_day_${s}_condition`),o.push(`#         state: '{{ forecast_data["${a}"].forecast[${s}].condition | default("cloudy") }}'`);o.push("#"),o.push("# ============================================================================")},B=(t,o)=>{const{trackIcon:e,addFont:n}=o,i=t.props||{},a=parseInt(i.icon_size||32,10),l=parseInt(i.day_font_size||12,10),f=parseInt(i.temp_font_size||14,10),p=i.font_family||"Roboto";n(p,700,l),n(p,400,f),n("Material Design Icons",400,a),["F0594","F0590","F0026","F0591","F0592","F0593","F067E","F0595","F0596","F0597","F0598","F067F","F0599","F059D","F059E"].forEach(s=>e(s,a))},X={id:"weather_forecast",name:"Weather Forecast",category:"Sensors",supportedModes:["lvgl","direct"],defaults:{weather_entity:"weather.forecast_home",days:5,layout:"horizontal",icon_size:32,temp_font_size:14,day_font_size:12,color:"theme_auto",font_family:"Roboto",show_high_low:!0,show_border:!0,border_width:2,border_color:"theme_auto",background_color:"transparent",temp_unit:"C",precision:1,width:370,height:90},render:R,exportLVGL:(t,{common:o,convertColor:e,getLVGLFont:n})=>{const i=t.props||{},a=5,l=(i.layout||"horizontal")==="horizontal",f=e(i.color||"theme_auto"),p=parseInt(i.day_font_size||12,10),s=parseInt(i.icon_size||32,10),r=parseInt(i.temp_font_size||14,10),y=i.show_high_low!==!1,g=typeof i.precision=="number"&&!isNaN(i.precision)?i.precision:1,m=[];for(let c=0;c<a;c++){const w=`!lambda |-
              if (${c} == 0) return "Today";
              auto t = id(ha_time).now();
              if (!t.is_valid()) return "---";
              ESPTime future = ESPTime::from_epoch_local(t.timestamp + (${c} * 86400));
              static char buf[16];
              future.strftime(buf, sizeof(buf), "%a");
              return buf;
            `,$=`!lambda |-
              std::string c = id(weather_cond_day${c}).state;
              if (c == "clear-night") return "\\U000F0594";
              if (c == "cloudy") return "\\U000F0590";
              if (c == "exceptional") return "\\U000F0026";
              if (c == "fog") return "\\U000F0591";
              if (c == "hail") return "\\U000F0592";
              if (c == "lightning") return "\\U000F0593";
              if (c == "lightning-rainy") return "\\U000F067E";
              if (c == "partlycloudy") return "\\U000F0595";
              if (c == "pouring") return "\\U000F0596";
              if (c == "rainy") return "\\U000F0597";
              if (c == "snowy") return "\\U000F0598";
              if (c == "snowy-rainy") return "\\U000F067F";
              if (c == "sunny") return "\\U000F0599";
              if (c == "windy") return "\\U000F059D";
              if (c == "windy-variant") return "\\U000F059E";
              return "\\U000F0590";
            `,b=[{label:{align:"top_mid",text:w,text_font:n(i.font_family||"Roboto",p,700),text_color:f}},{label:{align:"center",y:0,text:$,text_font:n("Material Design Icons",s,400),text_color:f}},{label:{align:"bottom_mid",text:y?`!lambda "return str_sprintf('%.${g}f/%.${g}f', id(weather_high_day${c}).state, id(weather_low_day${c}).state).c_str();"`:`!lambda "return str_sprintf('%.${g}f', id(weather_high_day${c}).state).c_str();"`,text_font:n(i.font_family||"Roboto",r,400),text_color:f}}];m.push({obj:{width:l?100/a+"%":"100%",height:l?"100%":100/a+"%",bg_opa:"transp",border_width:0,widgets:b}})}return{obj:{...o,bg_color:e(i.background_color||"white"),bg_opa:"COVER",radius:8,border_width:i.show_border!==!1?i.border_width||1:0,border_color:e(i.border_color||i.color||"theme_auto"),layout:{type:"flex",flex_flow:l?"row":"column",flex_align_main:"space_around",flex_align_cross:"center"},widgets:m}}},exportOpenDisplay:(t,{layout:o,page:e})=>{const n=t.props||{};return{type:"draw_text",x:Math.round(t.x),y:Math.round(t.y),text:"Forecast Summary",size:n.day_font_size||12,color:n.color||"theme_auto"}},exportOEPL:(t,{layout:o,page:e})=>{const n=t.props||{};return{type:"text",value:`{{ states('${(t.entity_id||n.weather_entity||"weather.forecast_home").trim()}') }}`,x:Math.round(t.x),y:Math.round(t.y),size:n.temp_font_size||14,color:n.color||"theme_auto",anchor:"lt"}},export:O,onExportNumericSensors:j,onExportTextSensors:q,collectRequirements:B};export{X as default};

const A=(s,t,e)=>{const o=t.props||{},{getColorStyle:i}=e,d=o.show_author!==!1,u=parseInt(o.quote_font_size||18,10),l=parseInt(o.author_font_size||14,10),n=o.font_family||"Roboto",_=parseInt(o.font_weight||400,10),q=o.color||"black",g=i(q),f=o.text_align||"TOP_LEFT",$=o.italic_quote!==!1,h=[{quote:"The only way to do great work is to love what you do.",author:"Steve Jobs"},{quote:"In the middle of difficulty lies opportunity.",author:"Albert Einstein"},{quote:"Life is what happens when you're busy making other plans.",author:"John Lennon"},{quote:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt"},{quote:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{quote:"Be yourself; everyone else is already taken.",author:"Oscar Wilde"},{quote:"Two things are infinite: the universe and human stupidity.",author:"Albert Einstein"},{quote:"Be the change that you wish to see in the world.",author:"Mahatma Gandhi"}],p=o.feed_url||"https://www.brainyquote.com/link/quotebr.rss",v=(p+(t.id||"default")).split("").reduce((r,F)=>(r<<5)-r+F.charCodeAt(0),0),T=h[Math.abs(v)%h.length],b=window.location.protocol==="file:"||typeof window.hasHaBackend!="function"||!window.hasHaBackend();window.quoteCache=window.quoteCache||{},window.quoteFetchTimers=window.quoteFetchTimers||{};const y=t.id+"|"+p,m=y+"_fetching",C=t.id+"_lastUrl";if(window.quoteCache[C]!==p&&(window.quoteCache[C]=p,window.quoteFetchTimers[t.id]&&(clearTimeout(window.quoteFetchTimers[t.id]),window.quoteFetchTimers[t.id]=null)),!window.quoteCache[y]&&!window.quoteCache[m]){window.quoteCache[m]=!0;const r=p,F=y,z=m;window.quoteFetchTimers[t.id]=setTimeout(async()=>{try{let w;b?w=null:w=await(await fetch(`/api/esphome_designer/rss_proxy?url=${encodeURIComponent(r)}`)).json(),w&&w.success&&w.quote&&(window.quoteCache[F]=w.quote,window.emit&&window.EVENTS&&window.emit(window.EVENTS.STATE_CHANGED))}catch{}finally{window.quoteCache[z]=!1,window.quoteFetchTimers[t.id]=null}},500)}const x=window.quoteCache[y]||T,S=!!window.quoteCache[y];s.style.display="flex",s.style.flexDirection="column",s.style.boxSizing="border-box",s.style.padding="8px",s.style.overflow="hidden",s.style.fontFamily=n+", serif",s.style.fontWeight=String(_),s.style.color=g,s.style.lineHeight="1.3",f.includes("CENTER")?(s.style.textAlign="center",s.style.alignItems="center"):f.includes("RIGHT")?(s.style.textAlign="right",s.style.alignItems="flex-end"):(s.style.textAlign="left",s.style.alignItems="flex-start"),f.startsWith("CENTER")?s.style.justifyContent="center":f.startsWith("BOTTOM")?s.style.justifyContent="flex-end":s.style.justifyContent="flex-start",s.innerHTML="";const E=o.word_wrap!==!1,a=document.createElement("div");if(a.style.fontSize=u+"px",a.style.fontStyle=$?"italic":"normal",a.style.marginBottom="8px",E?(a.style.wordWrap="break-word",a.style.overflowWrap="break-word",a.style.whiteSpace="normal"):(a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.textOverflow="ellipsis"),a.textContent='"'+x.quote+'"',s.appendChild(a),d){const r=document.createElement("div");r.style.fontSize=l+"px",r.style.fontStyle="normal",r.style.opacity="0.8",r.textContent="â€” "+x.author,s.appendChild(r)}const c=document.createElement("div");c.style.fontSize="9px",c.style.opacity="0.5",c.style.marginTop="auto",c.style.paddingTop="4px";try{const r=new URL(p);b?c.textContent="ðŸ”Œ OFFLINE - "+r.hostname:S?c.textContent="ðŸŸ¢ "+r.hostname:c.textContent="âšª "+r.hostname}catch{c.textContent=b?"ðŸ”Œ OFFLINE":"ðŸ“° RSS Feed"}s.appendChild(c)},R=(s,t)=>{const{lines:e,addFont:o,getColorConst:i,getCondProps:d,getConditionCheck:u,getAlignX:l}=t,n=s.props||{},_=parseInt(n.quote_font_size||18,10),q=parseInt(n.author_font_size||14,10),g=n.font_family||"Roboto",f=parseInt(n.font_weight||400,10),$=n.color||"black",h=i($),p=n.text_align||"TOP_LEFT",I=n.italic_quote!==!1,v=n.word_wrap!==!1,T=`quote_${s.id.replace(/-/g,"_")}`,b=`${T}_text_global`,y=`${T}_author_global`,m=o(g,f,_,I),C=o(g,f,q,!1);e.push(`        // widget:quote_rss id:${s.id} type:quote_rss x:${s.x} y:${s.y} w:${s.width} h:${s.height} color:${$} align:${p} ${d(s)}`);const x=u(s);if(x&&e.push(`        ${x}`),e.push("        {"),e.push(`          std::string q_text = id(${b});`),n.show_author!==!1&&e.push(`          std::string q_author = id(${y});`),v)e.push(`          int max_w = ${s.width-16};`),e.push(`          int q_h = ${_+4};`),e.push('          std::string display_text = "\\"" + q_text + "\\"";'),e.push("          auto print_q = [&](esphome::font::Font *f, int line_h, bool draw) -> int {"),e.push(`            int y_curr = ${s.y+8};`),e.push("            std::string text_to_print = display_text;"),e.push('            std::string curr_line = "";'),e.push("            std::string word;"),e.push("            size_t pos = 0;"),e.push("            while (pos < text_to_print.length()) {"),e.push("                size_t space_pos = text_to_print.find(' ', pos);"),e.push("                if (space_pos == std::string::npos) {"),e.push("                    word = text_to_print.substr(pos);"),e.push("                    pos = text_to_print.length();"),e.push("                } else {"),e.push("                    word = text_to_print.substr(pos, space_pos - pos);"),e.push("                    pos = space_pos + 1;"),e.push("                }"),e.push("                if (word.empty()) continue;"),e.push('                std::string test_line = curr_line.empty() ? word : curr_line + " " + word;'),e.push("                int w_m, h_m, xoff_m, bl_m;"),e.push("                f->measure(test_line.c_str(), &w_m, &xoff_m, &bl_m, &h_m);"),e.push("                if (w_m > max_w && !curr_line.empty()) {"),e.push(`                    if (draw) it.printf(${s.x+8}, y_curr, f, ${h}, "%s", curr_line.c_str());`),e.push("                    y_curr += line_h;"),e.push("                    curr_line = word;"),e.push("                } else { curr_line = test_line; }"),e.push("            }"),e.push("            if (!curr_line.empty()) {"),e.push(`                if (draw) it.printf(${s.x+8}, y_curr, f, ${h}, "%s", curr_line.c_str());`),e.push("                y_curr += line_h;"),e.push("            }"),e.push(`            return y_curr - ${s.y+8};`),e.push("          };"),e.push(`          print_q(id(${m}), q_h, true);`),n.show_author!==!1&&e.push(`          if (!q_author.empty()) it.printf(${s.x+8}, ${s.y} + ${s.height} - ${q+4}, id(${C}), ${h}, "â€” %s", q_author.c_str());`);else{const S=l(p,s.x,s.width),E=`TextAlign::${p}`;e.push(`          it.printf(${S}, ${s.y}, id(${m}), ${h}, ${E}, "\\"%s\\"", q_text.c_str());`),n.show_author!==!1&&e.push(`          if (!q_author.empty()) it.printf(${S}, ${s.y+_+4}, id(${C}), ${h}, ${E}, "â€” %s", q_author.c_str());`)}e.push("        }"),x&&e.push("        }")},W=s=>{const{lines:t,widgets:e}=s;e.filter(o=>o.type==="quote_rss").forEach(o=>{const i=`quote_${o.id.replace(/-/g,"_")}`;t.push(`- id: ${i}_text_global`),t.push("  type: std::string"),t.push("  restore_value: true"),t.push(`  initial_value: '""'`),o.props&&o.props.show_author!==!1&&(t.push(`- id: ${i}_author_global`),t.push("  type: std::string"),t.push("  restore_value: true"),t.push(`  initial_value: '""'`))})},O=s=>{const{lines:t,widgets:e,displayId:o}=s,i=e.filter(d=>d.type==="quote_rss");if(i.length>0){t.some(u=>u.trim().startsWith("http_request:"))||(t.push(""),t.push("http_request:"),t.push("  verify_ssl: false"),t.push("  timeout: 20s"),t.push("  buffer_size: 4096")),t.push(""),t.push("# Quote RSS Widget Update Loop"),t.push("interval:");for(const u of i){const l=u.props||{},n=l.refresh_interval||"1h",_=`quote_${u.id.replace(/-/g,"_")}`,q=l.feed_url||"https://www.brainyquote.com/link/quotebr.rss",g=l.random!==!1,h=`${(l.ha_url||"http://homeassistant.local:8123").replace(/\/$/,"")}/api/esphome_designer/rss_proxy?url=${encodeURIComponent(q)}${g?"&random=true":""}`;t.push(`  - interval: ${n}`),t.push("    startup_delay: 20s"),t.push("    then:"),t.push("      - if:"),t.push("          condition:"),t.push("            wifi.connected:"),t.push("          then:"),t.push("            - http_request.get:"),t.push(`                url: "${h}"`),t.push("                capture_response: true"),t.push("                on_response:"),t.push("                  - lambda: |-"),t.push("                      if (response->status_code == 200) {"),t.push("                        DynamicJsonDocument doc(4096);"),t.push("                        DeserializationError error = deserializeJson(doc, body);"),t.push("                        if (error) {"),t.push('                          ESP_LOGW("quote", "Failed to parse JSON: %s", error.c_str());'),t.push("                          return;"),t.push("                        }"),t.push('                        if (doc.containsKey("success") && doc["success"].as<bool>()) {'),t.push('                          JsonObject q = doc["quote"];'),t.push("                          if (!q.isNull()) {"),t.push('                            std::string q_str = q["quote"].as<std::string>();'),t.push(`                            id(${_}_text_global) = q_str;`),l.show_author!==!1&&t.push(`                            id(${_}_author_global) = q["author"].as<std::string>();`),t.push('                            ESP_LOGI("quote", "Fetched quote: %s", q_str.c_str());'),t.push(`                            id(${o}).update();`),t.push("                          }"),t.push("                        }"),t.push("                      } else {"),t.push('                        ESP_LOGW("quote", "HTTP Request failed with code: %d", response->status_code);'),t.push("                      }")}t.push("")}},k=s=>{const{lines:t,widgets:e}=s,o=e.filter(i=>i.type==="quote_rss");if(o.length>0){t.push("# Quote RSS Widget Text Sensors (visible in Home Assistant)");for(const i of o){const d=i.props||{},u=`quote_${i.id.replace(/-/g,"_")}`;t.push("- platform: template"),t.push(`  id: ${u}_text_sensor`),t.push('  name: "Quote Text"'),t.push('  icon: "mdi:format-quote-close"'),t.push(`  lambda: 'return id(${u}_text_global);'`),t.push("  update_interval: 60s"),d.show_author!==!1&&(t.push("- platform: template"),t.push(`  id: ${u}_author_sensor`),t.push('  name: "Quote Author"'),t.push('  icon: "mdi:account"'),t.push(`  lambda: 'return id(${u}_author_global);'`),t.push("  update_interval: 60s"))}}},P={id:"quote_rss",name:"Quote RSS",category:"Events",defaults:{feed_url:"https://www.brainyquote.com/link/quotebr.rss",quote_font_size:18,author_font_size:14,font_family:"Roboto",font_weight:400,color:"black",text_align:"TOP_LEFT",show_author:!0,italic_quote:!0,word_wrap:!0,width:400,height:120,refresh_interval:"1h",ha_url:"http://homeassistant.local:8123",random:!0},render:A,onExportGlobals:W,onExportTextSensors:k,onExportComponents:O,export:R};export{P as default};

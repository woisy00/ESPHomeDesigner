const tt=(e,u,{getColorStyle:_})=>{const a=u.props||{},d=u.entity_id||"",$=u.title||"",s=a.value_format||"label_value";let i=parseInt(a.precision,10);isNaN(i)&&(i=2);const n=a.unit||"",f=a.label_font_size||14,h=a.value_font_size||20,m=(a.font_family||"Roboto")+", sans-serif",x=String(a.font_weight||400),z=a.italic?"italic":"normal",g=_(a.color),L=u.entity_id_2||"",R=a.separator||" ~ ";let v="--";const c=s.endsWith("_no_unit");let p=a.hide_unit||c?"":n;const N=l=>{if(window.AppState&&window.AppState.entityStates&&l){const r=window.AppState.entityStates[l];if(r&&r.state!==void 0){const I=r.formatted||String(r.state);r.state;const k=I.match(/^([-+]?\d*[.,]?\d+)(.*)$/);if(k){const P=parseFloat(k[1].replace(",",".")),S=k[2]?k[2].trim():"";if(l===d&&(n===void 0||n==="")&&!a.hide_unit&&!c&&(p=S),!isNaN(P))return!isNaN(i)&&i>=0?P.toFixed(i):P.toString()}if(l===d&&(n===void 0||n==="")&&r.attributes&&r.attributes.unit_of_measurement&&!a.hide_unit&&!c&&(p=r.attributes.unit_of_measurement),c||a.hide_unit){const P=I.match(/^([-+]?\d*[.,]?\d+)/);if(P){const S=parseFloat(P[1].replace(",","."));if(!isNaN(S))return!isNaN(i)&&i>=0?S.toFixed(i):S.toString()}return I.replace(/\s*[°%]?[A-Za-z/²³]+\s*$/,"").trim()||I}return I}}return"--"},O=N(d);let F=null;L&&(F=N(L)),v=O,F!==null&&(v=`${O}${R}${F}`),p&&v.endsWith(p)&&(p="");let y=$;if(!y&&(s.startsWith("label_")||s==="value_label")&&window.AppState&&window.AppState.entityStates&&d){const l=window.AppState.entityStates[d];l&&l.attributes&&l.attributes.friendly_name?y=l.attributes.friendly_name:d&&(y=d.split(".").pop().replace(/_/g," "))}const w=a.prefix||"",b=a.postfix||"",T=`${w}${v}${p?" "+p:""}${b}`.trim();e.innerHTML="",e.style.display="flex";const E=(l,r)=>{l&&(l.includes("LEFT")?r.style.textAlign="left":l.includes("RIGHT")?r.style.textAlign="right":r.style.textAlign="center")};((l,r)=>{l.includes("LEFT")?r.style.justifyContent="flex-start":l.includes("RIGHT")?r.style.justifyContent="flex-end":r.style.justifyContent="center",l.includes("TOP")?r.style.alignItems="flex-start":l.includes("BOTTOM")?r.style.alignItems="flex-end":r.style.alignItems="center"})(a.text_align||"TOP_LEFT",e);const t=document.createElement("div");if(t.style.color=g,t.style.fontFamily=m,t.style.fontWeight=x,t.style.fontStyle=z,(s==="label_value"||s==="label_value_no_unit")&&y){t.style.display="flex",t.style.alignItems="baseline",t.style.gap="4px";const l=document.createElement("span");l.style.fontSize=`${f}px`,l.textContent=y+":";const r=document.createElement("span");r.style.fontSize=`${h}px`,r.textContent=T;const I=a.label_align||a.text_align||"TOP_LEFT";I.includes("CENTER")?t.style.justifyContent="center":I.includes("RIGHT")?t.style.justifyContent="flex-end":t.style.justifyContent="flex-start",t.appendChild(l),t.appendChild(r)}else if((s==="label_newline_value"||s==="label_newline_value_no_unit")&&y){t.style.display="flex",t.style.flexDirection="column",t.style.gap="2px",t.style.width="100%";const l=document.createElement("div");l.style.fontSize=`${f}px`,l.textContent=y,E(a.label_align||a.text_align||"TOP_LEFT",l);const r=document.createElement("div");r.style.fontSize=`${h}px`,r.textContent=T,E(a.value_align||a.text_align||"TOP_LEFT",r),t.appendChild(l),t.appendChild(r)}else if(s==="value_label"&&y){t.style.display="flex",t.style.alignItems="baseline",t.style.gap="4px";const l=document.createElement("span");l.style.fontSize=`${h}px`,l.textContent=T;const r=document.createElement("span");r.style.fontSize=`${f}px`,r.textContent=y,t.appendChild(l),t.appendChild(r)}else s==="label_only"?(t.style.fontSize=`${f}px`,t.textContent=y,E(a.text_align||"TOP_LEFT",t)):(t.style.fontSize=`${h}px`,t.textContent=T,E(a.value_align||a.text_align||"TOP_LEFT",t));e.appendChild(t)},et={id:"sensor_text",name:"Sensor Text",category:"Sensors",defaults:{entity_id:"",title:"",value_format:"label_value",label_font_size:14,value_font_size:20,unit:"",precision:2,text_align:"TOP_LEFT",font_family:"Roboto"},render:tt,exportLVGL:(e,{common:u,convertColor:_,convertAlign:a,getLVGLFont:d,formatOpacity:$})=>{const s=e.props||{};let i=(e.entity_id||"").trim();const n=(e.entity_id_2||"").trim(),f=s.value_format||"label_value";let h=parseInt(s.precision,10);(isNaN(h)||h<0)&&(h=1);const m=t=>(t||"").replace(/%/g,"%%"),x=t=>{if(s.is_local_sensor)return`id(${t||"battery_level"})`;const l=t.replace(/[^a-zA-Z0-9_]/g,"_");return t.startsWith("text_sensor.")?`id(${l}_txt)`:`id(${l})`};if(!i&&!s.is_local_sensor)return null;const z=x(i),g=n?x(n):null,L=s.is_text_sensor||i&&(i.startsWith("text_sensor.")||i.startsWith("weather.")),R=n&&(s.is_text_sensor||n.startsWith("text_sensor.")||n.startsWith("weather."));let v=`!lambda |-
`;v+=`              if (${z}.has_state()${g?` && ${g}.has_state()`:""}) {
`;let c=(s.unit||"").trim();if(!c&&!s.hide_unit&&!f.endsWith("_no_unit")&&window.AppState&&window.AppState.entityStates){const t=window.AppState.entityStates[i];if(t){if(t.attributes&&t.attributes.unit_of_measurement)c=t.attributes.unit_of_measurement;else if(t.formatted){const l=t.formatted.match(/^([-+]?\d*[.,]?\d+)\s*(.*)$/);l&&l[2]&&(c=l[2].trim())}}}if(!c&&!s.hide_unit&&!f.endsWith("_no_unit")&&i){const t=i.toLowerCase();t.includes("_power")||t.includes("_watt")?c="W":t.includes("_energy")||t.includes("_kwh")?c="kWh":t.includes("_temperature")||t.includes("_temp")?c="°C":t.includes("_humidity")?c="%":t.includes("_voltage")||t.includes("_volt")?c="V":t.includes("_current")||t.includes("_amp")?c="A":t.includes("_battery")?c="%":t.includes("_pressure")||t.includes("_hpa")?c="hPa":t.includes("_speed")||t.includes("_kmh")?c="km/h":(t.includes("_percent")||t.includes("_pct"))&&(c="%")}const p=m(c),N=m(s.prefix||""),O=m(s.postfix||""),F=L?"%s":`%.${h}f`,y=g?R?"%s":`%.${h}f`:"",w=m(s.separator||" ~ ");let b=(e.title||s.title||"").trim();!b&&f.startsWith("label_")&&(b=i.split(".").pop().replace(/_/g," "));const T=L?`${z}.state.c_str()`:`${z}.state`,E=g?R?`${g}.state.c_str()`:`${g}.state`:null;let A="";return f==="label_only"?A=b:f==="label_value"||f==="label_value_no_unit"?A=`${b}: ${N}${F}${g?w+y:""}${p?" "+p:""}${O}`:f==="label_newline_value"||f==="label_newline_value_no_unit"?A=`${b}\\n${N}${F}${g?w+y:""}${p?" "+p:""}${O}`:f==="value_label"?A=`${N}${F}${g?w+y:""}${p?" "+p:""}${O} ${b}`:A=`${N}${F}${g?w+y:""}${p?" "+p:""}${O}`,v+=`                return str_sprintf("${A}", ${T}${E?`, ${E}`:""}).c_str();
`,v+=`              }
`,v+='              return "---";',{label:{...u,text:v,text_font:d(s.font_family,s.value_font_size||20,s.font_weight,s.italic),text_color:_(s.color),text_align:(a(s.text_align)||"left").replace("top_","").replace("bottom_",""),bg_color:s.bg_color&&s.bg_color!=="transparent"?_(s.bg_color):void 0,opa:$(s.opa)}}},collectRequirements:(e,{addFont:u})=>{const _=e.props||{},a=_.font_family||"Roboto",d=_.font_weight||400,$=!!_.italic;u(a,d,_.label_font_size||14,$),u(a,d,_.value_font_size||20,$)},export:(e,u)=>{const{lines:_,getColorConst:a,addFont:d,getCondProps:$,getConditionCheck:s,Utils:i}=u,n=e.props||{};let f=(e.entity_id||"").trim(),h=(e.entity_id_2||"").trim();f&&!n.is_local_sensor&&!f.includes(".")&&!f.startsWith("text_sensor.")&&(f=`sensor.${f}`),h&&!n.is_local_sensor&&!h.includes(".")&&!h.startsWith("text_sensor.")&&(h=`sensor.${h}`);const m=n.value_format||"label_value";let x=(n.unit||"").trim();if(!x&&!n.hide_unit&&!m.endsWith("_no_unit")&&window.AppState&&window.AppState.entityStates){const o=window.AppState.entityStates[f];if(o){if(o.attributes&&o.attributes.unit_of_measurement)x=o.attributes.unit_of_measurement;else if(o.formatted){const V=o.formatted.match(/^([-+]?\d*[.,]?\d+)\s*(.*)$/);V&&V[2]&&(x=V[2].trim())}}}if(!x&&!n.hide_unit&&!m.endsWith("_no_unit")&&f){const o=f.toLowerCase();o.includes("_power")||o.includes("_watt")?x="W":o.includes("_energy")||o.includes("_kwh")?x="kWh":o.includes("_temperature")||o.includes("_temp")?x="°C":o.includes("_humidity")?x="%":o.includes("_voltage")||o.includes("_volt")?x="V":o.includes("_current")||o.includes("_amp")?x="A":o.includes("_battery")?x="%":o.includes("_pressure")||o.includes("_hpa")?x="hPa":o.includes("_speed")||o.includes("_kmh")?x="km/h":(o.includes("_percent")||o.includes("_pct"))&&(x="%")}const z=n.label_font_size||14,g=n.value_font_size||20,L=n.font_family||"Roboto",R=n.font_weight||400,v=!!n.italic,c=a(n.color||(u.isDark?"white":"black")),p=n.text_align||"TOP_LEFT",N=n.separator||" ~ ",O=n.prefix||"",F=n.postfix||"";let y=parseInt(n.precision,10);(isNaN(y)||y<0)&&(y=2);const w=o=>(o||"").replace(/%/g,"%%");if(_.push(`        // widget:sensor_text id:${e.id} type:sensor_text x:${e.x} y:${e.y} w:${e.width} h:${e.height} entity:"${f}" format:"${m}" ${$(e)}`),!f&&!n.is_local_sensor){_.push("        // Sensor ID missing for this widget");return}const b=d(L,R,z,v),T=d(L,R,g,v),E=s(e);E&&_.push(`        ${E}`);const A=(o,V)=>{if(n.is_local_sensor)return`id(${o||"battery_level"})`;const B=o.replace(/[^a-zA-Z0-9_]/g,"_");return n.is_text_sensor||o.startsWith("text_sensor.")?`id(${B}_txt)`:`id(${B})`},t=A(f),l=h?A(h):null,r=n.is_text_sensor||f&&(f.startsWith("text_sensor.")||f.startsWith("weather.")),I=h&&(n.is_text_sensor||h.startsWith("text_sensor.")||h.startsWith("weather.")),k=r?"%s":`%.${y}f`,P=I?"%s":`%.${y}f`;let S=(e.title||n.title||"").trim();!S&&m.startsWith("label_")&&(S=f.split(".").pop().replace(/_/g," "));const H=n.hide_unit||m.endsWith("_no_unit")?"":w(x),q=w(O),J=w(F),K=w(N),U=o=>o?o==="CENTER"?"TextAlign::CENTER":`TextAlign::${o}`:"TextAlign::TOP_LEFT",G=U(n.label_align||p),D=U(n.value_align||p);let W=e.x,C=e.y;const Q=p.includes("CENTER"),X=p.includes("RIGHT");Q?W=Math.round(e.x+e.width/2):X&&(W=Math.round(e.x+e.width)),p.includes("BOTTOM")?C=Math.round(e.y+e.height):p.includes("TOP")||(C=Math.round(e.y+e.height/2));const j=`${q}${k}${l?K+P:""}${H?" "+H:""}${J}`,Z=r?`${t}.state.c_str()`:`${t}.state`,Y=l?I?`${l}.state.c_str()`:`${l}.state`:null,M=l?`${Z}, ${Y}`:Z;if(m==="label_only")_.push(`        it.printf(${W}, ${C}, id(${b}), ${c}, ${G}, "${S}");`);else if(m==="value_only"||m==="value_only_no_unit"||!S)_.push(`        it.printf(${W}, ${C}, id(${T}), ${c}, ${D}, "${j}", ${M});`);else if(m==="label_value"||m==="label_value_no_unit"){const o=`${S}${S.endsWith(":")?"":":"} `;if(z!==g&&p.includes("LEFT")){const V=U(p);_.push("        {"),_.push("          int w, h, xoff, bl;"),_.push(`          id(${b})->measure("${o}", &w, &xoff, &bl, &h);`),_.push(`          it.printf(${W}, ${C}, id(${b}), ${c}, ${V}, "${o}");`),_.push(`          it.printf(${W} + w, ${C}, id(${T}), ${c}, ${V}, "${j}", ${M});`),_.push("        }")}else _.push(`        it.printf(${W}, ${C}, id(${T}), ${c}, ${D}, "${o}${j}", ${M});`)}else if(m==="label_newline_value"||m==="label_newline_value_no_unit")_.push(`        it.printf(${W}, ${C}, id(${b}), ${c}, ${G}, "${S}");`),_.push(`        it.printf(${W}, ${C} + ${z+4}, id(${T}), ${c}, ${D}, "${j}", ${M});`);else if(m==="value_label"){_.push(`        it.printf(${W}, ${C}, id(${T}), ${c}, ${D}, "${j}", ${M});`);const o=Math.round(g*.6*6)+10;_.push(`        it.printf(${W} + ${o}, ${C}, id(${b}), ${c}, ${G}, "${S}");`)}E&&_.push("        }")},onExportTextSensors:e=>{const{lines:u,widgets:_}=e;if(!_)return;const a=new Set,d=new Set;for(const $ of _){if($.type!=="sensor_text")continue;const s=$.props||{},i=($.entity_id||"").trim();i.startsWith("weather.")?a.add(i):(s.is_text_sensor||i.startsWith("text_sensor."))&&d.add(i);const n=($.entity_id_2||s.entity_id_2||"").trim();n&&(n.startsWith("weather.")?a.add(n):(s.is_text_sensor||n.startsWith("text_sensor."))&&d.add(n))}if(a.size>0){let $=!1;for(const s of a){const i=s.replace(/^weather\./,"").replace(/\./g,"_").replace(/-/g,"_");e.seenSensorIds&&e.seenSensorIds.has(i)||e.seenEntityIds&&e.seenEntityIds.has(s)||($||(u.push("# Weather Entity Sensors (Detected from Sensor Text)"),$=!0),e.seenSensorIds&&e.seenSensorIds.add(i),e.seenEntityIds&&e.seenEntityIds.add(s),u.push("- platform: homeassistant"),u.push(`  id: ${i}`),u.push(`  entity_id: ${s}`),u.push("  internal: true"))}}if(d.size>0){let $=!1;for(const s of d){const i=s.replace(/[^a-zA-Z0-9_]/g,"_")+"_txt";e.seenSensorIds&&e.seenSensorIds.has(i)||e.seenEntityIds&&e.seenEntityIds.has(s)||($||(u.push("# Text Sensors (Detected from Sensor Text)"),$=!0),e.seenSensorIds&&e.seenSensorIds.add(i),e.seenEntityIds&&e.seenEntityIds.add(s),u.push("- platform: homeassistant"),u.push(`  id: ${i}`),u.push(`  entity_id: ${s}`),u.push("  internal: true"))}}},onExportNumericSensors:e=>{const{widgets:u,isLvgl:_,pendingTriggers:a}=e;if(u)for(const d of u){if(d.type!=="sensor_text")continue;const $=d.props||{};if($.is_local_sensor)continue;const s=[d.entity_id,d.entity_id_2].filter(i=>i&&i.trim());for(let i of s)i=i.trim(),!($.is_text_sensor||i.startsWith("weather.")||i.startsWith("text_sensor."))&&(i.includes(".")||(i=`sensor.${i}`),_&&a&&(a.has(i)||a.set(i,new Set),a.get(i).add(`- lvgl.widget.refresh: ${d.id}`)))}}};export{et as default};

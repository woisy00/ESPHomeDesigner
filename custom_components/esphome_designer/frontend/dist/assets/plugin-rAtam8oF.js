const k=(o,e,{getColorStyle:t})=>{const n=e.props||{},s=n.layout||"horizontal",r=Math.min(7,Math.max(1,parseInt(n.days,10)||5)),u=parseInt(n.icon_size,10)||32,c=parseInt(n.temp_font_size,10)||14,i=parseInt(n.day_font_size,10)||12,b=n.show_high_low!==!1,a=t(n.color||"black"),S=(n.font_family||"Roboto")+", sans-serif",f=[{code:"F0599",condition:"sunny"},{code:"F0595",condition:"partlycloudy"},{code:"F0597",condition:"rainy"},{code:"F0590",condition:"cloudy"},{code:"F0595",condition:"partlycloudy"}],d=["Today","Mon","Tue","Wed","Thu","Fri","Sat"],_=[{high:24,low:18},{high:20,low:14},{high:22,low:15},{high:19,low:13},{high:18,low:12},{high:21,low:15},{high:23,low:16}];if(o.innerHTML="",o.style.display="flex",o.style.flexDirection=s==="vertical"?"column":"row",o.style.alignItems="flex-start",o.style.justifyContent="flex-start",o.style.gap=s==="vertical"?"4px":"0px",o.style.overflow="hidden",o.style.padding="4px",o.style.boxSizing="border-box",o.style.backgroundColor=t(n.background_color||"transparent"),n.show_border!==!1){const l=n.border_width!==void 0?n.border_width:1,h=t(n.border_color||n.color||"black");o.style.border=`${l}px solid ${h}`}else o.style.border="none";const g=e.width-(o.style.border!=="none"?parseInt(n.border_width||1)*2:0)-8,y=e.height-(o.style.border!=="none"?parseInt(n.border_width||1)*2:0)-8,z=s==="horizontal"?Math.floor(g/r):g,F=s==="vertical"?Math.floor(y/r):y;for(let l=0;l<r;l++){const h=document.createElement("div");h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="center",h.style.justifyContent="flex-start",h.style.width=`${z}px`,h.style.minHeight=s==="vertical"?`${F}px`:"auto",h.style.color=a,h.style.fontFamily=S;const m=document.createElement("div");m.style.fontSize=`${i}px`,m.style.fontWeight="400",m.style.marginBottom="2px",m.textContent=d[l]||`D${l}`,h.appendChild(m);const w=document.createElement("div"),U=f[l%f.length],E=983040+parseInt(U.code.slice(1),16);w.innerText=String.fromCodePoint(E),w.style.fontSize=`${u}px`,w.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, sans-serif",w.style.lineHeight="1.1",h.appendChild(w);const x=document.createElement("div");x.style.fontSize=`${c}px`,x.style.fontWeight="400";const $=_[l%_.length],I=(n.temp_unit||"C")==="F"?"째F":"째C";b?x.textContent=`${$.high}${I}/${$.low}${I}`:x.textContent=`${$.high}${I}`,h.appendChild(x),o.appendChild(h)}e.entity_id||n.weather_entity},N=(o,e)=>{const{lines:t,addFont:n,getColorConst:s,addDitherMask:r,sanitize:u,getCondProps:c,getConditionCheck:i,isEpaper:b}=e,a=o.props||{},S=o.entity_id||a.weather_entity||"weather.forecast_home",f=a.layout||"horizontal",d=a.show_high_low!==!1,_=parseInt(String(a.day_font_size||12),10),g=parseInt(String(a.temp_font_size||14),10),y=parseInt(String(a.icon_size||32),10),z=a.font_family||"Roboto",F=a.color||"black",l=s(F),h=n(z,700,_),m=n(z,400,g),w=n("Material Design Icons",400,y);t.push(`        // widget:weather_forecast id:${o.id} type:weather_forecast x:${o.x} y:${o.y} w:${o.width} h:${o.height} weather_entity:"${S}" layout:${f} show_high_low:${d} day_font_size:${_} temp_font_size:${g} icon_size:${y} font_family:"${z}" color:${F} ${c(o)}`);const U=i(o);U&&t.push(`        ${U}`),t.push("        {"),t.push("          static std::map<std::string, const char*> weather_icons = {"),t.push('            {"clear-night", "\\U000F0594"}, {"cloudy", "\\U000F0590"},'),t.push('            {"exceptional", "\\U000F0026"}, {"fog", "\\U000F0591"},'),t.push('            {"hail", "\\U000F0592"}, {"lightning", "\\U000F0593"},'),t.push('            {"lightning-rainy", "\\U000F067E"}, {"partlycloudy", "\\U000F0595"},'),t.push('            {"pouring", "\\U000F0596"}, {"rainy", "\\U000F0597"},'),t.push('            {"snowy", "\\U000F0598"}, {"snowy-rainy", "\\U000F067F"},'),t.push('            {"sunny", "\\U000F0599"}, {"windy", "\\U000F059D"},'),t.push('            {"windy-variant", "\\U000F059E"}'),t.push("          };"),t.push("          auto get_icon = [&](const std::string& cond_val) -> const char* {"),t.push('            return weather_icons.count(cond_val) ? weather_icons[cond_val] : "\\U000F0590";'),t.push("          };"),t.push("          auto get_day_name = [](int offset) -> std::string {"),t.push('            if (offset == 0) return "Today";'),t.push("            auto t = id(ha_time).now();"),t.push('            if (!t.is_valid()) return "---";'),t.push("            ESPTime future = ESPTime::from_epoch_local(t.timestamp + (offset * 86400));"),t.push('            char buf[8]; future.strftime(buf, sizeof(buf), "%a");'),t.push("            return std::string(buf);"),t.push("          };");const E=a.background_color||"white";if(E!=="transparent"){const p=s(E);t.push(`          it.filled_rectangle(${o.x}, ${o.y}, ${o.width}, ${o.height}, ${p});`),r(t,E,b,o.x,o.y,o.width,o.height)}if(a.show_border!==!1){const p=parseInt(a.border_width||1,10),D=a.border_color||F,M=s(D);t.push(`          for (int i = 0; i < ${p}; i++) {`),t.push(`            it.rectangle(${o.x} + i, ${o.y} + i, ${o.width} - 2 * i, ${o.height} - 2 * i, ${M});`),t.push("          }")}const $=f==="horizontal",C=$?Math.floor(o.width/5):0,I=$?0:Math.floor(o.height/5),T=Math.floor($?C/2:o.width/2);for(let p=0;p<5;p++){const D=`weather_cond_day${p}`,M=`weather_high_day${p}`,v=`weather_low_day${p}`,R=o.x+p*C,W=o.y+p*I;t.push("          {"),t.push(`            int dx = ${R}; int dy = ${W};`),t.push(`            it.printf(dx + ${T}, dy, id(${h}), ${l}, TextAlign::TOP_CENTER, "%s", get_day_name(${p}).c_str());`),t.push(`            std::string cond_day = id(${D}).state.c_str();`),t.push(`            it.printf(dx + ${T}, dy + ${_+4}, id(${w}), ${l}, TextAlign::TOP_CENTER, "%s", get_icon(cond_day));`),d&&(t.push(`            float high = id(${M}).state; float low = id(${v}).state;`),t.push("            char temp_buf[32];"),t.push("            if (std::isnan(high) && std::isnan(low)) {"),t.push('                sprintf(temp_buf, "--/--");'),t.push("            } else if (std::isnan(high)) {"),t.push('                sprintf(temp_buf, "--/%.0f", low);'),t.push("            } else if (std::isnan(low)) {"),t.push('                sprintf(temp_buf, "%.0f/--", high);'),t.push("            } else {"),t.push('                sprintf(temp_buf, "%.0f/%.0f", high, low);'),t.push("            }"),t.push(`            it.printf(dx + ${T}, dy + ${_+y+8}, id(${m}), ${l}, TextAlign::TOP_CENTER, "%s", temp_buf);`)),t.push("          }")}r(t,F,b,o.x,o.y,o.width,o.height),t.push("        }"),U&&t.push("        }")},P=o=>{const{lines:e,widgets:t}=o;if(t.some(s=>s.type==="weather_forecast")){e.push(""),e.push("# Weather Forecast High/Low Sensors");for(let s=0;s<5;s++)e.push("- platform: homeassistant"),e.push(`  id: weather_high_day${s}`),e.push(`  entity_id: sensor.weather_forecast_day_${s}_high`),e.push("  internal: true"),e.push("- platform: homeassistant"),e.push(`  id: weather_low_day${s}`),e.push(`  entity_id: sensor.weather_forecast_day_${s}_low`),e.push("  internal: true")}},H=o=>{const{lines:e,widgets:t}=o,n=t.filter(i=>i.type==="weather_forecast");if(n.length===0)return;const s=n[0].props||{},r=n[0].entity_id||s.weather_entity||"weather.forecast_home";e.push(""),e.push("# Weather Forecast Condition Sensors");for(let i=0;i<5;i++)e.push("- platform: homeassistant"),e.push(`  id: weather_cond_day${i}`),e.push(`  entity_id: sensor.weather_forecast_day_${i}_condition`),e.push("  internal: true");e.push(""),e.push("# ============================================================================"),e.push("# HOME ASSISTANT TEMPLATE SENSORS"),e.push("# Add these template sensors to your Home Assistant configuration.yaml:"),e.push("# ============================================================================"),e.push("#"),e.push("# template:"),e.push("#   - trigger:"),e.push("#       - trigger: state"),e.push(`#         entity_id: ${r}`),e.push("#       - trigger: time_pattern"),e.push("#         hours: '/1'"),e.push("#     action:"),e.push("#       - action: weather.get_forecasts"),e.push("#         target:"),e.push(`#           entity_id: ${r}`),e.push("#         data:"),e.push("#           type: daily"),e.push("#         response_variable: forecast_data"),e.push("#     sensor:");const c=(s.temp_unit||"C")==="F"?"째F":"째C";for(let i=0;i<5;i++)e.push(`#       - name: 'Weather Forecast Day ${i} High'`),e.push(`#         unique_id: weather_forecast_day_${i}_high`),e.push(`#         unit_of_measurement: '${c}'`),e.push(`#         state: '{{ forecast_data["${r}"].forecast[${i}].temperature | default("N/A") }}'`),e.push(`#       - name: 'Weather Forecast Day ${i} Low'`),e.push(`#         unique_id: weather_forecast_day_${i}_low`),e.push(`#         unit_of_measurement: '${c}'`),e.push(`#         state: '{{ forecast_data["${r}"].forecast[${i}].templow | default("N/A") }}'`),e.push(`#       - name: 'Weather Forecast Day ${i} Condition'`),e.push(`#         unique_id: weather_forecast_day_${i}_condition`),e.push(`#         state: '{{ forecast_data["${r}"].forecast[${i}].condition | default("cloudy") }}'`);e.push("#"),e.push("# ============================================================================")},A=(o,{trackIcon:e,addFont:t})=>{const n=o.props||{},s=parseInt(n.icon_size||32,10),r=parseInt(n.day_font_size||12,10),u=parseInt(n.temp_font_size||14,10),c=n.font_family||"Roboto";t(c,700,r),t(c,400,u),t("Material Design Icons",400,s),["F0594","F0590","F0026","F0591","F0592","F0593","F067E","F0595","F0596","F0597","F0598","F067F","F0599","F059D","F059E"].forEach(i=>e(i,s))},O={id:"weather_forecast",name:"Weather Forecast",category:"Sensors",defaults:{weather_entity:"weather.forecast_home",days:5,layout:"horizontal",icon_size:32,temp_font_size:14,day_font_size:12,color:"black",font_family:"Roboto",show_high_low:!0,show_border:!1,border_width:1,border_color:"black",background_color:"white",temp_unit:"C",width:370,height:90},render:k,exportLVGL:(o,{common:e,convertColor:t,getLVGLFont:n})=>{const s=o.props||{},r=5,u=(s.layout||"horizontal")==="horizontal",c=t(s.color||"black"),i=parseInt(s.day_font_size||12,10),b=parseInt(s.icon_size||32,10),a=parseInt(s.temp_font_size||14,10),S=s.show_high_low!==!1,f=[];for(let d=0;d<r;d++){const _=`!lambda |-
              if (${d} == 0) return "Today";
              auto t = id(ha_time).now();
              if (!t.is_valid()) return "---";
              ESPTime future = ESPTime::from_epoch_local(t.timestamp + (${d} * 86400));
              static char buf[16];
              future.strftime(buf, sizeof(buf), "%a");
              return buf;
            `,g=`!lambda |-
              std::string c = id(weather_cond_day${d}).state;
              if (c == "clear-night") return "\\U000F0594";
              if (c == "cloudy") return "\\U000F0590";
              if (c == "exceptional") return "\\U000F0026";
              if (c == "fog") return "\\U000F0591";
              if (c == "hail") return "\\U000F0592";
              if (c == "lightning") return "\\U000F0593";
              if (c == "lightning-rainy") return "\\U000F067E";
              if (c == "partlycloudy") return "\\U000F0595";
              if (c == "pouring") return "\\U000F0596";
              if (c == "rainy") return "\\U000F0597";
              if (c == "snowy") return "\\U000F0598";
              if (c == "snowy-rainy") return "\\U000F067F";
              if (c == "sunny") return "\\U000F0599";
              if (c == "windy") return "\\U000F059D";
              if (c == "windy-variant") return "\\U000F059E";
              return "\\U000F0590";
            `,y=[{label:{align:"TOP_MID",text:_,text_font:n(s.font_family||"Roboto",i,700),text_color:c}},{label:{align:"CENTER",y:0,text:g,text_font:n("Material Design Icons",b,400),text_color:c}},{label:{align:"BOTTOM_MID",text:S?`!lambda "return str_sprintf('%.0f/%.0f', id(weather_high_day${d}).state, id(weather_low_day${d}).state).c_str();"`:`!lambda "return str_sprintf('%.0f', id(weather_high_day${d}).state).c_str();"`,text_font:n(s.font_family||"Roboto",a,400),text_color:c}}];f.push({obj:{width:u?100/r+"%":"100%",height:u?"100%":100/r+"%",bg_opa:"TRANSP",border_width:0,widgets:y}})}return{obj:{...e,bg_color:t(s.background_color||"white"),bg_opa:"COVER",radius:8,border_width:s.show_border!==!1?s.border_width||1:0,border_color:t(s.border_color||s.color||"black"),layout:{type:"FLEX",flex_flow:u?"ROW":"COLUMN",flex_align_main:"SPACE_AROUND",flex_align_cross:"CENTER"},widgets:f}}},export:N,onExportNumericSensors:P,onExportTextSensors:H,collectRequirements:A};export{O as default};

const I=(t,a,{getColorStyle:s})=>{const e=a.props||{};let o="F0928",l=e.size||24;const p=e.color||"theme_auto",h=e.show_dbm!==!1;let n=-45;if(!e.is_local_sensor&&a.entity_id&&window.AppState&&window.AppState.entityStates){const i=window.AppState.entityStates[a.entity_id];if(i&&i.state!==void 0){const c=parseFloat(i.state);isNaN(c)||(n=c)}}if(e.fit_icon_to_frame){const c=Math.max(8,Math.min((a.width||0)-8,(a.height||0)-8));l=Math.round(c)}n>=-50?o="F0928":n>=-60?o="F0925":n>=-75?o="F0922":n>=-100?o="F091F":o="F092B";const f=983040+parseInt(o.slice(1),16),r=String.fromCodePoint(f);if(t.innerText=r,t.style.fontSize=`${l}px`,t.style.color=s(p),t.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, -sans-serif",t.style.lineHeight="1",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.flexDirection="column",h){const i=document.createElement("div");i.style.fontSize=(e.font_size||12)+"px",i.style.marginTop="2px",i.textContent=Math.round(n)+"dB",t.appendChild(i)}},M=(t,a)=>{const{lines:s,addFont:e,getColorConst:o,addDitherMask:l,getCondProps:p,getConditionCheck:h,isEpaper:n}=a,f=t.props||{},r=(t.entity_id||"").trim(),i=parseInt(f.size||24,10),c=parseInt(f.font_size||12,10),d=f.color||"theme_auto",g=f.show_dbm!==!1,_=f.is_local_sensor!==!1,y=o(d),b=e("Material Design Icons",400,i),x=e("Roboto",400,c);let u;_?u="wifi_signal_dbm":u=r?r.replace(/[^a-zA-Z0-9_]/g,"_"):"wifi_signal_dbm",s.push(`        // widget:wifi_signal id:${t.id} type:wifi_signal x:${t.x} y:${t.y} w:${t.width} h:${t.height} entity:${r||"wifi_signal_dbm"} size:${i} font_size:${c} color:${d} show_dbm:${g} local:${_} ${p(t)}`);const m=h(t);m&&s.push(`        ${m}`),s.push("        {");const z=g?i+2+c:i,w=`(${t.height} - ${z}) / 2`,$=`${t.x} + ${t.width} / 2`,F=`${t.y} + ${w}`,S=`${t.y} + ${w} + ${i} + 2`;s.push('          const char* wifi_icon = "\\U000F092B"; // Default: wifi-strength-alert-outline'),s.push(`          if (id(${u}).has_state()) {`),s.push(`            float signal = id(${u}).state;`),s.push("            if (std::isnan(signal)) signal = -100;"),s.push('            if (signal >= -50) wifi_icon = "\\U000F0928";      // wifi-strength-4 (Excellent)'),s.push('            else if (signal >= -60) wifi_icon = "\\U000F0925"; // wifi-strength-3 (Good)'),s.push('            else if (signal >= -75) wifi_icon = "\\U000F0922"; // wifi-strength-2 (Fair)'),s.push('            else if (signal >= -100) wifi_icon = "\\U000F091F"; // wifi-strength-1 (Weak)'),s.push('            else wifi_icon = "\\U000F092B";                    // wifi-strength-alert-outline'),s.push("          }"),s.push(`          it.printf(${$}, ${F}, id(${b}), ${y}, TextAlign::TOP_CENTER, "%s", wifi_icon);`),g&&(s.push(`          if (id(${u}).has_state()) {`),s.push(`            it.printf(${$}, ${S}, id(${x}), ${y}, TextAlign::TOP_CENTER, "%.0fdB", id(${u}).state);`),s.push("          }")),l(s,d,n,t.x,t.y,t.width,t.height),s.push("        }"),m&&s.push("        }")},D={id:"wifi_signal",name:"WiFi Signal",category:"Sensors",supportedModes:["lvgl","direct"],defaults:{size:24,font_size:12,color:"theme_auto",show_dbm:!0,fit_icon_to_frame:!1,is_local_sensor:!0},render:I,exportOpenDisplay:(t,{layout:a,page:s})=>{const e=t.props||{},o=(t.entity_id||"sensor.wifi_signal").trim(),l=e.size||24,p=e.font_size||12,h=e.color||"black",n=e.show_dbm!==!1;let f=-45;if(window.AppState&&window.AppState.entityStates&&o){const c=window.AppState.entityStates[o];if(c&&c.state!==void 0){const d=parseFloat(c.state);isNaN(d)||(f=d)}}let r="wifi-strength-4";f>=-50?r="wifi-strength-4":f>=-60?r="wifi-strength-3":f>=-75?r="wifi-strength-2":f>=-100?r="wifi-strength-1":r="wifi-strength-alert-outline";const i=[{type:"draw_icon",value:r,x:Math.round(t.x+t.width/2),y:Math.round(t.y),size:l,color:h}];return n&&i.push({type:"draw_text",text:`${Math.round(f)}dB`,x:Math.round(t.x+t.width/2),y:Math.round(t.y+l+2),size:p,color:h}),i},exportOEPL:(t,{layout:a,page:s})=>{const e=t.props||{},o=(t.entity_id||"sensor.wifi_signal").trim(),l=e.size||24,p=e.font_size||12,h=e.color||"black",n=e.show_dbm!==!1,r=[{type:"icon",value:`{% set s = states('${o}') | int %}{% if s >= -50 %}wifi-strength-4{% elif s >= -60 %}wifi-strength-3{% elif s >= -75 %}wifi-strength-2{% elif s >= -100 %}wifi-strength-1{% else %}wifi-strength-alert-outline{% endif %}`,x:Math.round(t.x+t.width/2),y:Math.round(t.y),size:l,color:h,anchor:"mt"}];return n&&r.push({type:"text",value:`{{ states('${o}') }}dB`,x:Math.round(t.x+t.width/2),y:Math.round(t.y+l+2),size:p,color:h,align:"center",anchor:"mt"}),r},exportLVGL:(t,{common:a,convertColor:s,getLVGLFont:e,formatOpacity:o})=>{const l=t.props||{},p=(t.entity_id||"").trim(),n=l.is_local_sensor!==!1?"wifi_signal_dbm":p?p.replace(/[^a-zA-Z0-9_]/g,"_"):"wifi_signal_dbm",f=s(l.color||"black"),r=parseInt(l.size||24,10),i=parseInt(l.font_size||12,10),c=l.show_dbm!==!1;let d=`!lambda |-
`;d+=`          if (id(${n}).has_state()) {
`,d+=`            float sig = id(${n}).state;
`,d+=`            if (sig >= -50) return "\\U000F0928";
`,d+=`            if (sig >= -60) return "\\U000F0925";
`,d+=`            if (sig >= -75) return "\\U000F0922";
`,d+=`            if (sig >= -100) return "\\U000F091F";
`,d+=`            return "\\U000F092B";
`,d+=`          }
`,d+='          return "\\U000F092B";';const g=[{label:{width:r+10,height:r+4,align:"top_mid",text:d,text_font:e("Material Design Icons",r,400),text_color:f}}];if(c){let _=`!lambda |-
`;_+=`          if (id(${n}).has_state()) {
`,_+=`            return str_sprintf("%.0fdB", id(${n}).state).c_str();
`,_+=`          }
`,_+='          return "---dB";',g.push({label:{width:"100%",height:i+4,align:"bottom_mid",y:2,text:_,text_font:e("Roboto",i,400),text_color:f,text_align:"center"}})}return{obj:{...a,bg_opa:"transp",border_width:0,widgets:g}}},collectRequirements:(t,a)=>{const{trackIcon:s,addFont:e}=a,o=t.props||{},l=parseInt(o.size||24,10),p=parseInt(o.font_size||12,10);e("Material Design Icons",400,l),e("Roboto",400,p),["F0928","F0925","F0922","F091F","F092B"].forEach(h=>s(h,l))},export:M,onExportNumericSensors:t=>{const{lines:a,widgets:s,isLvgl:e,pendingTriggers:o,profile:l}=t;if(!s)return;let p=!1;for(const n of s){if(n.type!=="wifi_signal")continue;const r=(n.props||{}).is_local_sensor!==!1;let i=(n.entity_id||"").trim();if(r?(p=!0,i="wifi_signal_dbm"):i&&(i.includes(".")||(i=`sensor.${i}`)),!!i&&(e&&o&&(o.has(i)||o.set(i,new Set),o.get(i).add(`- lvgl.widget.refresh: ${n.id}`)),!r&&i.startsWith("sensor."))){const c=i.replace(/[^a-zA-Z0-9_]/g,"_");t.seenSensorIds&&!t.seenSensorIds.has(c)&&(t.seenSensorIds.size===0&&(a.push(""),a.push("# External WiFi Signal Sensors")),t.seenSensorIds.add(c),a.push("- platform: homeassistant"),a.push(`  id: ${c}`),a.push(`  entity_id: ${i}`),a.push("  internal: true"))}}const h=t.seenSensorIds&&t.seenSensorIds.has("wifi_signal_dbm");p&&!h&&!a.some(n=>n.includes("id: wifi_signal_dbm"))&&(t.seenSensorIds&&t.seenSensorIds.add("wifi_signal_dbm"),a.push("- platform: wifi_signal",'  name: "WiFi Signal"',"  id: wifi_signal_dbm","  update_interval: 60s"))}};export{D as default};

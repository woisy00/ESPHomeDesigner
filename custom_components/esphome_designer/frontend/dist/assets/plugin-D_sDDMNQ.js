const x=(i,e,{getColorStyle:t})=>{const o=e.props||{};let a="F0928",l=o.size||24;const c=o.color||"black",_=o.show_dbm!==!1;let n=-45;if(!o.is_local_sensor&&e.entity_id&&window.AppState&&window.AppState.entityStates){const s=window.AppState.entityStates[e.entity_id];if(s&&s.state!==void 0){const r=parseFloat(s.state);isNaN(r)||(n=r)}}if(o.fit_icon_to_frame){const r=Math.max(8,Math.min((e.width||0)-8,(e.height||0)-8));l=Math.round(r)}n>=-50?a="F0928":n>=-60?a="F0925":n>=-75?a="F0922":n>=-100?a="F091F":a="F092B";const p=983040+parseInt(a.slice(1),16),d=String.fromCodePoint(p);if(i.innerText=d,i.style.fontSize=`${l}px`,i.style.color=t(c),i.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, -sans-serif",i.style.lineHeight="1",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.flexDirection="column",_){const s=document.createElement("div");s.style.fontSize=(o.font_size||12)+"px",s.style.marginTop="2px",s.textContent=Math.round(n)+"dB",i.appendChild(s)}},D=(i,e)=>{const{lines:t,addFont:o,getColorConst:a,addDitherMask:l,getCondProps:c,getConditionCheck:_,isEpaper:n}=e,p=i.props||{},d=(i.entity_id||"").trim(),s=parseInt(p.size||24,10),r=parseInt(p.font_size||12,10),f=p.color||"black",g=p.show_dbm!==!1,h=p.is_local_sensor!==!1,$=a(f),w=o("Material Design Icons",400,s),F=o("Roboto",400,r);let u;h?u="wifi_signal_dbm":u=d?d.replace(/[^a-zA-Z0-9_]/g,"_"):"wifi_signal_dbm",t.push(`        // widget:wifi_signal id:${i.id} type:wifi_signal x:${i.x} y:${i.y} w:${i.width} h:${i.height} entity:${d||"wifi_signal_dbm"} size:${s} font_size:${r} color:${f} show_dbm:${g} local:${h} ${c(i)}`);const m=_(i);m&&t.push(`        ${m}`),t.push("        {");const S=g?s+2+r:s,b=`(${i.height} - ${S}) / 2`,y=`${i.x} + ${i.width} / 2`,I=`${i.y} + ${b}`,z=`${i.y} + ${b} + ${s} + 2`;t.push('          const char* wifi_icon = "\\U000F092B"; // Default: wifi-strength-alert-outline'),t.push(`          if (id(${u}).has_state()) {`),t.push(`            float signal = id(${u}).state;`),t.push("            if (std::isnan(signal)) signal = -100;"),t.push('            if (signal >= -50) wifi_icon = "\\U000F0928";      // wifi-strength-4 (Excellent)'),t.push('            else if (signal >= -60) wifi_icon = "\\U000F0925"; // wifi-strength-3 (Good)'),t.push('            else if (signal >= -75) wifi_icon = "\\U000F0922"; // wifi-strength-2 (Fair)'),t.push('            else if (signal >= -100) wifi_icon = "\\U000F091F"; // wifi-strength-1 (Weak)'),t.push('            else wifi_icon = "\\U000F092B";                    // wifi-strength-alert-outline'),t.push("          }"),t.push(`          it.printf(${y}, ${I}, id(${w}), ${$}, TextAlign::TOP_CENTER, "%s", wifi_icon);`),g&&(t.push(`          if (id(${u}).has_state()) {`),t.push(`            it.printf(${y}, ${z}, id(${F}), ${$}, TextAlign::TOP_CENTER, "%.0fdB", id(${u}).state);`),t.push("          }")),l(t,f,n,i.x,i.y,i.width,i.height),t.push("        }"),m&&t.push("        }")},C={id:"wifi_signal",name:"WiFi Signal",category:"Sensors",defaults:{size:24,font_size:12,color:"black",show_dbm:!0,fit_icon_to_frame:!1,is_local_sensor:!0},render:x,exportLVGL:(i,{common:e,convertColor:t,getLVGLFont:o,formatOpacity:a})=>{const l=i.props||{},c=(i.entity_id||"").trim(),n=l.is_local_sensor!==!1?"wifi_signal_dbm":c?c.replace(/[^a-zA-Z0-9_]/g,"_"):"wifi_signal_dbm",p=t(l.color||"black"),d=parseInt(l.size||24,10),s=parseInt(l.font_size||12,10),r=l.show_dbm!==!1;let f=`!lambda |-
`;f+=`          if (id(${n}).has_state()) {
`,f+=`            float sig = id(${n}).state;
`,f+=`            if (sig >= -50) return "\\U000F0928";
`,f+=`            if (sig >= -60) return "\\U000F0925";
`,f+=`            if (sig >= -75) return "\\U000F0922";
`,f+=`            if (sig >= -100) return "\\U000F091F";
`,f+=`            return "\\U000F092B";
`,f+=`          }
`,f+='          return "\\U000F092B";';const g=[{label:{width:d+10,height:d+4,align:"top_mid",text:f,text_font:o("Material Design Icons",d,400),text_color:p}}];if(r){let h=`!lambda |-
`;h+=`          if (id(${n}).has_state()) {
`,h+=`            return str_sprintf("%.0fdB", id(${n}).state).c_str();
`,h+=`          }
`,h+='          return "---dB";',g.push({label:{width:"100%",height:s+4,align:"bottom_mid",y:2,text:h,text_font:o("Roboto",s,400),text_color:p,text_align:"center"}})}return{obj:{...e,bg_opa:"transp",border_width:0,widgets:g}}},collectRequirements:(i,e)=>{const{trackIcon:t,addFont:o}=e,a=i.props||{},l=parseInt(a.size||24,10),c=parseInt(a.font_size||12,10);o("Material Design Icons",400,l),o("Roboto",400,c),["F0928","F0925","F0922","F091F","F092B"].forEach(_=>t(_,l))},export:D,onExportNumericSensors:i=>{const{lines:e,widgets:t,isLvgl:o,pendingTriggers:a,profile:l}=i;if(!t)return;let c=!1;for(const n of t){if(n.type!=="wifi_signal")continue;const d=(n.props||{}).is_local_sensor!==!1;let s=(n.entity_id||"").trim();if(d?(c=!0,s="wifi_signal_dbm"):s&&(s.includes(".")||(s=`sensor.${s}`)),!!s&&(o&&a&&(a.has(s)||a.set(s,new Set),a.get(s).add(`- lvgl.widget.refresh: ${n.id}`)),!d&&s.startsWith("sensor."))){const r=s.replace(/[^a-zA-Z0-9_]/g,"_");i.seenSensorIds&&!i.seenSensorIds.has(r)&&(i.seenSensorIds.size===0&&(e.push(""),e.push("# External WiFi Signal Sensors")),i.seenSensorIds.add(r),e.push("- platform: homeassistant"),e.push(`  id: ${r}`),e.push(`  entity_id: ${s}`),e.push("  internal: true"))}}const _=i.seenSensorIds&&i.seenSensorIds.has("wifi_signal_dbm");c&&!_&&!e.some(n=>n.includes("id: wifi_signal_dbm"))&&(i.seenSensorIds&&i.seenSensorIds.add("wifi_signal_dbm"),e.push("- platform: wifi_signal",'  name: "WiFi Signal"',"  id: wifi_signal_dbm","  update_interval: 60s"))}};export{C as default};

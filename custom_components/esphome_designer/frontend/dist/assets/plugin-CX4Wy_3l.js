import{d as Y,g as j,a as B}from"./main-C9acjiVQ.js";const Z=(t,e,{getColorStyle:s})=>{const o=e.props||{},l=e.entity_id||"",i=o.border!==!1,T=o.color||"black",v=s(T);t.style.boxSizing="border-box",t.style.backgroundColor="#ffffff",t.style.overflow="hidden",i&&(t.style.border="2px solid "+v);const F="http://www.w3.org/2000/svg",p=document.createElementNS(F,"svg");p.setAttribute("width","100%"),p.setAttribute("height","100%"),p.setAttribute("viewBox",`0 0 ${e.width} ${e.height}`),p.style.display="block",Y(p,e.width,e.height,o.x_grid,o.y_grid);const r=parseFloat(o.min_value)||0,k=parseFloat(o.max_value)||100,_=j(e.width,e.height),a=document.createElementNS(F,"polyline"),y=_.map(n=>`${n.x},${n.y}`).join(" ");a.setAttribute("points",y),a.setAttribute("fill","none"),a.setAttribute("stroke",v);const u=parseInt(o.line_thickness||3,10);a.setAttribute("stroke-width",u),a.setAttribute("stroke-linejoin","round");const h=o.line_type||"SOLID";h==="DASHED"?a.setAttribute("stroke-dasharray","5,5"):h==="DOTTED"&&a.setAttribute("stroke-dasharray","2,2"),p.appendChild(a),t.appendChild(p);const C=e.id;if(setTimeout(()=>{const n=document.getElementById("canvas"),V=n&&n.querySelector(`[data-id="${C}"]`);n&&V&&B(n,e.x,e.y,e.width,e.height,r,k,o.duration)},0),e.title){const n=document.createElement("div");n.style.position="absolute",n.style.top="2px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.fontSize="10px",n.style.color=v,n.style.backgroundColor="rgba(255,255,255,0.7)",n.style.padding="0 4px",n.style.borderRadius="2px",n.style.whiteSpace="nowrap",n.textContent=e.title,t.appendChild(n)}else if(!l){const n=document.createElement("div");n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.fontSize="10px",n.style.color="#999",n.style.backgroundColor="rgba(255,255,255,0.8)",n.style.padding="2px 6px",n.textContent="graph (No Entity)",t.appendChild(n)}},q=(t,{common:e,convertColor:s})=>{const o=t.props||{},l=(t.entity_id||"").replace(/[^a-zA-Z0-9_]/g,"_");return{lv_chart:{...e,type:"LINE",duration:o.duration||"1h",bg_color:s(o.bg_color||"white"),series:[{sensor:l,color:s(o.color||"black"),width:o.line_thickness||2}],y_min:o.min_value||0,y_max:o.max_value||100}}},U=(t,e)=>{const{lines:s,addFont:o,getColorConst:l,addDitherMask:i,getCondProps:T,getConditionCheck:v,isEpaper:F,sanitize:p}=e,r=t.props||{},k=(t.entity_id||"").trim(),_=p(t.title||""),a=r.duration||"1h",y=r.border!==!1,u=r.color||"black",h=l(u),C=r.line_type||"SOLID",n=parseInt(r.line_thickness||3,10),V=!!r.continuous,D=r.min_value||"",x=r.max_value||"",N=r.min_range||"",O=r.max_range||"",$=`graph_${t.id}`.replace(/-/g,"_"),m=o("Roboto",400,12),G=r.grid!==!1;let b=r.x_grid||"",P=r.y_grid||"";if(G){if(!b){const S=a.match(/^(\d+(?:\.\d+)?)(min|h|d)$/);if(S){const H=parseFloat(S[1]),I=S[2];let f=H/4;I==="h"?b=f>=1?`${Math.round(f)}h`:`${Math.round(f*60)}min`:I==="min"?b=`${Math.round(f)}min`:I==="d"&&(b=`${Math.round(f*24)}h`)}else b="1h"}if(!P){const S=parseFloat(D)||0,f=((parseFloat(x)||100)-S)/4,g=Math.pow(10,Math.floor(Math.log10(f))),E=f/g;let M=E<=1?g:E<=2?2*g:E<=5?5*g:10*g;P=String(M)}}s.push(`        // widget:graph id:${t.id} type:graph x:${t.x} y:${t.y} w:${t.width} h:${t.height} title:"${_}" entity:${k} local:${!!r.is_local_sensor} duration:${a} border:${y} color:${u} x_grid:${b} y_grid:${P} line_type:${C} line_thickness:${n} continuous:${V} min_value:${D} max_value:${x} min_range:${N} max_range:${O} ${T(t)}`);const W=v(t);if(W&&s.push(`        ${W}`),k){if(s.push(`        it.graph(${t.x}, ${t.y}, id(${$}));`),y&&(s.push(`        for (int i = 0; i < ${n}; i++) {`),s.push(`          it.rectangle(${t.x} + i, ${t.y} + i, ${t.width} - 2 * i, ${t.height} - 2 * i, ${h});`),s.push("        }"),i(s,u,F,t.x,t.y,t.width,t.height)),P)for(let d=1;d<4;d++){const A=Math.round(t.height*(d/4));s.push(`        for (int i = 0; i < ${t.width}; i += 4) {`),s.push(`          it.draw_pixel_at(${t.x} + i, ${t.y+A}, ${h});`),s.push("        }")}if(b)for(let d=1;d<4;d++){const A=Math.round(t.width*(d/4));s.push(`        for (int i = 0; i < ${t.height}; i += 4) {`),s.push(`          it.draw_pixel_at(${t.x+A}, ${t.y} + i, ${h});`),s.push("        }")}_&&s.push(`        it.printf(${t.x}+4, ${t.y}+2, id(${m}), ${h}, TextAlign::TOP_LEFT, "${_}");`);const S=parseFloat(D)||0,I=(parseFloat(x)||100)-S,f=4;for(let c=0;c<=f;c++){const d=c/f,A=S+I*d,R=Math.round(t.height*(1-d)),L=I>=10?"%.0f":"%.1f";s.push(`        it.printf(${t.x} - 4, ${t.y} + ${R} - 6, id(${m}), ${h}, TextAlign::TOP_RIGHT, "${L}", (float)${A});`)}let g=3600;const E=a.match(/^(\d+)([a-z]+)$/i);if(E){const c=parseInt(E[1],10),d=E[2].toLowerCase();d.startsWith("s")?g=c:d.startsWith("m")?g=c*60:d.startsWith("h")?g=c*3600:d.startsWith("d")&&(g=c*86400)}const M=2;for(let c=0;c<=M;c++){const d=c/M,A=Math.round(t.width*d);let R="TextAlign::TOP_CENTER";c===0&&(R="TextAlign::TOP_LEFT"),c===M&&(R="TextAlign::TOP_RIGHT");let L=c===M?"Now":"";if(c!==M){const z=g*(1-d);z>=3600?L=`-${(z/3600).toFixed(1)}h`:z>=60?L=`-${(z/60).toFixed(0)}m`:L=`-${z.toFixed(0)}s`}s.push(`        it.printf(${t.x} + ${A}, ${t.y} + ${t.height} + 2, id(${m}), ${h}, ${R}, "${L}");`)}}else s.push(`        it.printf(${t.x}+5, ${t.y}+5, id(${m}), ${h}, TextAlign::TOP_LEFT, "Graph (no entity)");`);W&&s.push("        }")},X=t=>{const{lines:e,widgets:s}=t,o=s.filter(l=>l.type==="graph");o.length>0&&(e.push("graph:"),o.forEach(l=>{const i=l.props||{},T=`graph_${l.id}`.replace(/-/g,"_"),v=i.duration||"1h",F=parseInt(l.width,10),p=parseInt(l.height,10),r=i.max_range?parseFloat(i.max_range):null,k=i.min_range?parseFloat(i.min_range):null,_=i.grid!==!1;let a=i.x_grid||"",y=i.y_grid||"";if(_){if(!a){const x=v.match(/^(\d+(?:\.\d+)?)(min|h|d)$/);if(x){const N=parseFloat(x[1]),O=x[2];let $=N/4;O==="h"?a=$>=1?`${Math.round($)}h`:`${Math.round($*60)}min`:O==="min"?a=`${Math.round($)}min`:O==="d"&&(a=`${Math.round($*24)}h`)}else a="1h"}if(!y){const x=parseFloat(i.min_value)||0,$=((parseFloat(i.max_value)||100)-x)/4,m=Math.pow(10,Math.floor(Math.log10($))),G=$/m;let b=G<=1?m:G<=2?2*m:G<=5?5*m:10*m;y=String(b)}}let u=(l.entity_id||"").trim();u&&!u.includes(".")&&!i.is_local_sensor&&(u=`sensor.${u}`);const h=u.replace(/[^a-zA-Z0-9_]/g,"_")||"none",C=(i.line_type||"SOLID").toUpperCase(),n=parseInt(i.line_thickness||3,10),V=i.border!==!1,D=!!i.continuous;e.push(`  - id: ${T}`),e.push(`    duration: ${v}`),e.push(`    width: ${F}`),e.push(`    height: ${p}`),e.push(`    border: ${V}`),_&&a&&e.push(`    x_grid: ${a}`),_&&y&&e.push(`    y_grid: ${y}`),e.push("    traces:"),e.push(`      - sensor: ${h}`),e.push(`        line_thickness: ${n}`),C!=="SOLID"&&e.push(`        line_type: ${C}`),D&&e.push("        continuous: true"),i.min_value!==void 0&&i.min_value!==null&&String(i.min_value).trim()!==""&&e.push(`    min_value: ${i.min_value}`),i.max_value!==void 0&&i.max_value!==null&&String(i.max_value).trim()!==""&&e.push(`    max_value: ${i.max_value}`),r!==null&&e.push(`    max_range: ${r}`),k!==null&&e.push(`    min_range: ${k}`)}),e.push(""))},J=t=>{const{widgets:e,isLvgl:s,pendingTriggers:o}=t;if(e)for(const l of e){if(l.type!=="graph")continue;let i=(l.entity_id||"").trim();const T=l.props||{};!i||T.is_local_sensor||(i.includes(".")||(i=`sensor.${i}`),s&&o&&(o.has(i)||o.set(i,new Set),o.get(i).add(`- lvgl.widget.refresh: ${l.id}`)))}},Q={id:"graph",name:"Graph / Chart",category:"Advanced",defaults:{duration:"1h",border:!0,grid:!0,color:"black",title:"",x_grid:"",y_grid:"",line_thickness:3,line_type:"SOLID",continuous:!0,min_value:"",max_value:"",min_range:"",max_range:""},render:Z,exportLVGL:q,export:U,onExportComponents:X,onExportNumericSensors:J};export{Q as default};

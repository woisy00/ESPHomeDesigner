const M=(t,d,{getColorStyle:o})=>{const i=d.props||{},l=i.color||"black";let n=i.size||32,u=i.font_size||16,e=i.label_font_size||12;const a=i.unit||"%",r=i.show_label!==!1,s=i.precision??0;let h=45;if(i.fit_icon_to_frame){const _=(d.height||60)-4;n=Math.round(_*.45),u=Math.round(_*.25),e=Math.round(_*.15),n=Math.max(8,n),u=Math.max(8,u),e=Math.max(6,e)}if(!i.is_local_sensor&&d.entity_id&&window.AppState&&window.AppState.entityStates){const f=window.AppState.entityStates[d.entity_id];if(f&&f.state!==void 0){const _=parseFloat(f.state);isNaN(_)||(h=_)}}let y;h<=30?y="F0E7A":h<=60?y="F058E":y="F058C";const x=983040+parseInt(y.slice(1),16),$=String.fromCodePoint(x);t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.style.color=o(l);const c=document.createElement("div");c.textContent=$,c.style.fontSize=`${n}px`,c.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, sans-serif",c.style.lineHeight="1",t.appendChild(c);const p=document.createElement("div");if(p.style.fontSize=`${u}px`,p.style.fontWeight="500",p.style.marginTop="2px",p.textContent=h.toFixed(s)+a,t.appendChild(p),r){const f=document.createElement("div");f.style.fontSize=`${e}px`,f.style.opacity="0.7",f.style.marginTop="1px",f.textContent="Humidity",t.appendChild(f)}},A={id:"ondevice_humidity",name:"Humidity",category:"SHT4x",supportedModes:["lvgl","direct"],defaults:{width:60,height:60,size:32,font_size:16,label_font_size:10,color:"black",unit:"%",show_label:!0,precision:0,fit_icon_to_frame:!0,is_local_sensor:!0},render:M,exportOpenDisplay:(t,{layout:d,page:o})=>{const i=t.props||{},l=(t.entity_id||"sensor.humidity").trim(),n=i.size||32,u=i.font_size||16,e=i.color||"black",a=i.unit||"%";let r=45;if(window.AppState&&window.AppState.entityStates&&l){const h=window.AppState.entityStates[l];h&&h.state&&(r=parseFloat(h.state))}let s="water-percent";return r<=30?s="water-outline":r>=70&&(s="water"),[{type:"draw_icon",value:s,x:Math.round(t.x+t.width/2),y:Math.round(t.y),size:n,color:e},{type:"draw_text",text:`${Math.round(r)}${a}`,x:Math.round(t.x+t.width/2),y:Math.round(t.y+n+2),size:u,color:e}]},exportOEPL:(t,{layout:d,page:o})=>{const i=t.props||{},l=(t.entity_id||"sensor.humidity").trim(),n=i.size||32,u=i.font_size||16,e=i.color||"black",a=i.unit||"%";return[{type:"icon",value:`{% set h = states('${l}') | float %}{% if h <= 30 %}water-outline{% elif h >= 70 %}water{% else %}water-percent{% endif %}`,x:Math.round(t.x+t.width/2),y:Math.round(t.y),size:n,color:e,anchor:"mt"},{type:"text",value:`{{ states('${l}') }}${a}`,x:Math.round(t.x+t.width/2),y:Math.round(t.y+n+2),size:u,color:e,align:"center",anchor:"mt"}]},exportLVGL:(t,{common:d,convertColor:o,getLVGLFont:i,profile:l})=>{const n=t.props||{},u=n.is_local_sensor===!0||n.is_local_sensor!==!1&&!t.entity_id;let e=(t.entity_id||"").replace(/[^a-zA-Z0-9_]/g,"_");u&&l.features&&(e=l.features.sht4x?"sht4x_humidity":l.features.sht3x?"sht3x_humidity":l.features.shtc3?"shtc3_humidity":"onboard_humidity"),e||(e="onboard_humidity");const a=o(n.color||"black"),r=parseInt(n.size||32,10),s=parseInt(n.font_size||16,10),h=parseInt(n.label_font_size||10,10),y=n.unit||"%",x=l.features&&(l.features.sht4x||l.features.sht3x||l.features.shtc3);if(!(u&&x&&e!=="onboard_humidity"||!!t.entity_id))return{obj:{...d,bg_opa:"transp",border_width:0,widgets:[{label:{width:r+10,height:r+4,align:"top_mid",text:"\\U000F058E",text_font:i("Material Design Icons",r,400),text_color:a}},{label:{width:"100%",height:s+6,align:"top_mid",y:r+2,text:`--${y}`,text_font:i("Roboto",s,400),text_color:a,text_align:"center"}},...n.show_label?[{label:{width:"100%",height:h+4,align:"bottom_mid",text:'"Humidity"',text_font:i("Roboto",h,400),text_color:a,text_align:"center",opa:"70%"}}]:[]]}};let c=`!lambda |-
`;c+=`          if (id(${e}).has_state()) {
`,c+=`            float h = id(${e}).state;
`,c+=`            if (h <= 30) return "\\U000F0E7A";
`,c+=`            if (h <= 60) return "\\U000F058E";
`,c+=`            return "\\U000F058C";
`,c+=`          }
`,c+='          return "\\U000F058E";';let p=`!lambda |-
`;p+=`          if (id(${e}).has_state()) {
`,p+=`            return str_sprintf("%.0f${y}", id(${e}).state).c_str();
`,p+=`          }
`,p+=`          return "--${y}";`;const f=[{label:{width:r+10,height:r+4,align:"top_mid",text:c,text_font:i("Material Design Icons",r,400),text_color:a}},{label:{width:"100%",height:s+6,align:"top_mid",y:r+2,text:p,text_font:i("Roboto",s,400),text_color:a,text_align:"center"}}];return n.show_label&&f.push({label:{width:"100%",height:h+4,align:"bottom_mid",text:'"Humidity"',text_font:i("Roboto",h,400),text_color:a,text_align:"center",opa:"70%"}}),{obj:{...d,bg_opa:"transp",border_width:0,widgets:f}}},collectRequirements:(t,d)=>{const{trackIcon:o,addFont:i}=d,l=t.props||{},n=parseInt(l.size||32,10),u=parseInt(l.font_size||16,10),e=parseInt(l.label_font_size||10,10);i("Material Design Icons",400,n),i("Roboto",400,u),l.show_label&&i("Roboto",400,e),["F0E7A","F058E","F058C"].forEach(a=>o(a,n))},export:(t,d)=>{const{lines:o,getColorConst:i,getCondProps:l,getConditionCheck:n,addFont:u,profile:e}=d,a=t.props||{},r=i(a.color||"black"),s=a.unit||"%",h=a.size||32,y=a.font_size||16,x=u("Material Design Icons",400,h),$=u("Roboto",400,y),c=a.is_local_sensor===!0||a.is_local_sensor!==!1&&!t.entity_id;let p=(t.entity_id||"").replace(/[^a-zA-Z0-9_]/g,"_");c&&e.features&&(p=e.features.sht4x?"sht4x_humidity":e.features.sht3x?"sht3x_humidity":e.features.shtc3?"shtc3_humidity":"onboard_humidity"),p||(p="onboard_humidity"),o.push(`        // widget:ondevice_humidity id:${t.id} type:ondevice_humidity x:${t.x} y:${t.y} w:${t.width} h:${t.height} unit:${s} local:${c} ent:${t.entity_id||""} ${l(t)}`);const f=n(t);f&&o.push(`        ${f}`);const _=`${t.x} + ${t.width} / 2`,S=a.label_font_size||10,E=h+2+y+(a.show_label?1+S:0),b=Math.max(0,Math.round((t.height-E)/2)),m=`${t.y} + ${b} + ${Math.round(h/2)}`,g=`${t.y} + ${b} + ${h} + 2`,I=`${t.y} + ${b} + ${h} + 2 + ${y} + 1`,T=e.features&&(e.features.sht4x||e.features.sht3x||e.features.shtc3),z=c&&T||!!t.entity_id;if(z?(o.push(`        if (id(${p}).has_state()) {`),o.push(`          if (id(${p}).state <= 30) {`),o.push(`            it.printf(${_}, ${m}, id(${x}), ${r}, TextAlign::CENTER, "\\U000F0E7A");`),o.push(`          } else if (id(${p}).state <= 60) {`),o.push(`            it.printf(${_}, ${m}, id(${x}), ${r}, TextAlign::CENTER, "\\U000F058E");`),o.push("          } else {"),o.push(`            it.printf(${_}, ${m}, id(${x}), ${r}, TextAlign::CENTER, "\\U000F058C");`),o.push("          }"),o.push("        } else {"),o.push(`          it.printf(${_}, ${m}, id(${x}), ${r}, TextAlign::CENTER, "\\U000F058E");`),o.push("        }")):o.push(`          it.printf(${_}, ${m}, id(${x}), ${r}, TextAlign::CENTER, "\\U000F058E");`),z?(o.push(`        if (id(${p}).has_state()) {`),o.push(`          it.printf(${_}, ${g}, id(${$}), ${r}, TextAlign::TOP_CENTER, "%.0f${s}", id(${p}).state);`),o.push("        } else {"),o.push(`          it.printf(${_}, ${g}, id(${$}), ${r}, TextAlign::TOP_CENTER, "--${s}");`),o.push("        }")):o.push(`          it.printf(${_}, ${g}, id(${$}), ${r}, TextAlign::TOP_CENTER, "--${s}");`),a.show_label){const C=u("Roboto",400,S);o.push(`        it.printf(${_}, ${I}, id(${C}), ${r}, TextAlign::TOP_CENTER, "Humidity");`)}f&&o.push("        }")},onExportNumericSensors:t=>{const{lines:d,widgets:o,isLvgl:i,pendingTriggers:l,profile:n}=t;if(!o)return;let u=!1;for(const e of o){if(e.type!=="ondevice_humidity")continue;const a=e.props||{},r=a.is_local_sensor===!0||a.is_local_sensor!==!1&&!e.entity_id;let s=(e.entity_id||"").trim();if(r?(u=!0,n.features?s=n.features.sht4x?"sht4x_humidity":n.features.sht3x?"sht3x_humidity":n.features.shtc3?"shtc3_humidity":"onboard_humidity":s="onboard_humidity"):s&&(s.includes(".")||(s=`sensor.${s}`)),!!s&&s&&(i&&l&&(l.has(s)||l.set(s,new Set),l.get(s).add(`- lvgl.widget.refresh: ${e.id}`)),!r&&s.startsWith("sensor."))){const h=s.replace(/[^a-zA-Z0-9_]/g,"_");t.seenSensorIds&&!t.seenSensorIds.has(h)&&(t.seenSensorIds.size===0&&(d.push(""),d.push("# External Humidity Sensors")),t.seenSensorIds.add(h),d.push("- platform: homeassistant"),d.push(`  id: ${h}`),d.push(`  entity_id: ${s}`),d.push("  internal: true"))}}if(u&&n.features){const e=!!n.features.sht4x,a=!!n.features.sht3x,r=!!n.features.shtc3;if(e||a||r){const s=e?"sht4x_sensor":a?"sht3x_sensor":"shtc3_sensor",h=e?"sht4x":a?"sht3xd":"shtcx",y=e?"sht4x_humidity":a?"sht3x_humidity":"shtc3_humidity",x=t.mainLines||d;t.seenSensorIds&&t.seenSensorIds.has(s)||x.some(c=>c.includes(`id: ${s}`))||(t.seenSensorIds&&(t.seenSensorIds.add(s),t.seenSensorIds.add(y)),d.push(`- platform: ${h}`,`  id: ${s}`),d.push("  humidity:",`    id: ${y}`,"    internal: true"),d.push("  update_interval: 60s"),h==="shtcx"&&!d.some(c=>c.includes("address: 0x70"))&&(d.push("    address: 0x70"),d.push("    i2c_id: bus_a")),h==="sht3xd"&&!d.some(c=>c.includes("address: 0x44"))&&d.push("    address: 0x44"))}}}};export{A as default};

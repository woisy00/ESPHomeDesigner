const C=(e,a,t)=>{const d=a.width||400,s=a.height||300;e.style.width=d+"px",e.style.height=s+"px",e.style.position="relative",e.style.backgroundColor=t.background_color||"white",e.style.color=t.text_color||"black",e.style.padding="4px",e.style.boxSizing="border-box",t.show_border!==!1&&(e.style.border=`${t.border_width||2}px solid ${t.border_color||"black"}`);const o=new Date,_=o.getDate(),p=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],m=["January","February","March","April","May","June","July","August","September","October","November","December"],i=p[o.getDay()],g=`${m[o.getMonth()]} ${o.getFullYear()}`,h=document.createElement("div");h.style.textAlign="center",h.style.padding="2px",h.style.borderBottom="1px solid "+(t.text_color||"black"),h.style.flexShrink="0";const l=document.createElement("div");l.style.fontSize=Math.min((t.font_size_date||100)*.7,80)+"px",l.style.fontWeight="100",l.style.lineHeight="0.8",l.innerText=_,h.appendChild(l);const f=document.createElement("div");f.style.fontSize=(t.font_size_day||24)+"px",f.style.fontWeight="bold",f.innerText=i,h.appendChild(f);const r=document.createElement("div");r.style.fontSize=(t.font_size_grid||14)+"px",r.innerText=g,h.appendChild(r),e.style.display="flex",e.style.flexDirection="column",e.appendChild(h);const c=document.createElement("div");c.style.display="grid",c.style.gridTemplateColumns="repeat(7, 1fr)",c.style.padding="2px",c.style.gap="1px",c.style.flexShrink="0";const w=(t.font_size_grid||14)+"px";["Mo","Tu","We","Th","Fr","Sa","Su"].forEach(u=>{const n=document.createElement("div");n.innerText=u,n.style.textAlign="center",n.style.fontWeight="bold",n.style.fontSize=w,c.appendChild(n)});const v=new Date(o.getFullYear(),o.getMonth(),1),x=new Date(o.getFullYear(),o.getMonth()+1,0).getDate();let b=v.getDay();b===0&&(b=7),b-=1;for(let u=0;u<b;u++)c.appendChild(document.createElement("div"));for(let u=1;u<=x;u++){const n=document.createElement("div");n.innerText=u,n.style.textAlign="center",n.style.fontSize=w,u===_&&(n.style.backgroundColor=t.text_color||"black",n.style.color=t.background_color||"white",n.style.borderRadius="50%",n.style.width="1.5em",n.style.height="1.5em",n.style.lineHeight="1.5em",n.style.margin="0 auto"),c.appendChild(n)}e.appendChild(c);const y=document.createElement("div");y.style.padding="5px",y.style.fontSize=(t.font_size_event||18)+"px",y.style.flexGrow="1",y.style.overflow="hidden",y.innerHTML=`
        <div style="margin-bottom:4px;"><b>${_}</b> Meeting with Team</div>
        <div><b>${Math.min(_+2,x)}</b> Dentist Appointment</div>
    `,e.appendChild(y)},A={id:"calendar",name:"Calendar",category:"Events",defaults:{entity_id:"sensor.esp_calendar_data",border_width:2,show_border:!0,border_color:"black",background_color:"white",text_color:"black",font_size_date:100,font_size_day:24,font_size_grid:14,font_size_event:18,width:335,height:340},render:(e,a)=>{const t=a.props||{};e.innerHTML="",C(e,a,t)},onExportTextSensors:e=>{const{lines:a,widgets:t}=e;if(!t)return;const d=t.filter(s=>s.type==="calendar");if(d.length!==0)for(const s of d){const o=s.props||{},_=(s.entity_id||o.entity_id||"sensor.esp_calendar_data").trim(),p=`calendar_data_${s.id}`;a.push("- platform: homeassistant"),a.push(`  id: ${p}`),a.push(`  entity_id: ${_}`),a.push("  attribute: entries"),a.push("  internal: true")}},exportLVGL:(e,{common:a,convertColor:t,getLVGLFont:d})=>{const s=e.props||{},o=t(s.text_color||"black"),_=t(s.background_color||"white"),p=Math.min(s.font_size_date||100,100),m=parseInt(s.font_size_day||24,10),i=parseInt(s.font_size_grid||14,10),g=s.font_family||"Roboto",h=p+m+i+10,l=[{label:{align:"TOP_MID",y:2,height:p+4,text:`!lambda "char buf[4]; id(ha_time).now().strftime(buf, sizeof(buf), '%d'); return buf;"`,text_font:d(g,p,100),text_color:o}},{label:{align:"TOP_MID",y:p+2,height:m+4,text:`!lambda "char buf[16]; id(ha_time).now().strftime(buf, sizeof(buf), '%A'); return buf;"`,text_font:d(g,m,700),text_color:o}},{label:{align:"TOP_MID",y:p+m+4,height:i+4,text:`!lambda "char buf[32]; id(ha_time).now().strftime(buf, sizeof(buf), '%B %Y'); return buf;"`,text_font:d(g,i,400),text_color:o}},{obj:{width:"100%",height:1,y:h,bg_color:o,border_width:0}}];return l.push({obj:{width:"100%",height:"SIZE_CONTENT",y:h+5,bg_opa:"TRANSP",border_width:0,layout:{type:"FLEX",flex_flow:"ROW_WRAP",flex_align_main:"SPACE_AROUND"},widgets:["Mo","Tu","We","Th","Fr","Sa","Su"].map(f=>({label:{text:`"${f}"`,text_font:d(g,i,700),text_color:o,width:"14%",align:"CENTER"}}))}}),l.push({label:{y:h+40,align:"TOP_MID",text:'"Calendar Grid Not Supported in LVGL Mode"',text_font:d("Roboto",12,400),text_color:"#888888"}}),{obj:{...a,bg_color:_,bg_opa:"COVER",radius:8,border_width:s.show_border!==!1?s.border_width||2:0,border_color:t(s.border_color||"black"),widgets:l}}},export:(e,a)=>{const{lines:t,addFont:d,getColorConst:s,addDitherMask:o,getCondProps:_,getConditionCheck:p,isEpaper:m}=a,i=e.props||{},g=(e.entity_id||i.entity_id||"sensor.esp_calendar_data").trim(),h=i.border_color||"black",l=i.text_color||"black",f=i.background_color||"white",r=s(l),c=s(h),w=s(f),v=i.show_border!==!1,E=parseInt(i.border_width||2,10),x=parseInt(i.font_size_date||100,10),b=parseInt(i.font_size_day||24,10),y=parseInt(i.font_size_grid||14,10),u=parseInt(i.font_size_event||18,10),n=i.font_family||"Roboto",z=d(n,100,x),D=d(n,700,b),T=d(n,400,y),$=d(n,400,u);t.push(`        // widget:calendar id:${e.id} type:calendar x:${e.x} y:${e.y} w:${e.width} h:${e.height} entity:${g} ${_(e)}`);const S=p(e);S&&t.push(`        ${S}`),t.push("        {"),t.push("          auto now = id(ha_time).now();"),t.push(`          int x = ${e.x}; int y = ${e.y}; int w = ${e.width}; int h = ${e.height};`),f!=="transparent"&&t.push(`          it.filled_rectangle(x, y, w, h, ${w});`),t.push("          // Header"),t.push(`          int headH = ${x+b+y+10};`),t.push(`          it.strftime(x + w/2, y + 2, id(${z}), ${r}, TextAlign::TOP_CENTER, "%d", now);`),t.push(`          it.strftime(x + w/2, y + ${x}, id(${D}), ${r}, TextAlign::TOP_CENTER, "%A", now);`),t.push(`          it.strftime(x + w/2, y + ${x+b}, id(${T}), ${r}, TextAlign::TOP_CENTER, "%B %Y", now);`),t.push(`          it.line(x, y + headH, x + w, y + headH, ${r});`),t.push("          // Days Grid"),t.push("          int gridY = y + headH + 5;"),t.push("          int cellW = w / 7;"),t.push('          const char* days[] = {"Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"};'),t.push("          for(int i=0; i<7; i++) {"),t.push(`            it.print(x + i*cellW + cellW/2, gridY, id(${T}), ${r}, TextAlign::TOP_CENTER, days[i]);`),t.push("          }"),t.push("          // Simple logic to find start of month"),t.push("          time_t t = now.timestamp;"),t.push("          struct tm *tm = localtime(&t);"),t.push("          tm->tm_mday = 1;"),t.push("          mktime(tm);"),t.push("          int startDay = (tm->tm_wday + 6) % 7; // 0=Mon"),t.push("          int daysInMonth = 31; // Simplified"),t.push("          if(now.month == 2) daysInMonth = (now.year % 4 == 0) ? 29 : 28;"),t.push("          else if(now.month == 4 || now.month == 6 || now.month == 9 || now.month == 11) daysInMonth = 30;"),t.push("          int r = 1; int c = startDay;"),t.push(`          int rowH = ${y+4};`),t.push("          for(int d=1; d<=daysInMonth; d++) {"),t.push("            if(d == now.day_of_month) {"),t.push(`               it.filled_circle(x + c*cellW + cellW/2, gridY + r*rowH + 6, ${Math.floor(y/1.5)}, ${r});`),t.push(`               it.printf(x + c*cellW + cellW/2, gridY + r*rowH, id(${T}), ${w}, TextAlign::TOP_CENTER, "%d", d);`),t.push("            } else {"),t.push(`               it.printf(x + c*cellW + cellW/2, gridY + r*rowH, id(${T}), ${r}, TextAlign::TOP_CENTER, "%d", d);`),t.push("            }"),t.push("            c++; if(c>6) { c=0; r++; }"),t.push("          }"),t.push("          // Events (Real Data from Sensor)"),t.push("          auto extract_time = [](const char* datetime) -> std::string {"),t.push("              std::string datetimeStr(datetime);"),t.push("              size_t pos = datetimeStr.find('T');"),t.push("              if (pos != std::string::npos && pos + 3 < datetimeStr.size()) {"),t.push("                  return datetimeStr.substr(pos + 1, 5);"),t.push("              }"),t.push('              return "";'),t.push("          };"),t.push(""),t.push("          int eventY = gridY + (r+1)*rowH + 10;"),t.push("          int max_y = y + h - 5;"),t.push(`          const int event_limit = ${i.event_limit||4};`),t.push("          "),t.push("          // Debug and parse JSON"),t.push(`          if (id(calendar_data_${e.id}).state.length() > 5 && id(calendar_data_${e.id}).state != "unknown") {`),t.push("             StaticJsonDocument<4096> doc;"),t.push(`             DeserializationError error = deserializeJson(doc, id(calendar_data_${e.id}).state);`),t.push(""),t.push("             if (!error) {"),t.push("                 JsonVariant root = doc.as<JsonVariant>();"),t.push("                 JsonArray days;"),t.push(""),t.push('                 if (root.is<JsonObject>() && root["days"].is<JsonArray>()) {'),t.push('                     days = root["days"];'),t.push("                 } else if (root.is<JsonArray>()) {"),t.push("                     days = root;"),t.push("                 }"),t.push("                 "),t.push("                 if (!days.isNull() && days.size() > 0) {"),t.push("                     int event_count = 0;"),t.push("                     // Separator line"),t.push(`                     it.filled_rectangle(x + 10, eventY - 5, w - 20, 2, ${r});`),t.push(""),t.push("                     for (JsonVariant dayEntry : days) {"),t.push("                         if (eventY > max_y || event_count >= event_limit) break;"),t.push('                         int currentDayNum = dayEntry["day"].as<int>();'),t.push(""),t.push("                         auto draw_row = [&](JsonVariant event, bool is_all_day) {"),t.push("                             if (eventY > max_y || event_count >= event_limit) return;"),t.push('                             const char* summary = event["summary"] | "No Title";'),t.push('                             const char* start = event["start"] | "";'),t.push(""),t.push("                             // Draw Day Number"),t.push(`                             it.printf(x + 10, eventY, id(${$}), ${r}, TextAlign::TOP_LEFT, "%d", currentDayNum);`),t.push("                             "),t.push("                             // Draw Summary"),t.push(`                             it.printf(x + 50, eventY, id(${$}), ${r}, TextAlign::TOP_LEFT, "%.25s", summary);`),t.push(""),t.push("                             // Draw Time"),t.push("                             if (is_all_day) {"),t.push(`                                 it.printf(x + w - 10, eventY, id(${$}), ${r}, TextAlign::TOP_RIGHT, "All Day");`),t.push("                             } else {"),t.push("                                 std::string timeStr = extract_time(start);"),t.push(`                                 it.printf(x + w - 10, eventY, id(${$}), ${r}, TextAlign::TOP_RIGHT, "%s", timeStr.c_str());`),t.push("                             }"),t.push(`                             eventY += ${u+6};`),t.push("                             event_count++;"),t.push("                         };"),t.push(""),t.push('                         if (dayEntry["all_day"].is<JsonArray>()) {'),t.push('                             for (JsonVariant event : dayEntry["all_day"].as<JsonArray>()) {'),t.push("                                 draw_row(event, true);"),t.push("                             }"),t.push("                         }"),t.push('                         if (dayEntry["other"].is<JsonArray>()) {'),t.push('                             for (JsonVariant event : dayEntry["other"].as<JsonArray>()) {'),t.push("                                 draw_row(event, false);"),t.push("                             }"),t.push("                         }"),t.push("                     }"),t.push("                 }"),t.push("             } else {"),t.push('                 ESP_LOGW("calendar", "JSON Parse Error: %s", error.c_str());'),t.push("             }"),t.push("          }"),v&&(t.push(`          for (int i = 0; i < ${E}; i++) {`),t.push(`            it.rectangle(x + i, y + i, w - 2*i, h - 2*i, ${c});`),t.push("          }")),o(t,l,m,e.x,e.y,e.width,e.height),t.push("        }"),S&&t.push("        }")}};export{A as default};

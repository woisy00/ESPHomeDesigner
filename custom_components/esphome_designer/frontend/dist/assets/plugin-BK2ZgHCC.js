const u=()=>window.location.protocol==="file:"||!window.location.hostname,x=(e,n,r)=>{const{getColorStyle:s,selected:p,profile:i}=r||{},a=n.props||{},d=(a.url||"").trim(),l=(a.path||"").replace(/^"|"$/g,"").trim(),h=!!a.invert,f=i?.displayType||"binary";let g="";if(h&&(g+="invert(1) "),f==="binary"?g+="grayscale(100%) contrast(1.5) ":f==="grayscale"&&(g+="grayscale(100%) "),e.style.boxSizing="border-box",e.style.backgroundColor="#f5f5f5",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.overflow="hidden",e.style.color="#666",e.innerText="",e.style.backgroundImage="",l){const t=l.split(/[/\\]/).pop()||l;e.innerHTML="";const y=document.createElement("img");y.style.maxWidth="100%",y.style.maxHeight="100%",y.style.objectFit="contain",y.draggable=!1,g&&(y.style.filter=g.trim()),y.onerror=()=>{const c=u()?"<br/><span style='color:#e67e22;font-size:8px;'>‚ö†Ô∏è Offline mode - preview in HA</span>":"";e.innerHTML="<div style='text-align:center;color:#666;font-size:11px;padding:8px;line-height:1.4;'>üñºÔ∏è<br/><strong>"+t+"</strong><br/><span style='color:#999;font-size:9px;'>"+(h?"(inverted) ":"")+n.width+"√ó"+n.height+"px</span>"+c+"</div>"},y.onload=()=>{if(p){const c=document.createElement("div");c.style.position="absolute",c.style.bottom="2px",c.style.right="2px",c.style.background="rgba(0,0,0,0.6)",c.style.color="white",c.style.padding="2px 4px",c.style.fontSize="8px",c.style.borderRadius="2px",c.textContent=t+" ‚Ä¢ "+n.width+"√ó"+n.height+"px",e.appendChild(c)}};let o;u()?l.match(/^[A-Za-z]:\\/)?o="file:///"+l.replace(/\\/g,"/"):l.startsWith("/config/")?o=null:o=l:o="/api/esphome_designer/image_proxy?path="+encodeURIComponent(l),o?(y.src=o,e.appendChild(y)):e.innerHTML="<div style='text-align:center;color:#666;font-size:11px;padding:8px;line-height:1.4;'>üñºÔ∏è<br/><strong>"+t+"</strong><br/><span style='color:#999;font-size:9px;'>"+(h?"(inverted) ":"")+n.width+"√ó"+n.height+"px</span><br/><span style='color:#e67e22;font-size:8px;'>‚ö†Ô∏è Preview available in Home Assistant</span></div>";return}if(d){const t=document.createElement("img");t.style.maxWidth="100%",t.style.maxHeight="100%",t.style.objectFit="contain",t.draggable=!1,g&&(t.style.filter=g.trim()),t.onerror=()=>{e.innerHTML="<div style='text-align:center;color:#666;font-size:11px;padding:8px;line-height:1.4;'>üñºÔ∏è<br/><strong>Image</strong><br/><span style='color:#999;font-size:9px;'>"+(h?"(inverted) ":"")+"Load Failed</span></div>"},t.onload=()=>{if(p){const y=d.split("/").pop(),o=document.createElement("div");o.style.position="absolute",o.style.bottom="2px",o.style.right="2px",o.style.background="rgba(0,0,0,0.6)",o.style.color="white",o.style.padding="2px 4px",o.style.fontSize="8px",o.style.borderRadius="2px",o.textContent=y,e.appendChild(o)}},t.src=d,e.appendChild(t)}else{const t=document.createElement("div");t.style.textAlign="center",t.style.color="#aaa",t.style.fontSize="11px",t.innerHTML="üñºÔ∏è<br/>Image Widget<br/><span style='font-size:9px;color:#ccc;'>Enter path in properties ‚Üí</span>",e.appendChild(t)}},m=e=>{const r=((e.props||{}).path||"").replace(/^"|"$/g,"").trim();return r?`img_${r.replace(/[^a-zA-Z0-9]/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_")}_${e.width}x${e.height}`:`img_${e.id.replace(/-/g,"_")}`},$=(e,n)=>{const{lines:r,getCondProps:s,getConditionCheck:p,profile:i}=n,a=e.props||{},d=(a.path||"").replace(/^"|"$/g,"").trim(),l=!!a.invert;if(!d)return;const h=m(e);r.push(`        // widget:image id:${e.id} type:image x:${e.x} y:${e.y} w:${e.width} h:${e.height} path:"${d}" invert:${l} ${s(e)}`);const f=p(e);f&&r.push(`        ${f}`),i?.features?.lcd||i?.name&&(i.name.includes("6-Color")||i.name.includes("Color"))?r.push(`        it.image(${e.x}, ${e.y}, id(${h}));`):l?r.push(`        it.image(${e.x}, ${e.y}, id(${h}), color_off, color_on);`):r.push(`        it.image(${e.x}, ${e.y}, id(${h}), color_on, color_off);`),f&&r.push("        }")},b=e=>{const{lines:n,widgets:r,profile:s}=e,p=r.filter(i=>i.type==="image");if(p.length>0){const i=new Set,a=[];p.forEach(d=>{const h=((d.props||{}).path||"").replace(/^"|"$/g,"").trim();if(!h)return;const f=m(d);if(i.has(f))return;i.add(f);const g=s.features?.lcd||s.name&&(s.name.includes("6-Color")||s.name.includes("Color")),t=g?"RGB565":"BINARY";a.push(`  - file: "${h}"`),a.push(`    id: ${f}`),a.push(`    type: ${t}`),a.push(`    resize: ${d.width}x${d.height}`),g||a.push("    dither: FLOYDSTEINBERG")}),a.length>0&&(n.push("image:"),n.push(...a),n.push(""))}},v={id:"image",name:"Image",category:"Graphics",supportedModes:["lvgl","direct","oepl","opendisplay"],defaults:{path:"",url:"",invert:!1,size:"native"},render:x,exportOpenDisplay:(e,{layout:n,page:r})=>{const s=e.props||{},p=(s.url||"").trim(),i=(s.path||"").replace(/^"|"$/g,"").trim();return{type:"draw_image",src:p||i||"",x:Math.round(e.x),y:Math.round(e.y),w:Math.round(e.width),h:Math.round(e.height)}},exportOEPL:(e,{layout:n,page:r})=>{const s=e.props||{},p=(s.url||"").trim(),i=(s.path||"").replace(/^"|"$/g,"").trim();return p?{type:"online_image",url:p,x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}:i?{type:"image",file:i,x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}:null},export:$,onExportComponents:b};export{v as default};

const C=(e,a,t)=>{const s=a.props||{},{getColorStyle:p}=t,l=a.entity_id||"",_=a.title||"",u=s.show_label!==!1&&s.show_label!=="false",f=s.show_percentage!==!1&&s.show_percentage!=="false",y=s.bar_height||15,d=s.border_width||1,c=s.color||"black",h=p(c);let $=50;if(window.AppState&&window.AppState.entityStates&&l){const o=window.AppState.entityStates[l],i=o&&o.state!==void 0?o.state:null;if(i!=null){const g=parseFloat(String(i).replace(/[^0-9.-]/g,""));isNaN(g)||($=Math.max(0,Math.min(100,g)))}}if(e.innerHTML="",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.gap="4px",e.style.color=h,u&&(_||f)){const o=document.createElement("div");if(o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.fontSize="12px",o.style.paddingBottom="2px",o.style.width="100%",_){const i=document.createElement("span");i.textContent=_,o.appendChild(i)}if(f){const i=document.createElement("span");i.textContent=Math.round($)+"%",o.appendChild(i)}e.appendChild(o)}const r=document.createElement("div");r.style.width="100%",r.style.height=`${y}px`,r.style.border=`${d}px solid ${h}`,r.style.borderRadius="2px",r.style.position="relative",r.style.overflow="hidden",r.style.backgroundColor=c==="white"?"#000":"#fff";const n=document.createElement("div");n.style.width=`${$}%`,n.style.height="100%",n.style.backgroundColor=h,n.style.transition="width 0.3s ease",r.appendChild(n),e.appendChild(r)},v=(e,{common:a,convertColor:t})=>{const s=e.props||{};let p=s.value||0;return e.entity_id&&(p=`!lambda "return id(${e.entity_id.replace(/[^a-zA-Z0-9_]/g,"_")}).state;"`),{bar:{...a,min_value:s.min||0,max_value:s.max||100,value:p,bg_color:t(s.bg_color||"white"),indicator:{bg_color:t(s.color)},mode:s.mode||"NORMAL"}}},S=(e,a)=>{const{lines:t,addFont:s,getColorConst:p,addDitherMask:l,getCondProps:_,getConditionCheck:u,isEpaper:f,sanitize:y}=a,d=e.props||{};let c=(e.entity_id||"").trim();const h=y(e.title||""),$=d.show_label!==!1,r=d.show_percentage!==!1,n=parseInt(d.bar_height||15,10),o=d.color||"black",i=p(o),g=s("Roboto",400,12);c&&!d.is_local_sensor&&!c.includes(".")&&(c=`sensor.${c}`),t.push(`        // widget:progress_bar id:${e.id} type:progress_bar x:${e.x} y:${e.y} w:${e.width} h:${e.height} entity:${c} title:"${h}" show_label:${$} show_pct:${r} bar_height:${n} color:${o} local:${!!d.is_local_sensor} ${_(e)}`);const b=u(e);b&&t.push(`        ${b}`);const m=d.is_local_sensor?c||"battery_level":c?c.replace(/[^a-zA-Z0-9_]/g,"_"):"";if(m){t.push(`        float val_${e.id.replace(/-/g,"_")} = id(${m}).state;`),t.push(`        if (std::isnan(val_${e.id.replace(/-/g,"_")})) val_${e.id.replace(/-/g,"_")} = 0;`),t.push(`        int pct_${e.id.replace(/-/g,"_")} = (int)val_${e.id.replace(/-/g,"_")};`),t.push(`        if (pct_${e.id.replace(/-/g,"_")} < 0) pct_${e.id.replace(/-/g,"_")} = 0;`),t.push(`        if (pct_${e.id.replace(/-/g,"_")} > 100) pct_${e.id.replace(/-/g,"_")} = 100;`),$&&h&&t.push(`        it.printf(${e.x}, ${e.y}, id(${g}), ${i}, TextAlign::TOP_LEFT, "${h}");`),r&&t.push(`        it.printf(${e.x} + ${e.width}, ${e.y}, id(${g}), ${i}, TextAlign::TOP_RIGHT, "%d%%", pct_${e.id.replace(/-/g,"_")});`);const x=e.y+(e.height-n);t.push(`        it.rectangle(${e.x}, ${x}, ${e.width}, ${n}, ${i});`),t.push(`        if (pct_${e.id.replace(/-/g,"_")} > 0) {`),t.push(`          int bar_w = (${e.width} - 4) * pct_${e.id.replace(/-/g,"_")} / 100;`),t.push(`          it.filled_rectangle(${e.x} + 2, ${x} + 2, bar_w, ${n} - 4, ${i});`),t.push("        }"),l(t,o,f,e.x,x,e.width,n)}else t.push(`        it.rectangle(${e.x}, ${e.y} + ${e.height} - ${n}, ${e.width}, ${n}, ${i});`),t.push(`        it.filled_rectangle(${e.x} + 2, ${e.y} + ${e.height} - ${n} + 2, ${e.width} / 2, ${n} - 4, ${i});`),$&&h&&t.push(`        it.printf(${e.x}, ${e.y}, id(${g}), ${i}, TextAlign::TOP_LEFT, "${h}");`);b&&t.push("        }")},A=e=>{const{lines:a,widgets:t}=e;if(!t||t.length===0)return;const s=new Set;for(const p of t){if(p.type!=="progress_bar")continue;let l=(p.entity_id||"").trim();const _=p.props||{};if(!(!l||_.is_local_sensor)&&(l.includes(".")||(l=`sensor.${l}`),!s.has(l))){s.add(l);const u=l.replace(/[^a-zA-Z0-9_]/g,"_");a.push("- platform: homeassistant"),a.push(`  id: ${u}`),a.push(`  entity_id: ${l}`),a.push("  internal: true")}}},I={id:"progress_bar",name:"Progress Bar",category:"Advanced",defaults:{show_label:!0,show_percentage:!0,bar_height:15,border_width:1,color:"black",bg_color:"white",min:0,max:100,mode:"NORMAL"},render:C,exportLVGL:v,export:S,onExportNumericSensors:A};export{I as default};

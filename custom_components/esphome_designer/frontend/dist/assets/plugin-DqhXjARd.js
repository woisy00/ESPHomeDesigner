const M=(t,a,{getColorStyle:e})=>{const l=a.props||{};let i="F0079",r=l.size||24;const p=l.color||"theme_auto",n=e(p);let s=75;if(l.fit_icon_to_frame){const _=Math.max(8,Math.min((a.width||0)-8,(a.height||0)-8));r=Math.round(_)}if(window.AppState&&window.AppState.entityStates&&a.entity_id){const d=window.AppState.entityStates[a.entity_id];if(d&&d.state!==void 0){const _=parseFloat(d.state);isNaN(_)||(s=_)}}s>=95?i="F0079":s>=85?i="F0082":s>=75?i="F0081":s>=65?i="F0080":s>=55?i="F007F":s>=45?i="F007E":s>=35?i="F007D":s>=25?i="F007C":s>=15?i="F007B":s>=5?i="F007A":i="F0083";const c=983040+parseInt(i.slice(1),16),f=String.fromCodePoint(c);t.innerText=f,t.style.fontSize=`${r}px`,t.style.color=n,t.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, -sans-serif",t.style.lineHeight="1",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.flexDirection="column";const o=document.createElement("div");o.style.fontSize=(l.font_size||12)+"px",o.style.marginTop="2px",o.textContent=Math.round(s)+"%",t.appendChild(o)},E=(t,a)=>{const{lines:e,addFont:l,getColorConst:i,addDitherMask:r,getCondProps:p,getConditionCheck:n,isEpaper:s,RECT_Y_OFFSET:c}=a,f=t.props||{},o=(t.entity_id||"").trim(),d=parseInt(f.size||24,10),_=parseInt(f.font_size||12,10);a.isDark||window.WidgetFactory?.getEffectiveDarkMode?.();const h=f.color||"theme_auto",F=i(h),m=l("Material Design Icons",400,d),x=l("Roboto",400,_);let b;if(f.is_local_sensor)b="battery_level";else{let y=o;y&&!y.includes(".")&&y!=="battery_level"&&(y=`sensor.${y}`),b=y?y.replace(/[^a-zA-Z0-9_]/g,"_"):"battery_level"}e.push(`        // widget:battery_icon id:${t.id} type:battery_icon x:${t.x} y:${t.y} w:${t.width} h:${t.height} entity:${o||"battery_level"} size:${d} font_size:${_} color:${h} local:${!!f.is_local_sensor} ${p(t)}`);const u=n(t);u&&e.push(`        ${u}`);const v=2,z=d+v+_,$=`(${t.height} - ${z}) / 2`,g=`${t.x} + ${t.width} / 2`,S=`${t.y} + ${$}`,I=`${t.y} + ${$} + ${d} + ${v}`;e.push("        {"),e.push('          const char* bat_icon = "\\U000F0082"; // Default: battery-90'),e.push("          float bat_level = 0;"),b&&(y=>a.seenSensorIds&&a.seenSensorIds.has(y)||y==="battery_level"&&a.profile?.pins?.batteryAdc)(b)&&(e.push(`          if (id(${b}).has_state()) {`),e.push(`            bat_level = id(${b}).state;`),e.push("            if (std::isnan(bat_level)) bat_level = 0;"),e.push('            if (bat_level >= 95) bat_icon = "\\U000F0079";      // battery (full)'),e.push('            else if (bat_level >= 85) bat_icon = "\\U000F0082"; // battery-90'),e.push('            else if (bat_level >= 75) bat_icon = "\\U000F0081"; // battery-80'),e.push('            else if (bat_level >= 65) bat_icon = "\\U000F0080"; // battery-70'),e.push('            else if (bat_level >= 55) bat_icon = "\\U000F007F"; // battery-60'),e.push('            else if (bat_level >= 45) bat_icon = "\\U000F007E"; // battery-50'),e.push('            else if (bat_level >= 35) bat_icon = "\\U000F007D"; // battery-40'),e.push('            else if (bat_level >= 25) bat_icon = "\\U000F007C"; // battery-30'),e.push('            else if (bat_level >= 15) bat_icon = "\\U000F007B"; // battery-20'),e.push('            else if (bat_level >= 5) bat_icon = "\\U000F007A";  // battery-10'),e.push('            else bat_icon = "\\U000F0083";                      // battery-alert (critical)'),e.push("          }")),e.push(`          it.printf(${g}, ${S}, id(${m}), ${F}, TextAlign::TOP_CENTER, "%s", bat_icon);`),e.push(`          it.printf(${g}, ${I}, id(${x}), ${F}, TextAlign::TOP_CENTER, "%.0f%%", bat_level);`);const U=t.y+(typeof c<"u"?c:0);r(e,h,s,t.x,U,t.width,t.height),e.push("        }"),u&&e.push("        }")},A={id:"battery_icon",name:"Battery",category:"Sensors",supportedModes:["lvgl","direct"],defaults:{width:60,height:60,size:36,font_size:14,color:"theme_auto"},render:M,exportOpenDisplay:(t,{layout:a,page:e})=>{const l=t.props||{},i=(t.entity_id||"sensor.battery_level").trim(),r=l.size||36,p=l.font_size||14,n=l.color||"black";let s=75;if(window.AppState&&window.AppState.entityStates&&i){const f=window.AppState.entityStates[i];if(f&&f.state!==void 0){const o=parseFloat(f.state);isNaN(o)||(s=o)}}let c="battery-80";return s>=95?c="battery":s>=85?c="battery-90":s>=75?c="battery-80":s>=65?c="battery-70":s>=55?c="battery-60":s>=45?c="battery-50":s>=35?c="battery-40":s>=25?c="battery-30":s>=15?c="battery-20":s>=5?c="battery-10":c="battery-alert",[{type:"draw_icon",value:c,x:Math.round(t.x+t.width/2),y:Math.round(t.y),size:r,color:n},{type:"draw_text",text:`${Math.round(s)}%`,x:Math.round(t.x+t.width/2),y:Math.round(t.y+r+2),size:p,color:n}]},exportOEPL:(t,{layout:a,page:e})=>{const l=t.props||{},i=(t.entity_id||"sensor.battery_level").trim(),r=l.size||36,p=l.font_size||14,n=l.color||"black";return[{type:"icon",value:`{% set b = states('${i}') | int %}{% if b >= 95 %}battery{% elif b >= 15 %}battery-{{ (b/10)|int * 10 }}{% else %}battery-alert{% endif %}`,x:Math.round(t.x+t.width/2),y:Math.round(t.y),size:r,color:n,anchor:"mt"},{type:"text",value:`{{ states('${i}') }}%`,x:Math.round(t.x+t.width/2),y:Math.round(t.y+r+2),size:p,color:n,align:"center",anchor:"mt"}]},exportLVGL:(t,{common:a,convertColor:e,getLVGLFont:l,formatOpacity:i})=>{const r=t.props||{};let p=(t.entity_id||"").trim();p&&!p.includes(".")&&(p=`sensor.${p}`);const n=r.is_local_sensor?"battery_level":p?p.replace(/[^a-zA-Z0-9_]/g,"_"):"battery_level",s=e(r.color||"black"),c=parseInt(r.size||24,10),f=parseInt(r.font_size||12,10);let o=`!lambda |-
`;o+=`          if (id(${n}).has_state()) {
`,o+=`            float lvl = id(${n}).state;
`,o+=`            if (lvl >= 95) return "\\U000F0079";
`,o+=`            if (lvl >= 85) return "\\U000F0082";
`,o+=`            if (lvl >= 75) return "\\U000F0081";
`,o+=`            if (lvl >= 65) return "\\U000F0080";
`,o+=`            if (lvl >= 55) return "\\U000F007F";
`,o+=`            if (lvl >= 45) return "\\U000F007E";
`,o+=`            if (lvl >= 35) return "\\U000F007D";
`,o+=`            if (lvl >= 25) return "\\U000F007C";
`,o+=`            if (lvl >= 15) return "\\U000F007B";
`,o+=`            if (lvl >= 5) return "\\U000F007A";
`,o+=`            return "\\U000F0083";
`,o+=`          }
`,o+='          return "\\U000F0083";';let d=`!lambda |-
`;return d+=`          if (id(${n}).has_state()) {
`,d+=`            return str_sprintf("%.0f%%", id(${n}).state).c_str();
`,d+=`          }
`,d+='          return "---%";',{obj:{...a,bg_opa:"transp",border_width:0,widgets:[{label:{width:c+10,height:c+4,align:"top_mid",text:o,text_font:l("Material Design Icons",c,400),text_color:s}},{label:{width:"100%",height:f+4,align:"bottom_mid",y:2,text:d,text_font:l("Roboto",f,400),text_color:s,text_align:"center"}}]}}},collectRequirements:(t,a)=>{const{trackIcon:e,addFont:l}=a,i=t.props||{},r=parseInt(i.size||24,10),p=parseInt(i.font_size||12,10);l("Material Design Icons",400,r),l("Roboto",400,p),["F0079","F0082","F0081","F0080","F007F","F007E","F007D","F007C","F007B","F007A","F0083"].forEach(n=>e(n,r))},export:E,onExportNumericSensors:t=>{const{lines:a,widgets:e,isLvgl:l,pendingTriggers:i}=t;if(e)for(const r of e){if(r.type!=="battery_icon")continue;const p=r.props||{};let n=(r.entity_id||"").trim();if(p.is_local_sensor?n="battery_level":n&&(n.includes(".")||(n=`sensor.${n}`)),!!n&&(l&&i&&(i.has(n)||i.set(n,new Set),i.get(n).add(`- lvgl.widget.refresh: ${r.id}`)),!p.is_local_sensor&&n.startsWith("sensor."))){const s=n.replace(/[^a-zA-Z0-9_]/g,"_");t.seenSensorIds&&!t.seenSensorIds.has(s)&&(t.seenSensorIds.size===0&&(a.push(""),a.push("# External Battery Sensors")),t.seenSensorIds.add(s),a.push("- platform: homeassistant"),a.push(`  id: ${s}`),a.push(`  entity_id: ${n}`),a.push("  internal: true"))}}}};export{A as default};

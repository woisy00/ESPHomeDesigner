const m=(e,t,{getColorStyle:l})=>{const n=t.props||{},i=n.url||n.path||"",r=!!n.invert;if(e.style.boxSizing="border-box",e.style.backgroundColor="#f5f5f5",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.overflow="hidden",e.style.color="#666",e.innerText="",e.style.backgroundImage="",i){const o=document.createElement("img");o.style.maxWidth="100%",o.style.maxHeight="100%",o.style.objectFit="contain",o.draggable=!1,r&&(o.style.filter="invert(1)"),o.onerror=()=>{e.innerHTML="<div style='text-align:center;color:#666;font-size:11px;padding:8px;line-height:1.4;'>üñºÔ∏è<br/><strong>Online Image</strong><br/><span style='color:#999;font-size:9px;'>"+(r?"(inverted) ":"")+"Load Failed</span></div>"},o.onload=()=>{const u=i.split("/").pop(),s=document.createElement("div");s.style.position="absolute",s.style.bottom="2px",s.style.right="2px",s.style.background="rgba(0,0,0,0.6)",s.style.color="white",s.style.padding="2px 4px",s.style.fontSize="8px",s.style.borderRadius="2px",s.textContent=u,e.appendChild(s)},o.src=i,e.appendChild(o)}else{const o=document.createElement("div");o.style.textAlign="center",o.style.color="#aaa",o.style.fontSize="11px",o.innerHTML="üñºÔ∏è<br/>Online Image<br/><span style='font-size:9px;color:#ccc;'>Enter URL in properties ‚Üí</span>",e.appendChild(o)}},x=(e,{common:t,convertColor:l})=>{const n=e.props||{},i=g(e);return{image:{...t,src:i,angle:n.rotation||0,pivot_x:n.pivot_x||0,pivot_y:n.pivot_y||0,image_recolor:l(n.color),image_recolor_opa:"cover"}}},g=e=>`online_img_${e.id.replace(/-/g,"_")}`,_=(e,t)=>{const{lines:l,getCondProps:n,getConditionCheck:i,profile:r}=t,o=e.props||{},u=(o.url||"").trim(),s=!!o.invert,a=o.render_mode||"Auto",c=g(e);l.push(`        // widget:${e.type} id:${e.id} x:${e.x} y:${e.y} w:${e.width} h:${e.height} url:"${u}" invert:${s} render_mode:"${a}" ${n(e)}`);const p=i(e);p&&l.push(`        ${p}`);let d="GRAYSCALE";a==="Binary"?d="BINARY":a==="Grayscale"?d="GRAYSCALE":a==="Color (RGB565)"?d="RGB565":d=r?.features?.lcd||r?.name&&(r.name.includes("6-Color")||r.name.includes("Color"))?"RGB565":"BINARY",d==="BINARY"?s?l.push(`        it.image(${e.x}, ${e.y}, id(${c}), color_off, color_on);`):l.push(`        it.image(${e.x}, ${e.y}, id(${c}), color_on, color_off);`):l.push(`        it.image(${e.x}, ${e.y}, id(${c}));`),p&&l.push("        }")},$=e=>{const{lines:t,widgets:l,profile:n}=e,i=l.filter(r=>r.type==="online_image"||r.type==="puppet");i.length>0&&(t.push("online_image:"),i.forEach(r=>{const o=r.props||{},u=(o.url||"").trim(),s=g(r);if(!u)return;let a=(o.format||"PNG").toUpperCase();a==="JPG"&&(a="JPEG");const c=o.render_mode||"Auto";let p="GRAYSCALE";c==="Binary"?p="BINARY":c==="Grayscale"?p="GRAYSCALE":c==="Color (RGB565)"?p="RGB565":p=n.features?.lcd||n.name&&(n.name.includes("6-Color")||n.name.includes("Color"))?"RGB565":"BINARY";let d=o.update_interval||"never";if(o.interval_s&&o.interval_s>0&&(d=`${o.interval_s}s`),t.push(`  - id: ${s}`),t.push(`    url: "${u}"`),t.push(`    format: ${a}`),t.push(`    type: ${p}`),p!=="BINARY"){const y=parseInt(r.width,10),f=parseInt(r.height,10);t.push(`    resize: ${y}x${f}`)}t.push(`    update_interval: ${d}`);const h=n.features?.lcd?"my_display":"epaper_display";e.isLvgl?(t.push("    on_download_finished:"),t.push("      then:"),t.push(`        - lvgl.widget.refresh: ${r.id}`),t.push("    on_error:"),t.push("      then:"),t.push(`        - lvgl.widget.refresh: ${r.id}`)):(t.push("    on_download_finished:"),t.push("      then:"),t.push(`        - component.update: ${h}`),t.push("    on_error:"),t.push("      then:"),t.push(`        - component.update: ${h}`))}),t.push(""))},v={id:"online_image",name:"Online Image",category:"Graphics",supportedModes:["lvgl","direct","oepl","opendisplay"],defaults:{url:"",invert:!1,update_interval:"1h",rotation:0,color:"black"},render:m,exportOpenDisplay:(e,{layout:t,page:l})=>({type:"draw_image",src:((e.props||{}).url||"").trim()||"",x:Math.round(e.x),y:Math.round(e.y),w:Math.round(e.width),h:Math.round(e.height)}),exportOEPL:(e,{layout:t,page:l})=>{const i=((e.props||{}).url||"").trim();return i?{type:"online_image",url:i,x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}:null},exportLVGL:x,export:_,onExportComponents:$};export{v as default};

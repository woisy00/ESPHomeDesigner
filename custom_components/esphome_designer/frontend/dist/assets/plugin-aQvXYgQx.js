import{d as Y,g as j,a as B}from"./main-4KF2zEyr.js";const q=(t,e,{getColorStyle:s})=>{const c=e.props||{},h=e.entity_id||"",i=c.border!==!1,V=c.color||"black",b=s(V);t.style.boxSizing="border-box",t.style.backgroundColor="#ffffff",t.style.overflow="hidden",i&&(t.style.border="2px solid "+b);const A="http://www.w3.org/2000/svg",p=document.createElementNS(A,"svg");p.setAttribute("width","100%"),p.setAttribute("height","100%"),p.setAttribute("viewBox",`0 0 ${e.width} ${e.height}`),p.style.display="block",Y(p,e.width,e.height,c.x_grid,c.y_grid);const a=parseFloat(c.min_value)||0,S=parseFloat(c.max_value)||100,m=j(e.width,e.height),o=document.createElementNS(A,"polyline"),x=m.map(n=>`${n.x},${n.y}`).join(" ");o.setAttribute("points",x),o.setAttribute("fill","none"),o.setAttribute("stroke",b);const E=parseInt(c.line_thickness||3,10);o.setAttribute("stroke-width",E),o.setAttribute("stroke-linejoin","round");const d=c.line_type||"SOLID";d==="DASHED"?o.setAttribute("stroke-dasharray","5,5"):d==="DOTTED"&&o.setAttribute("stroke-dasharray","2,2"),p.appendChild(o),t.appendChild(p);const C=e.id;if(setTimeout(()=>{const n=document.getElementById("canvas"),D=n&&n.querySelector(`[data-id="${C}"]`);n&&D&&B(n,e.x,e.y,e.width,e.height,a,S,c.duration)},0),e.title){const n=document.createElement("div");n.style.position="absolute",n.style.top="2px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.fontSize="10px",n.style.color=b,n.style.backgroundColor="rgba(255,255,255,0.7)",n.style.padding="0 4px",n.style.borderRadius="2px",n.style.whiteSpace="nowrap",n.textContent=e.title,t.appendChild(n)}else if(!h){const n=document.createElement("div");n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.fontSize="10px",n.style.color="#999",n.style.backgroundColor="rgba(255,255,255,0.8)",n.style.padding="2px 6px",n.textContent="graph (No Entity)",t.appendChild(n)}},U=(t,e)=>{const{lines:s,addFont:c,getColorConst:h,addDitherMask:i,getCondProps:V,getConditionCheck:b,isEpaper:A,sanitize:p}=e,a=t.props||{},S=(t.entity_id||"").trim(),m=p(t.title||""),o=a.duration||"1h",x=a.border!==!1,E=a.color||"black",d=h(E),C=a.line_type||"SOLID",n=parseInt(a.line_thickness||3,10),D=!!a.continuous,G=a.min_value||"",y=a.max_value||"",P=a.min_range||"",F=a.max_range||"",$=`graph_${t.id}`.replace(/-/g,"_"),g=c("Roboto",400,12),L=a.grid!==!1;let _=a.x_grid||"",N=a.y_grid||"";if(L){if(!_){const v=o.match(/^(\d+(?:\.\d+)?)(min|h|d)$/);if(v){const H=parseFloat(v[1]),T=v[2];let u=H/4;T==="h"?_=u>=1?`${Math.round(u)}h`:`${Math.round(u*60)}min`:T==="min"?_=`${Math.round(u)}min`:T==="d"&&(_=`${Math.round(u*24)}h`)}else _="1h"}if(!N){const v=parseFloat(G)||0,u=((parseFloat(y)||100)-v)/4,f=Math.pow(10,Math.floor(Math.log10(u))),k=u/f;let I=k<=1?f:k<=2?2*f:k<=5?5*f:10*f;N=String(I)}}s.push(`        // widget:graph id:${t.id} type:graph x:${t.x} y:${t.y} w:${t.width} h:${t.height} title:"${m}" entity:${S} local:${!!a.is_local_sensor} duration:${o} border:${x} color:${E} x_grid:${_} y_grid:${N} line_type:${C} line_thickness:${n} continuous:${D} min_value:${G} max_value:${y} min_range:${P} max_range:${F} ${V(t)}`);const W=b(t);if(W&&s.push(`        ${W}`),S){if(s.push(`        it.graph(${t.x}, ${t.y}, id(${$}));`),x&&(s.push(`        for (int i = 0; i < ${n}; i++) {`),s.push(`          it.rectangle(${t.x} + i, ${t.y} + i, ${t.width} - 2 * i, ${t.height} - 2 * i, ${d});`),s.push("        }"),i(s,E,A,t.x,t.y,t.width,t.height)),N)for(let l=1;l<4;l++){const M=Math.round(t.height*(l/4));s.push(`        for (int i = 0; i < ${t.width}; i += 4) {`),s.push(`          it.draw_pixel_at(${t.x} + i, ${t.y+M}, ${d});`),s.push("        }")}if(_)for(let l=1;l<4;l++){const M=Math.round(t.width*(l/4));s.push(`        for (int i = 0; i < ${t.height}; i += 4) {`),s.push(`          it.draw_pixel_at(${t.x+M}, ${t.y} + i, ${d});`),s.push("        }")}m&&s.push(`        it.printf(${t.x}+4, ${t.y}+2, id(${g}), ${d}, TextAlign::TOP_LEFT, "${m}");`);const v=parseFloat(G)||0,T=(parseFloat(y)||100)-v,u=4;for(let r=0;r<=u;r++){const l=r/u,M=v+T*l,R=Math.round(t.height*(1-l)),O=T>=10?"%.0f":"%.1f";s.push(`        it.printf(${t.x} - 4, ${t.y} + ${R} - 6, id(${g}), ${d}, TextAlign::TOP_RIGHT, "${O}", (float)${M});`)}let f=3600;const k=o.match(/^(\d+)([a-z]+)$/i);if(k){const r=parseInt(k[1],10),l=k[2].toLowerCase();l.startsWith("s")?f=r:l.startsWith("m")?f=r*60:l.startsWith("h")?f=r*3600:l.startsWith("d")&&(f=r*86400)}const I=2;for(let r=0;r<=I;r++){const l=r/I,M=Math.round(t.width*l);let R="TextAlign::TOP_CENTER";r===0&&(R="TextAlign::TOP_LEFT"),r===I&&(R="TextAlign::TOP_RIGHT");let O=r===I?"Now":"";if(r!==I){const z=f*(1-l);z>=3600?O=`-${(z/3600).toFixed(1)}h`:z>=60?O=`-${(z/60).toFixed(0)}m`:O=`-${z.toFixed(0)}s`}s.push(`        it.printf(${t.x} + ${M}, ${t.y} + ${t.height} + 2, id(${g}), ${d}, ${R}, "${O}");`)}}else s.push(`        it.printf(${t.x}+5, ${t.y}+5, id(${g}), ${d}, TextAlign::TOP_LEFT, "Graph (no entity)");`);W&&s.push("        }")},X=t=>{const{lines:e,widgets:s}=t,c=s.filter(h=>h.type==="graph");c.length>0&&(e.push("graph:"),c.forEach(h=>{const i=h.props||{},V=`graph_${h.id}`.replace(/-/g,"_"),b=i.duration||"1h",A=parseInt(h.width,10),p=parseInt(h.height,10),a=i.max_range?parseFloat(i.max_range):null,S=i.min_range?parseFloat(i.min_range):null,m=i.grid!==!1;let o=i.x_grid||"",x=i.y_grid||"";if(m){if(!o){const y=b.match(/^(\d+(?:\.\d+)?)(min|h|d)$/);if(y){const P=parseFloat(y[1]),F=y[2];let $=P/4;F==="h"?o=$>=1?`${Math.round($)}h`:`${Math.round($*60)}min`:F==="min"?o=`${Math.round($)}min`:F==="d"&&(o=`${Math.round($*24)}h`)}else o="1h"}if(!x){const y=parseFloat(i.min_value)||0,$=((parseFloat(i.max_value)||100)-y)/4,g=Math.pow(10,Math.floor(Math.log10($))),L=$/g;let _=L<=1?g:L<=2?2*g:L<=5?5*g:10*g;x=String(_)}}const d=(h.entity_id||"").trim().replace(/[^a-zA-Z0-9_]/g,"_")||"none",C=(i.line_type||"SOLID").toUpperCase(),n=parseInt(i.line_thickness||3,10),D=i.border!==!1,G=!!i.continuous;e.push(`  - id: ${V}`),e.push(`    duration: ${b}`),e.push(`    width: ${A}`),e.push(`    height: ${p}`),e.push(`    border: ${D}`),m&&o&&e.push(`    x_grid: ${o}`),m&&x&&e.push(`    y_grid: ${x}`),e.push("    traces:"),e.push(`      - sensor: ${d}`),e.push(`        line_thickness: ${n}`),C!=="SOLID"&&e.push(`        line_type: ${C}`),G&&e.push("        continuous: true"),i.min_value!==void 0&&i.min_value!==null&&String(i.min_value).trim()!==""&&e.push(`    min_value: ${i.min_value}`),i.max_value!==void 0&&i.max_value!==null&&String(i.max_value).trim()!==""&&e.push(`    max_value: ${i.max_value}`),a!==null&&e.push(`    max_range: ${a}`),S!==null&&e.push(`    min_range: ${S}`)}),e.push(""))},J={id:"graph",name:"Graph / Chart",category:"Advanced",defaults:{duration:"1h",border:!0,grid:!0,color:"black",title:"",x_grid:"",y_grid:"",line_thickness:3,line_type:"SOLID",continuous:!0,min_value:"",max_value:"",min_range:"",max_range:""},render:q,export:U,onExportComponents:X};export{J as default};

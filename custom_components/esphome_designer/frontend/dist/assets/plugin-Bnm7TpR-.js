const C=(t,o,{getColorStyle:e})=>{const a=o.props||{};let i="F0079",l=a.size||24;const r=a.color||"black";let s=75;if(a.fit_icon_to_frame){const c=Math.max(8,Math.min((o.width||0)-8,(o.height||0)-8));l=Math.round(c)}if(window.AppState&&window.AppState.entityStates&&o.entity_id){const n=window.AppState.entityStates[o.entity_id];if(n&&n.state!==void 0){const c=parseFloat(n.state);isNaN(c)||(s=c)}}s>=95?i="F0079":s>=85?i="F0082":s>=75?i="F0081":s>=65?i="F0080":s>=55?i="F007F":s>=45?i="F007E":s>=35?i="F007D":s>=25?i="F007C":s>=15?i="F007B":s>=5?i="F007A":i="F0083";const f=983040+parseInt(i.slice(1),16),d=String.fromCodePoint(f);t.innerText=d,t.style.fontSize=`${l}px`,t.style.color=e(r),t.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, -sans-serif",t.style.lineHeight="1",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.flexDirection="column";const p=document.createElement("div");p.style.fontSize=(a.font_size||12)+"px",p.style.marginTop="2px",p.textContent=Math.round(s)+"%",t.appendChild(p)},E=(t,o)=>{const{lines:e,addFont:a,getColorConst:i,addDitherMask:l,getCondProps:r,getConditionCheck:s,isEpaper:f,RECT_Y_OFFSET:d}=o,p=t.props||{},n=(t.entity_id||"").trim(),c=parseInt(p.size||24,10),b=parseInt(p.font_size||12,10),u=p.color||"black",F=i(u),m=a("Material Design Icons",400,c),x=a("Roboto",400,b);let h;if(p.is_local_sensor)h="battery_level";else{let _=n;_&&!_.includes(".")&&(_=`sensor.${_}`),h=_?_.replace(/[^a-zA-Z0-9_]/g,"_"):"battery_level"}e.push(`        // widget:battery_icon id:${t.id} type:battery_icon x:${t.x} y:${t.y} w:${t.width} h:${t.height} entity:${n||"battery_level"} size:${c} font_size:${b} color:${u} local:${!!p.is_local_sensor} ${r(t)}`);const y=s(t);y&&e.push(`        ${y}`);const $=2,z=c+$+b,g=`(${t.height} - ${z}) / 2`,v=`${t.x} + ${t.width} / 2`,U=`${t.y} + ${g}`,I=`${t.y} + ${g} + ${c} + ${$}`;e.push("        {"),e.push('          const char* bat_icon = "\\U000F0082"; // Default: battery-90'),e.push("          float bat_level = 0;"),e.push(`          if (id(${h}).has_state()) {`),e.push(`            bat_level = id(${h}).state;`),e.push("            if (std::isnan(bat_level)) bat_level = 0;"),e.push('            if (bat_level >= 95) bat_icon = "\\U000F0079";      // battery (full)'),e.push('            else if (bat_level >= 85) bat_icon = "\\U000F0082"; // battery-90'),e.push('            else if (bat_level >= 75) bat_icon = "\\U000F0081"; // battery-80'),e.push('            else if (bat_level >= 65) bat_icon = "\\U000F0080"; // battery-70'),e.push('            else if (bat_level >= 55) bat_icon = "\\U000F007F"; // battery-60'),e.push('            else if (bat_level >= 45) bat_icon = "\\U000F007E"; // battery-50'),e.push('            else if (bat_level >= 35) bat_icon = "\\U000F007D"; // battery-40'),e.push('            else if (bat_level >= 25) bat_icon = "\\U000F007C"; // battery-30'),e.push('            else if (bat_level >= 15) bat_icon = "\\U000F007B"; // battery-20'),e.push('            else if (bat_level >= 5) bat_icon = "\\U000F007A";  // battery-10'),e.push('            else bat_icon = "\\U000F0083";                      // battery-alert (critical)'),e.push("          }"),e.push(`          it.printf(${v}, ${U}, id(${m}), ${F}, TextAlign::TOP_CENTER, "%s", bat_icon);`),e.push(`          it.printf(${v}, ${I}, id(${x}), ${F}, TextAlign::TOP_CENTER, "%.0f%%", bat_level);`);const S=t.y+(typeof d<"u"?d:0);l(e,u,f,t.x,S,t.width,t.height),e.push("        }"),y&&e.push("        }")},D={id:"battery_icon",name:"Battery",category:"Sensors",defaults:{width:60,height:60,size:36,font_size:14,color:"black"},render:C,exportLVGL:(t,{common:o,convertColor:e,getLVGLFont:a,formatOpacity:i})=>{const l=t.props||{};let r=(t.entity_id||"").trim();r&&!r.includes(".")&&(r=`sensor.${r}`);const s=l.is_local_sensor?"battery_level":r?r.replace(/[^a-zA-Z0-9_]/g,"_"):"battery_level",f=e(l.color||"black"),d=parseInt(l.size||24,10),p=parseInt(l.font_size||12,10);let n=`!lambda |-
`;n+=`          if (id(${s}).has_state()) {
`,n+=`            float lvl = id(${s}).state;
`,n+=`            if (lvl >= 95) return "\\U000F0079";
`,n+=`            if (lvl >= 85) return "\\U000F0082";
`,n+=`            if (lvl >= 75) return "\\U000F0081";
`,n+=`            if (lvl >= 65) return "\\U000F0080";
`,n+=`            if (lvl >= 55) return "\\U000F007F";
`,n+=`            if (lvl >= 45) return "\\U000F007E";
`,n+=`            if (lvl >= 35) return "\\U000F007D";
`,n+=`            if (lvl >= 25) return "\\U000F007C";
`,n+=`            if (lvl >= 15) return "\\U000F007B";
`,n+=`            if (lvl >= 5) return "\\U000F007A";
`,n+=`            return "\\U000F0083";
`,n+=`          }
`,n+='          return "\\U000F0083";';let c=`!lambda |-
`;return c+=`          if (id(${s}).has_state()) {
`,c+=`            return str_sprintf("%.0f%%", id(${s}).state).c_str();
`,c+=`          }
`,c+='          return "---%";',{obj:{...o,bg_opa:"transp",border_width:0,widgets:[{label:{width:d+10,height:d+4,align:"top_mid",text:n,text_font:a("Material Design Icons",d,400),text_color:f}},{label:{width:"100%",height:p+4,align:"bottom_mid",y:2,text:c,text_font:a("Roboto",p,400),text_color:f,text_align:"center"}}]}}},collectRequirements:(t,o)=>{const{trackIcon:e,addFont:a}=o,i=t.props||{},l=parseInt(i.size||24,10),r=parseInt(i.font_size||12,10);a("Material Design Icons",400,l),a("Roboto",400,r),["F0079","F0082","F0081","F0080","F007F","F007E","F007D","F007C","F007B","F007A","F0083"].forEach(s=>e(s,l))},export:E,onExportNumericSensors:t=>{const{lines:o,widgets:e,isLvgl:a,pendingTriggers:i}=t;if(e)for(const l of e){if(l.type!=="battery_icon")continue;const r=l.props||{};let s=(l.entity_id||"").trim();if(r.is_local_sensor?s="battery_level":s&&(s.includes(".")||(s=`sensor.${s}`)),!!s&&(a&&i&&(i.has(s)||i.set(s,new Set),i.get(s).add(`- lvgl.widget.refresh: ${l.id}`)),!r.is_local_sensor&&s.startsWith("sensor."))){const f=s.replace(/[^a-zA-Z0-9_]/g,"_");t.seenSensorIds&&!t.seenSensorIds.has(f)&&(t.seenSensorIds.size===0&&(o.push(""),o.push("# External Battery Sensors")),t.seenSensorIds.add(f),o.push("- platform: homeassistant"),o.push(`  id: ${f}`),o.push(`  entity_id: ${s}`),o.push("  internal: true"))}}}};export{D as default};

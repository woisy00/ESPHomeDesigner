const tt=(o,r,{getColorStyle:u})=>{const n=r.props||{},p=r.entity_id||"",c=r.title||"",s=n.value_format||"label_value";let f=parseInt(n.precision,10);isNaN(f)&&(f=2);const e=n.unit||"",_=n.label_font_size||14,h=n.value_font_size||20,x=(n.font_family||"Roboto")+", sans-serif",m=String(n.font_weight||400),O=n.italic?"italic":"normal",g=u(n.color),L=r.entity_id_2||"",R=n.separator||" ~ ";let v="--";const d=s.endsWith("_no_unit");let $=n.hide_unit||d?"":e;const A=i=>{if(window.AppState&&window.AppState.entityStates&&i){const a=window.AppState.entityStates[i];if(a&&a.state!==void 0){const E=a.formatted||String(a.state);a.state;const V=E.match(/^([-+]?\d*[.,]?\d+)(.*)$/);if(V){const P=parseFloat(V[1].replace(",",".")),b=V[2]?V[2].trim():"";if(i===p&&(e===void 0||e==="")&&!n.hide_unit&&!d&&($=b),!isNaN(P))return!isNaN(f)&&f>=0?P.toFixed(f):P.toString()}if(i===p&&(e===void 0||e==="")&&a.attributes&&a.attributes.unit_of_measurement&&!n.hide_unit&&!d&&($=a.attributes.unit_of_measurement),d||n.hide_unit){const P=E.match(/^([-+]?\d*[.,]?\d+)/);if(P){const b=parseFloat(P[1].replace(",","."));if(!isNaN(b))return!isNaN(f)&&f>=0?b.toFixed(f):b.toString()}return E.replace(/\s*[°%]?[A-Za-z/²³]+\s*$/,"").trim()||E}return E}}return"--"},z=A(p);let C=null;L&&(C=A(L)),v=z,C!==null&&(v=`${z}${R}${C}`),$&&v.endsWith($)&&($="");let y=c;if(!y&&(s.startsWith("label_")||s==="value_label")&&window.AppState&&window.AppState.entityStates&&p){const i=window.AppState.entityStates[p];i&&i.attributes&&i.attributes.friendly_name?y=i.attributes.friendly_name:p&&(y=p.split(".").pop().replace(/_/g," "))}const T=n.prefix||"",S=n.postfix||"",w=`${T}${v}${$?" "+$:""}${S}`.trim();o.innerHTML="",o.style.display="flex";const W=(i,a)=>{i&&(i.includes("LEFT")?a.style.textAlign="left":i.includes("RIGHT")?a.style.textAlign="right":a.style.textAlign="center")};((i,a)=>{i.includes("LEFT")?a.style.justifyContent="flex-start":i.includes("RIGHT")?a.style.justifyContent="flex-end":a.style.justifyContent="center",i.includes("TOP")?a.style.alignItems="flex-start":i.includes("BOTTOM")?a.style.alignItems="flex-end":a.style.alignItems="center"})(n.text_align||"TOP_LEFT",o);const t=document.createElement("div");if(t.style.color=g,t.style.fontFamily=x,t.style.fontWeight=m,t.style.fontStyle=O,(s==="label_value"||s==="label_value_no_unit")&&y){t.style.display="flex",t.style.alignItems="baseline",t.style.gap="4px";const i=document.createElement("span");i.style.fontSize=`${_}px`,i.textContent=y+":";const a=document.createElement("span");a.style.fontSize=`${h}px`,a.textContent=w;const E=n.label_align||n.text_align||"TOP_LEFT";E.includes("CENTER")?t.style.justifyContent="center":E.includes("RIGHT")?t.style.justifyContent="flex-end":t.style.justifyContent="flex-start",t.appendChild(i),t.appendChild(a)}else if((s==="label_newline_value"||s==="label_newline_value_no_unit")&&y){t.style.display="flex",t.style.flexDirection="column",t.style.gap="2px",t.style.width="100%";const i=document.createElement("div");i.style.fontSize=`${_}px`,i.textContent=y,W(n.label_align||n.text_align||"TOP_LEFT",i);const a=document.createElement("div");a.style.fontSize=`${h}px`,a.textContent=w,W(n.value_align||n.text_align||"TOP_LEFT",a),t.appendChild(i),t.appendChild(a)}else if(s==="value_label"&&y){t.style.display="flex",t.style.alignItems="baseline",t.style.gap="4px";const i=document.createElement("span");i.style.fontSize=`${h}px`,i.textContent=w;const a=document.createElement("span");a.style.fontSize=`${_}px`,a.textContent=y,t.appendChild(i),t.appendChild(a)}else s==="label_only"?(t.style.fontSize=`${_}px`,t.textContent=y,W(n.text_align||"TOP_LEFT",t)):(t.style.fontSize=`${h}px`,t.textContent=w,W(n.value_align||n.text_align||"TOP_LEFT",t));o.appendChild(t)},et={id:"sensor_text",name:"Sensor Text",category:"Sensors",defaults:{entity_id:"",title:"",value_format:"label_value",label_font_size:14,value_font_size:20,unit:"",precision:2,text_align:"TOP_LEFT",font_family:"Roboto"},render:tt,exportLVGL:(o,{common:r,convertColor:u,convertAlign:n,getLVGLFont:p,formatOpacity:c})=>{const s=o.props||{};let f=(o.entity_id||"").trim();const e=(o.entity_id_2||"").trim(),_=s.value_format||"label_value";let h=parseInt(s.precision,10);(isNaN(h)||h<0)&&(h=1);const x=t=>(t||"").replace(/%/g,"%%"),m=t=>{if(s.is_local_sensor)return`id(${t||"battery_level"})`;const i=t.replace(/[^a-zA-Z0-9_]/g,"_");return t.startsWith("text_sensor.")?`id(${i}_txt)`:`id(${i})`};if(!f&&!s.is_local_sensor)return null;const O=m(f),g=e?m(e):null,L=s.is_text_sensor||f&&(f.startsWith("text_sensor.")||f.startsWith("weather.")),R=e&&(s.is_text_sensor||e.startsWith("text_sensor.")||e.startsWith("weather."));let v=`!lambda |-
`;v+=`              if (${O}.has_state()${g?` && ${g}.has_state()`:""}) {
`;let d=(s.unit||"").trim();if(!d&&!s.hide_unit&&!_.endsWith("_no_unit")&&window.AppState&&window.AppState.entityStates){const t=window.AppState.entityStates[f];if(t){if(t.attributes&&t.attributes.unit_of_measurement)d=t.attributes.unit_of_measurement;else if(t.formatted){const i=t.formatted.match(/^([-+]?\d*[.,]?\d+)\s*(.*)$/);i&&i[2]&&(d=i[2].trim())}}}if(!d&&!s.hide_unit&&!_.endsWith("_no_unit")&&f){const t=f.toLowerCase();t.includes("_power")||t.includes("_watt")?d="W":t.includes("_energy")||t.includes("_kwh")?d="kWh":t.includes("_temperature")||t.includes("_temp")?d="°C":t.includes("_humidity")?d="%":t.includes("_voltage")||t.includes("_volt")?d="V":t.includes("_current")||t.includes("_amp")?d="A":t.includes("_battery")?d="%":t.includes("_pressure")||t.includes("_hpa")?d="hPa":t.includes("_speed")||t.includes("_kmh")?d="km/h":(t.includes("_percent")||t.includes("_pct"))&&(d="%")}const $=x(d),A=x(s.prefix||""),z=x(s.postfix||""),C=L?"%s":`%.${h}f`,y=g?R?"%s":`%.${h}f`:"",T=x(s.separator||" ~ ");let S=(o.title||s.title||"").trim();!S&&_.startsWith("label_")&&(S=f.split(".").pop().replace(/_/g," "));const w=L?`${O}.state.c_str()`:`${O}.state`,W=g?R?`${g}.state.c_str()`:`${g}.state`:null;let F="";return _==="label_only"?F=S:_==="label_value"||_==="label_value_no_unit"?F=`${S}: ${A}${C}${g?T+y:""}${$?" "+$:""}${z}`:_==="label_newline_value"||_==="label_newline_value_no_unit"?F=`${S}\\n${A}${C}${g?T+y:""}${$?" "+$:""}${z}`:_==="value_label"?F=`${A}${C}${g?T+y:""}${$?" "+$:""}${z} ${S}`:F=`${A}${C}${g?T+y:""}${$?" "+$:""}${z}`,v+=`                return str_sprintf("${F}", ${w}${W?`, ${W}`:""}).c_str();
`,v+=`              }
`,v+='              return "---";',{label:{...r,text:v,text_font:p(s.font_family,s.value_font_size||20,s.font_weight,s.italic),text_color:u(s.color),text_align:(n(s.text_align)||"LEFT").replace("TOP_","").replace("BOTTOM_",""),bg_color:s.bg_color&&s.bg_color!=="transparent"?u(s.bg_color):void 0,opa:c(s.opa)}}},collectRequirements:(o,{addFont:r})=>{const u=o.props||{},n=u.font_family||"Roboto",p=u.font_weight||400,c=!!u.italic;r(n,p,u.label_font_size||14,c),r(n,p,u.value_font_size||20,c)},export:(o,r)=>{const{lines:u,getColorConst:n,addFont:p,getCondProps:c,getConditionCheck:s,Utils:f}=r,e=o.props||{};let _=(o.entity_id||"").trim(),h=(o.entity_id_2||"").trim();_&&!e.is_local_sensor&&!_.includes(".")&&!_.startsWith("text_sensor.")&&(_=`sensor.${_}`),h&&!e.is_local_sensor&&!h.includes(".")&&!h.startsWith("text_sensor.")&&(h=`sensor.${h}`);const x=e.value_format||"label_value";let m=(e.unit||"").trim();if(!m&&!e.hide_unit&&!x.endsWith("_no_unit")&&window.AppState&&window.AppState.entityStates){const l=window.AppState.entityStates[_];if(l){if(l.attributes&&l.attributes.unit_of_measurement)m=l.attributes.unit_of_measurement;else if(l.formatted){const D=l.formatted.match(/^([-+]?\d*[.,]?\d+)\s*(.*)$/);D&&D[2]&&(m=D[2].trim())}}}if(!m&&!e.hide_unit&&!x.endsWith("_no_unit")&&_){const l=_.toLowerCase();l.includes("_power")||l.includes("_watt")?m="W":l.includes("_energy")||l.includes("_kwh")?m="kWh":l.includes("_temperature")||l.includes("_temp")?m="°C":l.includes("_humidity")?m="%":l.includes("_voltage")||l.includes("_volt")?m="V":l.includes("_current")||l.includes("_amp")?m="A":l.includes("_battery")?m="%":l.includes("_pressure")||l.includes("_hpa")?m="hPa":l.includes("_speed")||l.includes("_kmh")?m="km/h":(l.includes("_percent")||l.includes("_pct"))&&(m="%")}const O=e.label_font_size||14,g=e.value_font_size||20,L=e.font_family||"Roboto",R=e.font_weight||400,v=!!e.italic,d=n(e.color||(r.isDark?"white":"black")),$=e.text_align||"TOP_LEFT",A=e.separator||" ~ ",z=e.prefix||"",C=e.postfix||"";let y=parseInt(e.precision,10);(isNaN(y)||y<0)&&(y=2);const T=l=>(l||"").replace(/%/g,"%%");if(u.push(`        // widget:sensor_text id:${o.id} type:sensor_text x:${o.x} y:${o.y} w:${o.width} h:${o.height} entity:"${_}" format:"${x}" ${c(o)}`),!_&&!e.is_local_sensor){u.push("        // Sensor ID missing for this widget");return}const S=p(L,R,O,v),w=p(L,R,g,v),W=s(o);W&&u.push(`        ${W}`);const F=(l,D)=>{if(e.is_local_sensor)return`id(${l||"battery_level"})`;const B=l.replace(/[^a-zA-Z0-9_]/g,"_");return e.is_text_sensor||l.startsWith("text_sensor.")?`id(${B}_txt)`:`id(${B})`},t=F(_),i=h?F(h):null,a=e.is_text_sensor||_&&(_.startsWith("text_sensor.")||_.startsWith("weather.")),E=h&&(e.is_text_sensor||h.startsWith("text_sensor.")||h.startsWith("weather.")),V=a?"%s":`%.${y}f`,P=E?"%s":`%.${y}f`;let b=(o.title||e.title||"").trim();!b&&x.startsWith("label_")&&(b=_.split(".").pop().replace(/_/g," "));const G=e.hide_unit||x.endsWith("_no_unit")?"":T(m),q=T(z),J=T(C),K=T(A),H=l=>l?l==="CENTER"?"TextAlign::CENTER":`TextAlign::${l}`:"TextAlign::TOP_LEFT",U=H(e.label_align||$),k=H(e.value_align||$);let I=o.x,N=o.y;const Q=$.includes("CENTER"),X=$.includes("RIGHT");Q?I=Math.round(o.x+o.width/2):X&&(I=Math.round(o.x+o.width)),$.includes("BOTTOM")?N=Math.round(o.y+o.height):$.includes("TOP")||(N=Math.round(o.y+o.height/2));const M=`${q}${V}${i?K+P:""}${G?" "+G:""}${J}`,Z=a?`${t}.state.c_str()`:`${t}.state`,Y=i?E?`${i}.state.c_str()`:`${i}.state`:null,j=i?`${Z}, ${Y}`:Z;if(x==="label_only")u.push(`        it.printf(${I}, ${N}, id(${S}), ${d}, ${U}, "${b}");`);else if(x==="value_only"||x==="value_only_no_unit"||!b)u.push(`        it.printf(${I}, ${N}, id(${w}), ${d}, ${k}, "${M}", ${j});`);else if(x==="label_value"||x==="label_value_no_unit"){const l=`${b}${b.endsWith(":")?"":":"} `;u.push(`        it.printf(${I}, ${N}, id(${w}), ${d}, ${k}, "${l}${M}", ${j});`)}else if(x==="label_newline_value"||x==="label_newline_value_no_unit")u.push(`        it.printf(${I}, ${N}, id(${S}), ${d}, ${U}, "${b}");`),u.push(`        it.printf(${I}, ${N} + ${O+4}, id(${w}), ${d}, ${k}, "${M}", ${j});`);else if(x==="value_label"){u.push(`        it.printf(${I}, ${N}, id(${w}), ${d}, ${k}, "${M}", ${j});`);const l=Math.round(g*.6*6)+10;u.push(`        it.printf(${I} + ${l}, ${N}, id(${S}), ${d}, ${U}, "${b}");`)}W&&u.push("        }")},onExportTextSensors:o=>{const{lines:r,widgets:u}=o;if(!u)return;const n=new Set,p=new Set;for(const c of u){if(c.type!=="sensor_text")continue;const s=c.props||{},f=(c.entity_id||"").trim();f.startsWith("weather.")?n.add(f):(s.is_text_sensor||f.startsWith("text_sensor."))&&p.add(f);const e=(c.entity_id_2||s.entity_id_2||"").trim();e&&(e.startsWith("weather.")?n.add(e):(s.is_text_sensor||e.startsWith("text_sensor."))&&p.add(e))}if(n.size>0){r.push("# Weather Entity Sensors (Detected from Sensor Text)");for(const c of n){const s=c.replace(/^weather\./,"").replace(/\./g,"_").replace(/-/g,"_");r.push("- platform: homeassistant"),r.push(`  id: ${s}`),r.push(`  entity_id: ${c}`),r.push("  internal: true")}}if(p.size>0){r.push("# Text Sensors (Detected from Sensor Text)");for(const c of p){const s=c.replace(/[^a-zA-Z0-9_]/g,"_")+"_txt";r.push("- platform: homeassistant"),r.push(`  id: ${s}`),r.push(`  entity_id: ${c}`),r.push("  internal: true")}}},onExportNumericSensors:o=>{const{lines:r,widgets:u}=o;if(!u)return;const n=new Map,p=new Set;for(const c of u){if(c.type!=="sensor_text")continue;const s=c.props||{};if(s.is_local_sensor)continue;const f=[c.entity_id,c.entity_id_2].filter(e=>e&&e.trim());for(let e of f)e=e.trim(),!(s.is_text_sensor||e.startsWith("weather.")||e.startsWith("text_sensor."))&&(e.includes(".")||(e=`sensor.${e}`),n.has(e)||n.set(e,[]),n.get(e).push(c.id))}for(const[c,s]of n){if(p.has(c))continue;p.add(c);const f=c.replace(/[^a-zA-Z0-9_]/g,"_");if(r.push("- platform: homeassistant"),r.push(`  id: ${f}`),r.push(`  entity_id: ${c}`),r.push("  internal: true"),o.isLvgl){r.push("  on_value:"),r.push("    then:");for(const e of s)r.push("      - lvgl.widget.update:"),r.push(`          id: ${e}`)}}}};export{et as default};

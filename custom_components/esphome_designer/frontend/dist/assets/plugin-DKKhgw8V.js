const C=(e,_,t)=>{const s=_.props||{},{getColorStyle:r}=t,d=_.entity_id||"",l=_.title||"",f=s.show_label!==!1&&s.show_label!=="false",u=s.show_percentage!==!1&&s.show_percentage!=="false",y=s.bar_height||15,p=s.border_width||1,c=s.color||"black",h=r(c);let $=50;if(window.AppState&&window.AppState.entityStates&&d){const i=window.AppState.entityStates[d],o=i&&i.state!==void 0?i.state:null;if(o!=null){const g=parseFloat(String(o).replace(/[^0-9.-]/g,""));isNaN(g)||($=Math.max(0,Math.min(100,g)))}}if(e.innerHTML="",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.gap="4px",e.style.color=h,f&&(l||u)){const i=document.createElement("div");if(i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.fontSize="12px",i.style.paddingBottom="2px",i.style.width="100%",l){const o=document.createElement("span");o.textContent=l,i.appendChild(o)}if(u){const o=document.createElement("span");o.textContent=Math.round($)+"%",i.appendChild(o)}e.appendChild(i)}const a=document.createElement("div");a.style.width="100%",a.style.height=`${y}px`,a.style.border=`${p}px solid ${h}`,a.style.borderRadius="2px",a.style.position="relative",a.style.overflow="hidden",a.style.backgroundColor=c==="white"?"#000":"#fff";const n=document.createElement("div");n.style.width=`${$}%`,n.style.height="100%",n.style.backgroundColor=h,n.style.transition="width 0.3s ease",a.appendChild(n),e.appendChild(a)},v=(e,{common:_,convertColor:t})=>{const s=e.props||{};let r=s.value||0;return e.entity_id&&(r=`!lambda "return id(${e.entity_id.replace(/[^a-zA-Z0-9_]/g,"_")}).state;"`),{bar:{..._,min_value:s.min||0,max_value:s.max||100,value:r,bg_color:t(s.bg_color||"white"),indicator:{bg_color:t(s.color)},mode:s.mode||"normal"}}},S=(e,_)=>{const{lines:t,addFont:s,getColorConst:r,addDitherMask:d,getCondProps:l,getConditionCheck:f,isEpaper:u,sanitize:y}=_,p=e.props||{};let c=(e.entity_id||"").trim();const h=y(e.title||""),$=p.show_label!==!1,a=p.show_percentage!==!1,n=parseInt(p.bar_height||15,10),i=p.color||"black",o=r(i),g=s("Roboto",400,12);c&&!p.is_local_sensor&&!c.includes(".")&&(c=`sensor.${c}`),t.push(`        // widget:progress_bar id:${e.id} type:progress_bar x:${e.x} y:${e.y} w:${e.width} h:${e.height} entity:${c} title:"${h}" show_label:${$} show_pct:${a} bar_height:${n} color:${i} local:${!!p.is_local_sensor} ${l(e)}`);const b=f(e);b&&t.push(`        ${b}`);const m=p.is_local_sensor?c||"battery_level":c?c.replace(/[^a-zA-Z0-9_]/g,"_"):"";if(m){t.push(`        float val_${e.id.replace(/-/g,"_")} = id(${m}).state;`),t.push(`        if (std::isnan(val_${e.id.replace(/-/g,"_")})) val_${e.id.replace(/-/g,"_")} = 0;`),t.push(`        int pct_${e.id.replace(/-/g,"_")} = (int)val_${e.id.replace(/-/g,"_")};`),t.push(`        if (pct_${e.id.replace(/-/g,"_")} < 0) pct_${e.id.replace(/-/g,"_")} = 0;`),t.push(`        if (pct_${e.id.replace(/-/g,"_")} > 100) pct_${e.id.replace(/-/g,"_")} = 100;`),$&&h&&t.push(`        it.printf(${e.x}, ${e.y}, id(${g}), ${o}, TextAlign::TOP_LEFT, "${h}");`),a&&t.push(`        it.printf(${e.x} + ${e.width}, ${e.y}, id(${g}), ${o}, TextAlign::TOP_RIGHT, "%d%%", pct_${e.id.replace(/-/g,"_")});`);const x=e.y+(e.height-n);t.push(`        it.rectangle(${e.x}, ${x}, ${e.width}, ${n}, ${o});`),t.push(`        if (pct_${e.id.replace(/-/g,"_")} > 0) {`),t.push(`          int bar_w = (${e.width} - 4) * pct_${e.id.replace(/-/g,"_")} / 100;`),t.push(`          it.filled_rectangle(${e.x} + 2, ${x} + 2, bar_w, ${n} - 4, ${o});`),t.push("        }"),d(t,i,u,e.x,x,e.width,n,2)}else t.push(`        it.rectangle(${e.x}, ${e.y} + ${e.height} - ${n}, ${e.width}, ${n}, ${o});`),t.push(`        it.filled_rectangle(${e.x} + 2, ${e.y} + ${e.height} - ${n} + 2, ${e.width} / 2, ${n} - 4, ${o});`),$&&h&&t.push(`        it.printf(${e.x}, ${e.y}, id(${g}), ${o}, TextAlign::TOP_LEFT, "${h}");`);b&&t.push("        }")},T=e=>{const{lines:_,widgets:t,isLvgl:s,pendingTriggers:r}=e;if(!(!t||t.length===0))for(const d of t){if(d.type!=="progress_bar")continue;let l=(d.entity_id||"").trim();const f=d.props||{};!l||f.is_local_sensor||(l.includes(".")||(l=`sensor.${l}`),s&&r&&(r.has(l)||r.set(l,new Set),r.get(l).add(`- lvgl.widget.refresh: ${d.id}`)))}},I={id:"progress_bar",name:"Progress Bar",category:"Advanced",defaults:{show_label:!0,show_percentage:!0,bar_height:15,border_width:1,color:"black",bg_color:"white",min:0,max:100,mode:"normal"},render:C,exportLVGL:v,export:S,onExportNumericSensors:T};export{I as default};

const H=(e,o,{getColorStyle:t})=>{const s=o.props||{},i=s.layout||"horizontal",a=Math.min(7,Math.max(1,parseInt(s.days,10)||5)),l=parseInt(s.icon_size,10)||32,_=parseInt(s.temp_font_size,10)||14,f=parseInt(s.day_font_size,10)||12,n=s.show_high_low!==!1,r=t(s.color||"black"),g=(s.font_family||"Roboto")+", sans-serif",w=[{code:"F0599",condition:"sunny"},{code:"F0595",condition:"partlycloudy"},{code:"F0597",condition:"rainy"},{code:"F0590",condition:"cloudy"},{code:"F0595",condition:"partlycloudy"}],d=[{high:24,low:18},{high:20,low:14},{high:22,low:15},{high:19,low:13},{high:18,low:12},{high:21,low:15},{high:23,low:16}];if(e.innerHTML="",e.style.display="flex",e.style.flexDirection=i==="vertical"?"column":"row",e.style.alignItems="flex-start",e.style.justifyContent="flex-start",e.style.gap=i==="vertical"?"4px":"0px",e.style.overflow="hidden",e.style.padding="4px",e.style.boxSizing="border-box",e.style.backgroundColor=t(s.background_color||"transparent"),s.show_border!==!1){const c=s.border_width!==void 0?s.border_width:1,h=t(s.border_color||s.color||"black");e.style.border=`${c}px solid ${h}`}else e.style.border="none";const u=o.width-(e.style.border!=="none"?parseInt(s.border_width||1)*2:0)-8,b=o.height-(e.style.border!=="none"?parseInt(s.border_width||1)*2:0)-8,S=i==="horizontal"?Math.floor(u/a):u,I=i==="vertical"?Math.floor(b/a):b;o.entity_id||s.weather_entity;for(let c=0;c<a;c++){const h=document.createElement("div");h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="center",h.style.justifyContent="flex-start",h.style.width=`${S}px`,h.style.minHeight=i==="vertical"?`${I}px`:"auto",h.style.color=r,h.style.fontFamily=g;let D=null,z=null,U=null;if(window.AppState&&window.AppState.entityStates){const y=window.AppState.entityStates[`sensor.weather_forecast_day_${c}_condition`],x=window.AppState.entityStates[`sensor.weather_forecast_day_${c}_high`],k=window.AppState.entityStates[`sensor.weather_forecast_day_${c}_low`];y&&y.state&&y.state!=="unknown"&&(D=y.state.toLowerCase()),x&&x.state&&x.state!=="unknown"&&(z=parseFloat(x.state)),k&&k.state&&k.state!=="unknown"&&(U=parseFloat(k.state))}const m=document.createElement("div");if(m.style.fontSize=`${f}px`,m.style.fontWeight="400",m.style.marginBottom="2px",c===0)m.textContent="Today";else{const y=new Date;y.setDate(y.getDate()+c),m.textContent=y.toLocaleDateString(void 0,{weekday:"short"})}h.appendChild(m);const F=document.createElement("div");let A="F0590";const C=D||w[c%w.length].condition,E=[{code:"F0594",condition:"clear-night"},{code:"F0590",condition:"cloudy"},{code:"F0026",condition:"exceptional"},{code:"F0591",condition:"fog"},{code:"F0592",condition:"hail"},{code:"F0593",condition:"lightning"},{code:"F067E",condition:"lightning-rainy"},{code:"F0595",condition:"partlycloudy"},{code:"F0596",condition:"pouring"},{code:"F0597",condition:"rainy"},{code:"F0598",condition:"snowy"},{code:"F067F",condition:"snowy-rainy"},{code:"F0599",condition:"sunny"},{code:"F059D",condition:"windy"},{code:"F059E",condition:"windy-variant"}].find(y=>y.condition===C);E&&(A=E.code);const W=983040+parseInt(A.slice(1),16);F.innerText=String.fromCodePoint(W),F.style.fontSize=`${l}px`,F.style.fontFamily="MDI, system-ui, -apple-system, BlinkMacSystemFont, sans-serif",F.style.lineHeight="1.1",h.appendChild(F);const $=document.createElement("div");$.style.fontSize=`${_}px`,$.style.fontWeight="400";const p=isNaN(z)?d[c%d.length].high:z,v=isNaN(U)?d[c%d.length].low:U,T=(s.temp_unit||"C")==="F"?"°F":"°C";n?$.textContent=`${Math.round(p)}${T}/${Math.round(v)}${T}`:$.textContent=`${Math.round(p)}${T}`,h.appendChild($),e.appendChild(h)}},N=(e,o)=>{const{lines:t,addFont:s,getColorConst:i,addDitherMask:a,sanitize:l,getCondProps:_,getConditionCheck:f,isEpaper:n}=o,r=e.props||{},g=e.entity_id||r.weather_entity||"weather.forecast_home",w=r.layout||"horizontal",d=r.show_high_low!==!1,u=parseInt(String(r.day_font_size||12),10),b=parseInt(String(r.temp_font_size||14),10),S=parseInt(String(r.icon_size||32),10),I=r.font_family||"Roboto",c=r.color||"black",h=i(c),D=s(I,700,u),z=s(I,400,b),U=s("Material Design Icons",400,S);t.push(`        // widget:weather_forecast id:${e.id} type:weather_forecast x:${e.x} y:${e.y} w:${e.width} h:${e.height} weather_entity:"${g}" layout:${w} show_high_low:${d} day_font_size:${u} temp_font_size:${b} icon_size:${S} font_family:"${I}" color:${c} ${_(e)}`);const m=f(e);m&&t.push(`        ${m}`),t.push("        {"),t.push("          static std::map<std::string, const char*> weather_icons = {"),t.push('            {"clear-night", "\\U000F0594"}, {"cloudy", "\\U000F0590"},'),t.push('            {"exceptional", "\\U000F0026"}, {"fog", "\\U000F0591"},'),t.push('            {"hail", "\\U000F0592"}, {"lightning", "\\U000F0593"},'),t.push('            {"lightning-rainy", "\\U000F067E"}, {"partlycloudy", "\\U000F0595"},'),t.push('            {"pouring", "\\U000F0596"}, {"rainy", "\\U000F0597"},'),t.push('            {"snowy", "\\U000F0598"}, {"snowy-rainy", "\\U000F067F"},'),t.push('            {"sunny", "\\U000F0599"}, {"windy", "\\U000F059D"},'),t.push('            {"windy-variant", "\\U000F059E"}'),t.push("          };"),t.push("          auto get_icon = [&](const std::string& cond_val) -> const char* {"),t.push('            return weather_icons.count(cond_val) ? weather_icons[cond_val] : "\\U000F0590";'),t.push("          };"),t.push("          auto get_day_name = [](int offset) -> std::string {"),t.push('            if (offset == 0) return "Today";'),t.push("            auto t = id(ha_time).now();"),t.push('            if (!t.is_valid()) return "---";'),t.push("            ESPTime future = ESPTime::from_epoch_local(t.timestamp + (offset * 86400));"),t.push('            char buf[8]; future.strftime(buf, sizeof(buf), "%a");'),t.push("            return std::string(buf);"),t.push("          };");const F=r.background_color||"white";if(F!=="transparent"){const p=i(F);t.push(`          it.filled_rectangle(${e.x}, ${e.y}, ${e.width}, ${e.height}, ${p});`),a(t,F,n,e.x,e.y,e.width,e.height)}if(r.show_border!==!1){const p=parseInt(r.border_width||1,10),v=r.border_color||c,M=i(v);t.push(`          for (int i = 0; i < ${p}; i++) {`),t.push(`            it.rectangle(${e.x} + i, ${e.y} + i, ${e.width} - 2 * i, ${e.height} - 2 * i, ${M});`),t.push("          }")}const C=w==="horizontal",E=C?Math.floor(e.width/5):0,W=C?0:Math.floor(e.height/5),$=Math.floor(C?E/2:e.width/2);for(let p=0;p<5;p++){const v=`weather_cond_day${p}`,M=`weather_high_day${p}`,T=`weather_low_day${p}`,y=e.x+p*E,x=e.y+p*W;t.push("          {"),t.push(`            int dx = ${y}; int dy = ${x};`),t.push(`            it.printf(dx + ${$}, dy, id(${D}), ${h}, TextAlign::TOP_CENTER, "%s", get_day_name(${p}).c_str());`),t.push(`            std::string cond_day = id(${v}).state.c_str();`),t.push(`            it.printf(dx + ${$}, dy + ${u+4}, id(${U}), ${h}, TextAlign::TOP_CENTER, "%s", get_icon(cond_day));`),d&&(t.push(`            float high = id(${M}).state; float low = id(${T}).state;`),t.push("            char temp_buf[32];"),t.push("            if (std::isnan(high) && std::isnan(low)) {"),t.push('                sprintf(temp_buf, "--/--");'),t.push("            } else if (std::isnan(high)) {"),t.push('                sprintf(temp_buf, "--/%.0f", low);'),t.push("            } else if (std::isnan(low)) {"),t.push('                sprintf(temp_buf, "%.0f/--", high);'),t.push("            } else {"),t.push('                sprintf(temp_buf, "%.0f/%.0f", high, low);'),t.push("            }"),t.push(`            it.printf(dx + ${$}, dy + ${u+S+8}, id(${z}), ${h}, TextAlign::TOP_CENTER, "%s", temp_buf);`)),t.push("          }")}a(t,c,n,e.x,e.y,e.width,e.height),t.push("        }"),m&&t.push("        }")},L=e=>{const{lines:o,widgets:t,isLvgl:s,pendingTriggers:i}=e,a=t.filter(l=>l.type==="weather_forecast");a.length!==0&&a.forEach(l=>{for(let n=0;n<5;n++)[`sensor.weather_forecast_day_${n}_high`,`sensor.weather_forecast_day_${n}_low`,`sensor.weather_forecast_day_${n}_condition`].forEach(g=>{s&&i&&(i.has(g)||i.set(g,new Set),i.get(g).add(`- lvgl.widget.refresh: ${l.id}`))});const f=(l.props?.temp_unit||"C")==="F"?"°F":"°C";for(let n=0;n<5;n++){const r=`sensor.weather_forecast_day_${n}_high`,g=`sensor.weather_forecast_day_${n}_low`,w=`weather_high_day${n}`,d=`weather_low_day${n}`;[{eid:r,id:w,name:`Weather High Day ${n}`},{eid:g,id:d,name:`Weather Low Day ${n}`}].forEach(u=>{e.seenSensorIds&&!e.seenSensorIds.has(u.id)&&(e.seenSensorIds.size===0&&(o.push(""),o.push("# Weather Forecast Numeric Sensors")),e.seenSensorIds.add(u.id),o.push("- platform: homeassistant"),o.push(`  id: ${u.id}`),o.push(`  entity_id: ${u.eid}`),o.push(`  unit_of_measurement: '${f}'`),o.push("  internal: true"))})}})},P=e=>{const{lines:o,widgets:t}=e,s=t.filter(n=>n.type==="weather_forecast");if(s.length===0)return;const i=s[0].props||{},a=s[0].entity_id||i.weather_entity||"weather.forecast_home";let l=!1;for(let n=0;n<5;n++){const r=`weather_cond_day${n}`;e.seenSensorIds&&e.seenSensorIds.has(r)||(l||(o.push(""),o.push("# Weather Forecast Condition Sensors"),l=!0),e.seenSensorIds&&e.seenSensorIds.add(r),o.push("- platform: homeassistant"),o.push(`  id: ${r}`),o.push(`  entity_id: sensor.weather_forecast_day_${n}_condition`),o.push("  internal: true"))}o.push(""),o.push("# ============================================================================"),o.push("# HOME ASSISTANT TEMPLATE SENSORS"),o.push("# Add these template sensors to your Home Assistant configuration.yaml:"),o.push("# ============================================================================"),o.push("#"),o.push("# template:"),o.push("#   - trigger:"),o.push("#       - trigger: state"),o.push(`#         entity_id: ${a}`),o.push("#       - trigger: time_pattern"),o.push("#         hours: '/1'"),o.push("#     action:"),o.push("#       - action: weather.get_forecasts"),o.push("#         target:"),o.push(`#           entity_id: ${a}`),o.push("#         data:"),o.push("#           type: daily"),o.push("#         response_variable: forecast_data"),o.push("#     sensor:");const f=(i.temp_unit||"C")==="F"?"°F":"°C";for(let n=0;n<5;n++)o.push(`#       - name: 'Weather Forecast Day ${n} High'`),o.push(`#         unique_id: weather_forecast_day_${n}_high`),o.push(`#         unit_of_measurement: '${f}'`),o.push(`#         state: '{{ forecast_data["${a}"].forecast[${n}].temperature | default("N/A") }}'`),o.push(`#       - name: 'Weather Forecast Day ${n} Low'`),o.push(`#         unique_id: weather_forecast_day_${n}_low`),o.push(`#         unit_of_measurement: '${f}'`),o.push(`#         state: '{{ forecast_data["${a}"].forecast[${n}].templow | default("N/A") }}'`),o.push(`#       - name: 'Weather Forecast Day ${n} Condition'`),o.push(`#         unique_id: weather_forecast_day_${n}_condition`),o.push(`#         state: '{{ forecast_data["${a}"].forecast[${n}].condition | default("cloudy") }}'`);o.push("#"),o.push("# ============================================================================")},R=(e,{trackIcon:o,addFont:t})=>{const s=e.props||{},i=parseInt(s.icon_size||32,10),a=parseInt(s.day_font_size||12,10),l=parseInt(s.temp_font_size||14,10),_=s.font_family||"Roboto";t(_,700,a),t(_,400,l),t("Material Design Icons",400,i),["F0594","F0590","F0026","F0591","F0592","F0593","F067E","F0595","F0596","F0597","F0598","F067F","F0599","F059D","F059E"].forEach(f=>o(f,i))},O={id:"weather_forecast",name:"Weather Forecast",category:"Sensors",defaults:{weather_entity:"weather.forecast_home",days:5,layout:"horizontal",icon_size:32,temp_font_size:14,day_font_size:12,color:"black",font_family:"Roboto",show_high_low:!0,show_border:!1,border_width:1,border_color:"black",background_color:"white",temp_unit:"C",width:370,height:90},render:H,exportLVGL:(e,{common:o,convertColor:t,getLVGLFont:s})=>{const i=e.props||{},a=5,l=(i.layout||"horizontal")==="horizontal",_=t(i.color||"black"),f=parseInt(i.day_font_size||12,10),n=parseInt(i.icon_size||32,10),r=parseInt(i.temp_font_size||14,10),g=i.show_high_low!==!1,w=[];for(let d=0;d<a;d++){const u=`!lambda |-
              if (${d} == 0) return "Today";
              auto t = id(ha_time).now();
              if (!t.is_valid()) return "---";
              ESPTime future = ESPTime::from_epoch_local(t.timestamp + (${d} * 86400));
              static char buf[16];
              future.strftime(buf, sizeof(buf), "%a");
              return buf;
            `,b=`!lambda |-
              std::string c = id(weather_cond_day${d}).state;
              if (c == "clear-night") return "\\U000F0594";
              if (c == "cloudy") return "\\U000F0590";
              if (c == "exceptional") return "\\U000F0026";
              if (c == "fog") return "\\U000F0591";
              if (c == "hail") return "\\U000F0592";
              if (c == "lightning") return "\\U000F0593";
              if (c == "lightning-rainy") return "\\U000F067E";
              if (c == "partlycloudy") return "\\U000F0595";
              if (c == "pouring") return "\\U000F0596";
              if (c == "rainy") return "\\U000F0597";
              if (c == "snowy") return "\\U000F0598";
              if (c == "snowy-rainy") return "\\U000F067F";
              if (c == "sunny") return "\\U000F0599";
              if (c == "windy") return "\\U000F059D";
              if (c == "windy-variant") return "\\U000F059E";
              return "\\U000F0590";
            `,S=[{label:{align:"top_mid",text:u,text_font:s(i.font_family||"Roboto",f,700),text_color:_}},{label:{align:"center",y:0,text:b,text_font:s("Material Design Icons",n,400),text_color:_}},{label:{align:"bottom_mid",text:g?`!lambda "return str_sprintf('%.0f/%.0f', id(weather_high_day${d}).state, id(weather_low_day${d}).state).c_str();"`:`!lambda "return str_sprintf('%.0f', id(weather_high_day${d}).state).c_str();"`,text_font:s(i.font_family||"Roboto",r,400),text_color:_}}];w.push({obj:{width:l?100/a+"%":"100%",height:l?"100%":100/a+"%",bg_opa:"transp",border_width:0,widgets:S}})}return{obj:{...o,bg_color:t(i.background_color||"white"),bg_opa:"COVER",radius:8,border_width:i.show_border!==!1?i.border_width||1:0,border_color:t(i.border_color||i.color||"black"),layout:{type:"flex",flex_flow:l?"row":"column",flex_align_main:"space_around",flex_align_cross:"center"},widgets:w}}},export:N,onExportNumericSensors:L,onExportTextSensors:P,collectRequirements:R};export{O as default};

# ============================================================================
# reTerminal E1001 - ESPHome Configuration Template
# ============================================================================
# INSTRUCTIONS:
#
# STEP 1: Copy the Material Design Icons font file
#         - From this repo: font_ttf/font_ttf/materialdesignicons-webfont.ttf
#         - To ESPHome: /config/esphome/fonts/materialdesignicons-webfont.ttf
#         (Create the fonts folder if it doesn't exist)
#
# STEP 2: Create a new device in ESPHome
#         - Click "New Device"
#         - Name: reterminal (or your choice)
#         - Select: ESP32-S3
#         - ESPHome will auto-generate a basic config
#         - IMPORTANT: Change framework from "esp-idf" to "arduino"
#
# STEP 3: Copy the "HARDWARE SECTIONS" below (from ▼ START to ▲ END)
#         Paste them AFTER the captive_portal: line in your ESPHome config
#
# STEP 4: Add buzzer services to your api: section (see instructions below)
#
# STEP 5: Design your dashboard in Home Assistant
#         - Open the reTerminal Dashboard integration
#         - Click "Save Layout" when done
#         - Click "Generate Snippet"
#
# STEP 6: From the generated snippet, copy ONLY these sections:
#         - globals:
#         - font:
#         - text_sensor: (only if you used sensor_text widgets)
#         - button: (optional virtual buttons for HA)
#         - script: (if generated)
#         - display:
#         Paste them at the end of your config (see STEP 6 marker below)
#
# IMPORTANT: Do NOT copy output:, rtttl:, sensor:, or time: from the
#            generated snippet - these are already in the hardware sections!
#
# ============================================================================

# ============================================================================
# EXAMPLE: ESPHome Auto-Generated Config (you will have this already)
# ============================================================================
# This is what ESPHome creates automatically. DON'T copy this - it's just
# an example to show you what sections you already have.
#
# esphome:
#   name: reterminal
#   friendly_name: reterminal
#
# IMPORTANT: Add this on_boot section to initialize the display!
esphome:
  name: your-device-name
  friendly_name: Your Device Name
  on_boot:
    priority: 600
    then:
      - output.turn_on: bsp_battery_enable
      - delay: 200ms
      - component.update: epaper_display
#
# esp32:
#   board: esp32-s3-devkitc-1
#   framework:
#     type: arduino    ← Make sure this is "arduino" not "esp-idf"
#
# logger:
#
# api:
#   encryption:
#     key: "your_auto_generated_key_here"
#
# ota:
#   - platform: esphome
#     password: "your_auto_generated_password_here"
#
# wifi:
#   ssid: !secret wifi_ssid
#   password: !secret wifi_password
#   ap:
#     ssid: "Reterminal Fallback Hotspot"
#     password: "auto_generated_password"
#
# captive_portal:
#
# ============================================================================


# ============================================================================
# ▼▼▼ START: HARDWARE SECTIONS - COPY FROM HERE ▼▼▼
# ============================================================================
# Copy everything between the ▼▼▼ START and ▲▲▲ END markers
# Paste it in your ESPHome config AFTER the "captive_portal:" line
# ============================================================================

psram:
  mode: octal
  speed: 80MHz

time:
  - platform: homeassistant
    id: ha_time

i2c:
  sda: GPIO19
  scl: GPIO20
  scan: true

spi:
  clk_pin: GPIO7
  mosi_pin: GPIO9

output:
  - platform: gpio
    pin: GPIO21
    id: bsp_battery_enable

  - platform: ledc
    pin: GPIO45
    id: buzzer_output

rtttl:
  id: reterminal_buzzer
  output: buzzer_output

sensor:
  - platform: sht4x
    temperature:
      name: "reTerminal Onboard Temperature"
      id: onboard_temperature
      accuracy_decimals: 1
      filters:
        - round: 1
    humidity:
      name: "reTerminal Onboard Humidity"
      id: onboard_humidity
      accuracy_decimals: 1
      filters:
        - round: 1
    address: 0x44
    update_interval: 60s

binary_sensor:
  - platform: gpio
    id: button_left
    name: "reTerminal Button Left"
    pin:
      number: GPIO5
      mode: INPUT_PULLUP
      inverted: true
    on_press:
      then:
        - lambda: |-
            if (id(display_page) > 0) {
              id(display_page) -= 1;
            }
        - component.update: epaper_display

  - platform: gpio
    id: button_right
    name: "reTerminal Button Right"
    pin:
      number: GPIO4
      mode: INPUT_PULLUP
      inverted: true
    on_press:
      then:
        - lambda: |-
            if (id(display_page) < 9) {
              id(display_page) += 1;
            }
        - component.update: epaper_display

  - platform: gpio
    id: button_refresh
    name: "reTerminal Button Refresh"
    pin:
      number: GPIO3
      mode: INPUT_PULLUP
      inverted: true
    on_press:
      then:
        - component.update: epaper_display

# ============================================================================
# ▲▲▲ END: HARDWARE SECTIONS - COPY UNTIL HERE ▲▲▲
# ============================================================================


# ============================================================================
# STEP 3: Add buzzer services to your api: section
# ============================================================================
# Find your "api:" section at the top of your config (created by ESPHome)
# It currently looks like this:
#
#   api:
#     encryption:
#       key: "your_key_here"
#
# ADD the "services:" block so it looks like this:
#
#   api:
#     encryption:
#       key: "your_key_here"
#     services:
#       - service: play_tone
#         variables:
#           melody: string
#         then:
#           - rtttl.play: !lambda 'return melody;'
#       - service: beep_short
#         then:
#           - rtttl.play: "beep:d=32,o=5,b=200:16e6"
#       - service: beep_ok
#         then:
#           - rtttl.play: "ok:d=16,o=5,b=200:e6"
#       - service: beep_error
#         then:
#           - rtttl.play: "error:d=16,o=5,b=200:c6"
#
# IMPORTANT: "services:" must be indented at the same level as "encryption:"
# ============================================================================


# ============================================================================
# STEP 5: Paste generated sections from Home Assistant editor
# ============================================================================
# After designing your dashboard:
# 1. Click "Save Layout"
# 2. Click "Generate Snippet"
# 3. From the generated code, copy ONLY these sections and paste them below:
#
#    ✓ globals:      (always generated)
#    ✓ font:         (always generated)
#    ✓ text_sensor:  (ONLY if you used sensor_text widgets)
#                    If generated, ADD these to the sensor: section above
#                    (don't create a duplicate sensor: section)
#    ✓ button:       (optional - virtual buttons for Home Assistant)
#    ✓ script:       (always generated for page refresh)
#    ✓ display:      (always generated - complete display configuration)
#
#    ✗ DO NOT COPY from generated code (already in hardware template above):
#      - output:
#      - rtttl:
#      - sensor: (template already has SHT4x sensor)
#      - time:
#
# IMPORTANT: If the generated code includes text_sensor: entries,
# you can paste them here as a separate section. They won't conflict
# with the sensor: section above.
#
# Example of what to paste:
#
# globals:
#   - id: display_page
#     type: int
#     restore_value: true
#     initial_value: '0'
#
# font:
#   - file: "gfonts://Material+Design+Icons"
#     id: mdi_48
#     size: 48
#     glyphs: ["\U000F0595"]
#
# text_sensor:
#   - platform: homeassistant
#     id: weather_forecast_home
#     entity_id: weather.forecast_home
#     internal: true
#
# script:
#   - id: manage_run_and_sleep
#     mode: restart
#     then:
#       # ... refresh logic ...
#
# display:
#   - platform: waveshare_epaper
#     id: epaper_display
#     cs_pin: GPIO10
#     dc_pin: GPIO11
#     reset_pin:
#       number: GPIO12
#       inverted: false
#     busy_pin:
#       number: GPIO13
#       inverted: true
#     update_interval: never
#     lambda: |-
#       int page = id(display_page);
#       if (page == 0) {
#         // your widgets here
#       }
#
# ============================================================================
# ← PASTE YOUR GENERATED CODE HERE (globals, font, text_sensor, script, display)
# ============================================================================
